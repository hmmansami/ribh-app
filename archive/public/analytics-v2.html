<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ­Ù„ÙŠÙ„Ø§Øª Ø±ÙØ¨Ø­ ğŸ“Š</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg: #0a0a0a; --card: rgba(18,18,18,0.95); --border: rgba(255,255,255,0.08);
            --green: #10B981; --green-dim: rgba(16,185,129,0.15); --purple: #8B5CF6;
            --yellow: #F59E0B; --red: #EF4444; --blue: #3B82F6;
            --text: #fff; --text-dim: #71717A; --text-muted: #52525B;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; padding: 1rem; }
        
        /* Layout */
        .container { max-width: 1200px; margin: 0 auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem; }
        .logo { font-size: 1.5rem; font-weight: 700; background: linear-gradient(135deg, var(--green), #34D399); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .period-select { background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 0.5rem 1rem; color: var(--text); cursor: pointer; }
        
        /* Grid */
        .grid { display: grid; gap: 1rem; }
        .grid-2 { grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
        .grid-4 { grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); }
        
        /* Cards */
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 1.25rem; }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; }
        .card-title { font-size: 0.85rem; color: var(--text-dim); }
        .card-icon { font-size: 1.25rem; }
        
        /* Hero Revenue Card */
        .hero-card { background: linear-gradient(135deg, var(--green-dim), rgba(16,185,129,0.05)); border-color: rgba(16,185,129,0.3); text-align: center; padding: 2rem; }
        .hero-label { font-size: 0.9rem; color: var(--green); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 0.5rem; }
        .hero-amount { font-size: clamp(2.5rem, 10vw, 4rem); font-weight: 700; direction: ltr; }
        .hero-amount .currency { font-size: 0.4em; opacity: 0.6; }
        .hero-sub { font-size: 0.85rem; color: var(--text-dim); margin-top: 0.5rem; }
        .hero-trend { display: inline-flex; align-items: center; gap: 0.25rem; font-size: 0.8rem; padding: 0.25rem 0.75rem; border-radius: 100px; margin-top: 0.75rem; }
        .trend-up { background: var(--green-dim); color: var(--green); }
        .trend-down { background: rgba(239,68,68,0.15); color: var(--red); }
        
        /* Stat Cards */
        .stat-value { font-size: 1.75rem; font-weight: 600; margin-bottom: 0.25rem; }
        .stat-change { font-size: 0.75rem; color: var(--green); }
        .stat-change.negative { color: var(--red); }
        
        /* Funnel */
        .funnel { display: flex; flex-direction: column; gap: 0.5rem; }
        .funnel-step { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: rgba(255,255,255,0.03); border-radius: 8px; position: relative; }
        .funnel-bar { height: 100%; background: var(--green); border-radius: 4px; position: absolute; right: 0; top: 0; bottom: 0; opacity: 0.15; }
        .funnel-icon { width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 8px; font-size: 1rem; z-index: 1; }
        .funnel-info { flex: 1; z-index: 1; }
        .funnel-label { font-size: 0.8rem; color: var(--text-dim); }
        .funnel-value { font-size: 1.1rem; font-weight: 600; }
        .funnel-rate { font-size: 0.85rem; color: var(--green); z-index: 1; }
        
        /* Progress Bars */
        .progress-item { margin-bottom: 1rem; }
        .progress-header { display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 0.85rem; }
        .progress-bar { height: 8px; background: rgba(255,255,255,0.1); border-radius: 100px; overflow: hidden; }
        .progress-fill { height: 100%; border-radius: 100px; transition: width 1s ease; }
        
        /* Channel Colors */
        .whatsapp { background: #25D366; } .sms { background: var(--blue); } .email { background: var(--purple); }
        
        /* Insights */
        .insight { display: flex; align-items: flex-start; gap: 0.75rem; padding: 1rem; background: rgba(255,255,255,0.03); border-radius: 12px; margin-bottom: 0.75rem; border-right: 3px solid var(--green); }
        .insight-icon { font-size: 1.25rem; }
        .insight-text { font-size: 0.9rem; line-height: 1.5; }
        
        /* ROI Card */
        .roi-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; text-align: center; }
        .roi-item { padding: 1rem; background: rgba(255,255,255,0.03); border-radius: 12px; }
        .roi-label { font-size: 0.75rem; color: var(--text-dim); margin-bottom: 0.25rem; }
        .roi-value { font-size: 1.5rem; font-weight: 600; }
        .roi-value.positive { color: var(--green); }
        
        /* Chart Container */
        .chart-container { height: 200px; margin-top: 1rem; }
        
        /* Heatmap */
        .heatmap { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
        .heatmap-cell { aspect-ratio: 1; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 0.65rem; color: var(--text-dim); }
        .heat-0 { background: rgba(255,255,255,0.03); } .heat-1 { background: rgba(16,185,129,0.2); }
        .heat-2 { background: rgba(16,185,129,0.4); } .heat-3 { background: rgba(16,185,129,0.6); color: #fff; }
        .heat-4 { background: rgba(16,185,129,0.8); color: #fff; } .heat-5 { background: var(--green); color: #fff; }
        
        /* Table */
        .table { width: 100%; font-size: 0.85rem; }
        .table th, .table td { padding: 0.75rem 0.5rem; text-align: right; border-bottom: 1px solid var(--border); }
        .table th { color: var(--text-dim); font-weight: 500; }
        .table tr:last-child td { border-bottom: none; }
        
        /* Segments */
        .segment-card { display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(255,255,255,0.03); border-radius: 12px; margin-bottom: 0.75rem; }
        .segment-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.25rem; }
        .segment-info { flex: 1; }
        .segment-name { font-weight: 500; margin-bottom: 0.25rem; }
        .segment-stats { font-size: 0.8rem; color: var(--text-dim); }
        .segment-rate { font-size: 1.25rem; font-weight: 600; color: var(--green); }
        
        /* Responsive */
        @media (max-width: 768px) {
            .roi-grid { grid-template-columns: 1fr; }
            .grid-2 { grid-template-columns: 1fr; }
        }
        
        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .card { animation: fadeIn 0.5s ease; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .loading { animation: pulse 1.5s infinite; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">ğŸ“Š ØªØ­Ù„ÙŠÙ„Ø§Øª Ø±ÙØ¨Ø­</div>
            <select class="period-select" id="period" onchange="loadData()">
                <option value="7">Ø¢Ø®Ø± 7 Ø£ÙŠØ§Ù…</option>
                <option value="30" selected>Ø¢Ø®Ø± 30 ÙŠÙˆÙ…</option>
                <option value="90">Ø¢Ø®Ø± 3 Ø£Ø´Ù‡Ø±</option>
            </select>
        </div>
        
        <!-- Hero: Revenue Recovery -->
        <div class="card hero-card" style="margin-bottom: 1rem;">
            <div class="hero-label">ğŸ’° Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³ØªØ±Ø¯Ø©</div>
            <div class="hero-amount"><span class="currency">Ø±.Ø³</span> <span id="totalRevenue">0</span></div>
            <div class="hero-sub">Ù…Ù† <span id="recoveredCarts">0</span> Ø³Ù„Ø© Ù…Ø³ØªØ±Ø¯Ø©</div>
            <div class="hero-trend trend-up" id="revenueTrend">â†‘ 23% Ù…Ù† Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù…Ø§Ø¶ÙŠ</div>
        </div>
        
        <!-- Quick Stats -->
        <div class="grid grid-4" style="margin-bottom: 1rem;">
            <div class="card">
                <div class="card-header"><span class="card-title">Ø§Ù„Ø³Ù„Ø§Øª Ø§Ù„Ù…ØªØ±ÙˆÙƒØ©</span><span class="card-icon">ğŸ›’</span></div>
                <div class="stat-value" id="abandoned">0</div>
                <div class="stat-change">Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©</div>
            </div>
            <div class="card">
                <div class="card-header"><span class="card-title">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯</span><span class="card-icon">ğŸ¯</span></div>
                <div class="stat-value" id="recoveryRate">0%</div>
                <div class="stat-change">Ù…Ù† Ø§Ù„Ù…ØªØ±ÙˆÙƒØ©</div>
            </div>
            <div class="card">
                <div class="card-header"><span class="card-title">Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙØªØ­</span><span class="card-icon">ğŸ‘ï¸</span></div>
                <div class="stat-value" id="openRate">0%</div>
                <div class="stat-change">Ù„Ù„Ø±Ø³Ø§Ø¦Ù„</div>
            </div>
            <div class="card">
                <div class="card-header"><span class="card-title">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø·Ù„Ø¨</span><span class="card-icon">ğŸ’µ</span></div>
                <div class="stat-value" id="avgOrder">0</div>
                <div class="stat-change">Ø±.Ø³ Ù„Ù„Ø³Ù„Ø©</div>
            </div>
        </div>
        
        <!-- Main Grid -->
        <div class="grid grid-2" style="margin-bottom: 1rem;">
            <!-- Funnel -->
            <div class="card">
                <div class="card-header"><span class="card-title">ğŸ”„ Ù‚Ù…Ø¹ Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯</span></div>
                <div class="funnel" id="funnel">
                    <div class="funnel-step"><div class="funnel-bar" style="width: 100%;"></div><div class="funnel-icon" style="background: var(--yellow);">ğŸ›’</div><div class="funnel-info"><div class="funnel-label">Ø³Ù„Ø§Øª Ù…ØªØ±ÙˆÙƒØ©</div><div class="funnel-value">0</div></div><div class="funnel-rate">100%</div></div>
                    <div class="funnel-step"><div class="funnel-bar" style="width: 75%;"></div><div class="funnel-icon" style="background: var(--blue);">ğŸ“¤</div><div class="funnel-info"><div class="funnel-label">ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©</div><div class="funnel-value">0</div></div><div class="funnel-rate">0%</div></div>
                    <div class="funnel-step"><div class="funnel-bar" style="width: 45%;"></div><div class="funnel-icon" style="background: var(--purple);">ğŸ‘ï¸</div><div class="funnel-info"><div class="funnel-label">ÙØªØ­ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</div><div class="funnel-value">0</div></div><div class="funnel-rate">0%</div></div>
                    <div class="funnel-step"><div class="funnel-bar" style="width: 20%;"></div><div class="funnel-icon" style="background: var(--green);">âœ…</div><div class="funnel-info"><div class="funnel-label">ØªÙ… Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯</div><div class="funnel-value">0</div></div><div class="funnel-rate">0%</div></div>
                </div>
            </div>
            
            <!-- Revenue Chart -->
            <div class="card">
                <div class="card-header"><span class="card-title">ğŸ“ˆ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</span></div>
                <div class="chart-container"><canvas id="revenueChart"></canvas></div>
            </div>
        </div>
        
        <div class="grid grid-2" style="margin-bottom: 1rem;">
            <!-- Channel Performance -->
            <div class="card">
                <div class="card-header"><span class="card-title">ğŸ“± Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù‚Ù†ÙˆØ§Øª</span></div>
                <div class="progress-item">
                    <div class="progress-header"><span>ÙˆØ§ØªØ³Ø§Ø¨</span><span id="waRate">0%</span></div>
                    <div class="progress-bar"><div class="progress-fill whatsapp" id="waBar" style="width: 0%;"></div></div>
                </div>
                <div class="progress-item">
                    <div class="progress-header"><span>SMS</span><span id="smsRate">0%</span></div>
                    <div class="progress-bar"><div class="progress-fill sms" id="smsBar" style="width: 0%;"></div></div>
                </div>
                <div class="progress-item">
                    <div class="progress-header"><span>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</span><span id="emailRate">0%</span></div>
                    <div class="progress-bar"><div class="progress-fill email" id="emailBar" style="width: 0%;"></div></div>
                </div>
            </div>
            
            <!-- Customer Segments -->
            <div class="card">
                <div class="card-header"><span class="card-title">ğŸ‘¥ Ø´Ø±Ø§Ø¦Ø­ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</span></div>
                <div id="segments">
                    <div class="segment-card"><div class="segment-icon" style="background: linear-gradient(135deg, #F59E0B, #FBBF24);">ğŸ‘‘</div><div class="segment-info"><div class="segment-name">VIP</div><div class="segment-stats">0 Ø±Ø³Ø§Ù„Ø©</div></div><div class="segment-rate">0%</div></div>
                    <div class="segment-card"><div class="segment-icon" style="background: linear-gradient(135deg, var(--green), #34D399);">ğŸŒŸ</div><div class="segment-info"><div class="segment-name">Ø¹Ù…Ù„Ø§Ø¡ Ø¬Ø¯Ø¯</div><div class="segment-stats">0 Ø±Ø³Ø§Ù„Ø©</div></div><div class="segment-rate">0%</div></div>
                    <div class="segment-card"><div class="segment-icon" style="background: linear-gradient(135deg, var(--purple), #A78BFA);">ğŸ’¤</div><div class="segment-info"><div class="segment-name">Ø®Ø§Ù…Ù„ÙŠÙ†</div><div class="segment-stats">0 Ø±Ø³Ø§Ù„Ø©</div></div><div class="segment-rate">0%</div></div>
                </div>
            </div>
        </div>
        
        <div class="grid grid-2" style="margin-bottom: 1rem;">
            <!-- Best Times Heatmap -->
            <div class="card">
                <div class="card-header"><span class="card-title">â° Ø£ÙØ¶Ù„ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</span></div>
                <p style="font-size: 0.8rem; color: var(--text-dim); margin-bottom: 1rem;">Ø£ÙØ¶Ù„ ÙˆÙ‚Øª: <span id="bestTime" style="color: var(--green);">8:00 Ù…Ø³Ø§Ø¡Ù‹</span> | Ø£ÙØ¶Ù„ ÙŠÙˆÙ…: <span id="bestDay" style="color: var(--green);">Ø§Ù„Ø£Ø­Ø¯</span></p>
                <div class="heatmap" id="heatmap"></div>
                <div style="display: flex; justify-content: space-between; margin-top: 0.5rem; font-size: 0.7rem; color: var(--text-muted);">
                    <span>Ø§Ù„Ø£Ø­Ø¯</span><span>Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</span><span>Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</span><span>Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</span><span>Ø§Ù„Ø®Ù…ÙŠØ³</span><span>Ø§Ù„Ø¬Ù…Ø¹Ø©</span><span>Ø§Ù„Ø³Ø¨Øª</span>
                </div>
            </div>
            
            <!-- Top Offers -->
            <div class="card">
                <div class="card-header"><span class="card-title">ğŸ† Ø£ÙØ¶Ù„ Ø§Ù„Ø¹Ø±ÙˆØ¶</span></div>
                <table class="table">
                    <thead><tr><th>Ø§Ù„Ø¹Ø±Ø¶</th><th>Ø§Ù„ØªØ­ÙˆÙŠÙ„</th><th>Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</th></tr></thead>
                    <tbody id="offersTable">
                        <tr><td>Ø®ØµÙ… 10%</td><td>12%</td><td>5,200 Ø±.Ø³</td></tr>
                        <tr><td>Ø´Ø­Ù† Ù…Ø¬Ø§Ù†ÙŠ</td><td>18%</td><td>3,800 Ø±.Ø³</td></tr>
                        <tr><td>Ø®ØµÙ… 15%</td><td>8%</td><td>2,100 Ø±.Ø³</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="grid grid-2" style="margin-bottom: 1rem;">
            <!-- Top Products -->
            <div class="card">
                <div class="card-header"><span class="card-title">ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø£ÙƒØ«Ø± ØªØ±ÙƒØ§Ù‹</span></div>
                <table class="table">
                    <thead><tr><th>Ø§Ù„Ù…Ù†ØªØ¬</th><th>Ù…ØªØ±ÙˆÙƒ</th><th>Ù…Ø³ØªØ±Ø¯</th></tr></thead>
                    <tbody id="productsTable">
                        <tr><td>Ø­Ù‚ÙŠØ¨Ø© Ø¬Ù„Ø¯</td><td>45</td><td>12 (27%)</td></tr>
                        <tr><td>Ø³Ø§Ø¹Ø© ÙƒÙ„Ø§Ø³ÙŠÙƒ</td><td>32</td><td>8 (25%)</td></tr>
                        <tr><td>Ø¹Ø·Ø± ÙØ§Ø®Ø±</td><td>28</td><td>9 (32%)</td></tr>
                    </tbody>
                </table>
            </div>
            
            <!-- ROI Calculator -->
            <div class="card">
                <div class="card-header"><span class="card-title">ğŸ’¹ Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±</span></div>
                <div class="roi-grid">
                    <div class="roi-item"><div class="roi-label">ØªÙƒÙ„ÙØ© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</div><div class="roi-value" id="roiCost">299 Ø±.Ø³</div></div>
                    <div class="roi-item"><div class="roi-label">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³ØªØ±Ø¯Ø©</div><div class="roi-value positive" id="roiRecovered">0 Ø±.Ø³</div></div>
                    <div class="roi-item"><div class="roi-label">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¹Ø§Ø¦Ø¯</div><div class="roi-value positive" id="roiPercent">0%</div></div>
                </div>
                <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: var(--green-dim); border-radius: 12px;">
                    <span style="font-size: 0.9rem;">ğŸ‰ ÙƒÙ„ Ø±ÙŠØ§Ù„ ØªØ¯ÙØ¹Ù‡ ÙŠØ¹ÙˆØ¯ Ø¨Ù€ <strong id="roiMultiple">0</strong> Ø±ÙŠØ§Ù„</span>
                </div>
            </div>
        </div>
        
        <!-- Insights -->
        <div class="card">
            <div class="card-header"><span class="card-title">ğŸ’¡ Ø±Ø¤Ù‰ Ø°ÙƒÙŠØ©</span></div>
            <div id="insights">
                <div class="insight"><span class="insight-icon">â°</span><span class="insight-text">Ø£ÙØ¶Ù„ ÙˆÙ‚Øª Ù„Ù„Ø¥Ø±Ø³Ø§Ù„ Ù‡Ùˆ Ø§Ù„Ø³Ø§Ø¹Ø© 8 Ù…Ø³Ø§Ø¡Ù‹ - Ù†Ø­Ø³Ù‘Ù† Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ù‡Ø°Ø§ Ø§Ù„ÙˆÙ‚Øª</span></div>
                <div class="insight"><span class="insight-icon">ğŸ“±</span><span class="insight-text">ÙˆØ§ØªØ³Ø§Ø¨ ÙŠØªÙÙˆÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø¨Ù†Ø³Ø¨Ø© 3x - Ø±ÙƒÙ‘Ø² Ø¬Ù‡ÙˆØ¯Ùƒ Ø¹Ù„ÙŠÙ‡</span></div>
                <div class="insight"><span class="insight-icon">ğŸ‘‘</span><span class="insight-text">Ø¹Ù…Ù„Ø§Ø¡ VIP ÙŠØ³ØªØ¬ÙŠØ¨ÙˆÙ† Ø¨Ù†Ø³Ø¨Ø© 45% - Ù‚Ø¯Ù‘Ù… Ù„Ù‡Ù… Ø¹Ø±ÙˆØ¶ Ø­ØµØ±ÙŠØ©</span></div>
            </div>
        </div>
    </div>

    <script>
        // Format number with commas
        const fmt = n => n.toLocaleString('en-US');
        
        // Animate counter
        function animateTo(el, target, suffix = '') {
            if (typeof el === 'string') el = document.getElementById(el);
            const start = parseInt(el.textContent.replace(/[^0-9]/g, '')) || 0;
            const duration = 1500;
            const startTime = performance.now();
            function update(now) {
                const progress = Math.min((now - startTime) / duration, 1);
                const eased = 1 - Math.pow(1 - progress, 3);
                el.textContent = fmt(Math.floor(start + (target - start) * eased)) + suffix;
                if (progress < 1) requestAnimationFrame(update);
            }
            requestAnimationFrame(update);
        }
        
        // Revenue Chart
        let revenueChart;
        function initChart(labels, data) {
            const ctx = document.getElementById('revenueChart').getContext('2d');
            if (revenueChart) revenueChart.destroy();
            revenueChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª',
                        data: data,
                        borderColor: '#10B981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { display: false }, ticks: { color: '#71717A', maxTicksLimit: 7 } },
                        y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#71717A' } }
                    }
                }
            });
        }
        
        // Generate heatmap
        function renderHeatmap(hourStats) {
            const heatmap = document.getElementById('heatmap');
            heatmap.innerHTML = '';
            // Show 4 time slots per day (6am, 12pm, 6pm, 10pm) x 7 days
            const slots = [6, 12, 18, 22];
            slots.forEach(hour => {
                for (let day = 0; day < 7; day++) {
                    const val = hourStats[hour]?.converted || Math.floor(Math.random() * 6);
                    const heat = Math.min(5, val);
                    const cell = document.createElement('div');
                    cell.className = `heatmap-cell heat-${heat}`;
                    cell.title = `${hour}:00 - ${val} ØªØ­ÙˆÙŠÙ„`;
                    heatmap.appendChild(cell);
                }
            });
        }
        
        // Update funnel
        function updateFunnel(funnel) {
            const steps = document.querySelectorAll('.funnel-step');
            const values = [funnel.abandoned, funnel.messaged, funnel.opened, funnel.recovered];
            const rates = [100, funnel.rates.messageRate, funnel.rates.openRate, funnel.rates.recoveryRate];
            steps.forEach((step, i) => {
                step.querySelector('.funnel-value').textContent = fmt(values[i]);
                step.querySelector('.funnel-rate').textContent = rates[i] + '%';
                step.querySelector('.funnel-bar').style.width = rates[i] + '%';
            });
        }
        
        // Load data (mock for now, replace with API call)
        function loadData() {
            const period = document.getElementById('period').value;
            
            // Mock data - replace with: fetch(`/api/analytics?days=${period}`)
            const data = {
                revenue: { total: 47250, trend: generateTrend(period) },
                funnel: { abandoned: 342, messaged: 298, opened: 186, recovered: 68, rates: { messageRate: 87, openRate: 62, recoveryRate: 20 } },
                channels: { whatsapp: { convRate: 24 }, sms: { convRate: 12 }, email: { convRate: 8 } },
                segments: { vip: { sent: 45, rate: 45 }, new: { sent: 120, rate: 18 }, dormant: { sent: 85, rate: 12 } },
                timing: { bestHour: 20, bestDay: 'Ø§Ù„Ø£Ø­Ø¯', hourStats: Array(24).fill(0).map(() => ({ converted: Math.floor(Math.random() * 10) })) },
                roi: { cost: 299, recovered: 47250, roi: 15700 }
            };
            
            // Update UI
            animateTo('totalRevenue', data.revenue.total);
            animateTo('recoveredCarts', data.funnel.recovered);
            animateTo('abandoned', data.funnel.abandoned);
            animateTo('recoveryRate', data.funnel.rates.recoveryRate, '%');
            animateTo('openRate', data.funnel.rates.openRate, '%');
            animateTo('avgOrder', Math.round(data.revenue.total / data.funnel.recovered));
            
            updateFunnel(data.funnel);
            
            // Channels
            document.getElementById('waRate').textContent = data.channels.whatsapp.convRate + '%';
            document.getElementById('waBar').style.width = data.channels.whatsapp.convRate * 3 + '%';
            document.getElementById('smsRate').textContent = data.channels.sms.convRate + '%';
            document.getElementById('smsBar').style.width = data.channels.sms.convRate * 3 + '%';
            document.getElementById('emailRate').textContent = data.channels.email.convRate + '%';
            document.getElementById('emailBar').style.width = data.channels.email.convRate * 3 + '%';
            
            // Segments
            const segmentCards = document.querySelectorAll('.segment-card');
            const segKeys = ['vip', 'new', 'dormant'];
            segKeys.forEach((key, i) => {
                segmentCards[i].querySelector('.segment-stats').textContent = data.segments[key].sent + ' Ø±Ø³Ø§Ù„Ø©';
                segmentCards[i].querySelector('.segment-rate').textContent = data.segments[key].rate + '%';
            });
            
            // Timing
            document.getElementById('bestTime').textContent = data.timing.bestHour + ':00';
            document.getElementById('bestDay').textContent = data.timing.bestDay;
            renderHeatmap(data.timing.hourStats);
            
            // ROI
            document.getElementById('roiRecovered').textContent = fmt(data.roi.recovered) + ' Ø±.Ø³';
            document.getElementById('roiPercent').textContent = data.roi.roi + '%';
            document.getElementById('roiMultiple').textContent = Math.round(data.roi.recovered / data.roi.cost);
            
            // Chart
            const labels = data.revenue.trend.map(d => d.date.split('-')[2]);
            const chartData = data.revenue.trend.map(d => d.amount);
            initChart(labels, chartData);
        }
        
        // Generate mock trend data
        function generateTrend(days) {
            const trend = [];
            for (let i = days - 1; i >= 0; i--) {
                const d = new Date(); d.setDate(d.getDate() - i);
                trend.push({ date: d.toISOString().split('T')[0], amount: 500 + Math.floor(Math.random() * 2500) });
            }
            return trend;
        }
        
        // Initialize
        loadData();
    </script>
</body>
</html>
