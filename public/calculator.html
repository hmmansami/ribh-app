<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø³Ù„Ø§Øª Ø§Ù„Ù…ØªØ±ÙˆÙƒØ© | Ø±ÙØ¨Ø­</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'IBM Plex Sans Arabic', sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }
        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        .logo {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        .logo span { color: #10B981; }
        h1 {
            text-align: center;
            font-size: 1.5rem;
            margin-bottom: 30px;
            color: #a1a1aa;
            font-weight: 500;
        }
        .card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 20px;
        }
        .input-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            color: #a1a1aa;
            font-size: 0.9rem;
        }
        input[type="number"], input[type="text"] {
            width: 100%;
            padding: 15px;
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            background: rgba(0,0,0,0.3);
            color: #fff;
            font-size: 1.1rem;
            font-family: inherit;
            text-align: center;
        }
        input:focus {
            outline: none;
            border-color: #10B981;
        }
        input::placeholder { color: #52525b; }
        .btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #10B981, #059669);
            border: none;
            border-radius: 12px;
            color: #fff;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(16,185,129,0.3);
        }
        .btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }
        .result {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .lost-money {
            font-size: 3rem;
            font-weight: 700;
            color: #EF4444;
            margin: 20px 0;
            text-align: center;
        }
        .recover-money {
            font-size: 2rem;
            font-weight: 600;
            color: #10B981;
            margin: 15px 0;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .stat-label { color: #a1a1aa; }
        .stat-value { font-weight: 600; }
        .emoji { font-size: 4rem; margin-bottom: 10px; text-align: center; }
        .reset-btn {
            background: transparent;
            border: 2px solid rgba(255,255,255,0.2);
            margin-top: 15px;
        }
        .reset-btn:hover {
            background: rgba(255,255,255,0.1);
            box-shadow: none;
            transform: none;
        }
        .trust {
            text-align: center;
            margin-top: 30px;
            color: #52525b;
            font-size: 0.85rem;
        }
        
        /* Signup Section - Inside Results */
        .signup-section {
            margin-top: 30px;
            padding-top: 25px;
            border-top: 2px solid rgba(16, 185, 129, 0.3);
        }
        .signup-section h3 {
            text-align: center;
            font-size: 1.2rem;
            margin-bottom: 8px;
            color: #10B981;
        }
        .signup-section .subtitle {
            text-align: center;
            color: #a1a1aa;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }
        .signup-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .signup-form input {
            padding: 15px;
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            background: rgba(0,0,0,0.3);
            color: #fff;
            font-size: 1rem;
            font-family: inherit;
        }
        .signup-form input[type="email"] {
            text-align: right;
        }
        .signup-form input[type="tel"] {
            text-align: left;
            direction: ltr;
        }
        .success-msg {
            display: none;
            background: rgba(16,185,129,0.2);
            border: 1px solid #10B981;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            margin-top: 15px;
        }
        .error-msg {
            display: none;
            background: rgba(239,68,68,0.2);
            border: 1px solid #EF4444;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            margin-top: 15px;
            color: #EF4444;
        }
        .whatsapp-note {
            text-align: center;
            font-size: 0.85rem;
            color: #71717a;
            margin-top: 12px;
        }
        .whatsapp-note span {
            color: #25D366;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">Ø±Ù<span>Ø¨Ø­</span> ğŸ’š</div>
        <h1>ÙƒÙ… ØªØ®Ø³Ø± Ù…Ù† Ø§Ù„Ø³Ù„Ø§Øª Ø§Ù„Ù…ØªØ±ÙˆÙƒØ©ØŸ</h1>

        <!-- Step 1: Calculator Input -->
        <div class="card" id="calculator">
            <div class="input-group">
                <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙˆØ§Ø± Ø´Ù‡Ø±ÙŠØ§Ù‹</label>
                <input type="number" id="visitors" placeholder="Ù…Ø«Ø§Ù„: 10000" value="">
            </div>
            <div class="input-group">
                <label>Ù†Ø³Ø¨Ø© Ø§Ù„Ø³Ù„Ø§Øª Ø§Ù„Ù…ØªØ±ÙˆÙƒØ© %</label>
                <input type="number" id="abandonRate" placeholder="Ø§Ù„Ù…ØªÙˆØ³Ø·: 70%" value="70">
            </div>
            <div class="input-group">
                <label>Ù…ØªÙˆØ³Ø· Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³Ù„Ø© (Ø±.Ø³)</label>
                <input type="number" id="cartValue" placeholder="Ù…Ø«Ø§Ù„: 300" value="">
            </div>
            <button class="btn" onclick="calculate()">Ø§Ø­Ø³Ø¨ Ø®Ø³Ø§Ø±ØªÙŠ ğŸ“Š</button>
        </div>

        <!-- Step 2: Results + Signup (appears after calculation) -->
        <div class="card result" id="result">
            <!-- The Scary Number -->
            <div class="emoji">ğŸ˜±</div>
            <p style="color: #a1a1aa; text-align: center;">Ø£Ù†Øª ØªØ®Ø³Ø± Ø´Ù‡Ø±ÙŠØ§Ù‹</p>
            <div class="lost-money" id="lostMoney">0 Ø±.Ø³</div>
            
            <div class="stat-row">
                <span class="stat-label">Ø³Ù„Ø§Øª Ù…ØªØ±ÙˆÙƒØ© Ø´Ù‡Ø±ÙŠØ§Ù‹</span>
                <span class="stat-value" id="abandonedCarts">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Ø®Ø³Ø§Ø±Ø© Ø³Ù†ÙˆÙŠØ© ğŸ’¸</span>
                <span class="stat-value" style="color: #EF4444;" id="yearlyLoss">0 Ø±.Ø³</span>
            </div>
            
            <!-- The Solution Preview -->
            <div style="margin-top: 25px; padding: 20px; background: rgba(16,185,129,0.1); border-radius: 12px; text-align: center;">
                <p style="color: #a1a1aa; margin-bottom: 5px;">Ø±ÙØ¨Ø­ ÙŠØ³ØªØ±Ø¯ 15-25% Ù…Ù† Ø³Ù„Ø§ØªÙƒ</p>
                <div class="recover-money" id="recoverMoney">0 - 0 Ø±.Ø³</div>
                <p style="color: #10B981; font-weight: 500;">Ø´Ù‡Ø±ÙŠØ§Ù‹ ÙÙŠ Ø¬ÙŠØ¨Ùƒ ğŸ’°</p>
            </div>

            <!-- Step 3: Signup Form (AFTER seeing the pain + solution) -->
            <div class="signup-section">
                <h3>ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø®Ø³Ø§Ø¦Ø±Ùƒ</h3>
                <p class="subtitle">Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù† ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø®ØµÙ… ØªØ±Ø­ÙŠØ¨ÙŠ Ø­ØµØ±ÙŠ</p>
                
                <div class="signup-form" id="signupForm">
                    <input type="email" id="email" placeholder="Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
                    <input type="tel" id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ (05XXXXXXXX)">
                    <button class="btn" onclick="joinWaitlist()">Ø§Ù†Ø¶Ù… Ø§Ù„Ø¢Ù† ğŸ</button>
                </div>
                
                <p class="whatsapp-note">ğŸ“± Ø³Ù†Ø±Ø³Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ… Ø¹Ù„Ù‰ <span>ÙˆØ§ØªØ³Ø§Ø¨</span></p>
                
                <div class="success-msg" id="successMsg">
                    âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„Ùƒ! ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ§ØªØ³Ø§Ø¨ Ù„ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ… ğŸ‰
                </div>
                <div class="error-msg" id="errorMsg"></div>
            </div>

            <button class="btn reset-btn" onclick="reset()">Ø§Ø­Ø³Ø¨ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©</button>
        </div>

        <p class="trust">ğŸ”’ Ù„Ø§ Ù†Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ â€¢ Ø£Ø¯Ø§Ø© Ù…Ø¬Ø§Ù†ÙŠØ© Ù…Ù† Ø±ÙØ¨Ø­</p>
    </div>

    <script>
        function calculate() {
            const visitors = parseInt(document.getElementById('visitors').value) || 0;
            const abandonRate = parseInt(document.getElementById('abandonRate').value) || 70;
            const cartValue = parseInt(document.getElementById('cartValue').value) || 0;

            if (visitors === 0 || cartValue === 0) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙˆØ§Ø± ÙˆÙ…ØªÙˆØ³Ø· Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³Ù„Ø©');
                return;
            }

            // Assume 30% of visitors add to cart
            const addToCartRate = 0.30;
            const cartsCreated = visitors * addToCartRate;
            const abandonedCarts = Math.round(cartsCreated * (abandonRate / 100));
            const lostMoney = abandonedCarts * cartValue;
            const yearlyLoss = lostMoney * 12;
            const recoverMin = Math.round(lostMoney * 0.15);
            const recoverMax = Math.round(lostMoney * 0.25);

            document.getElementById('lostMoney').textContent = lostMoney.toLocaleString() + ' Ø±.Ø³';
            document.getElementById('abandonedCarts').textContent = abandonedCarts.toLocaleString();
            document.getElementById('yearlyLoss').textContent = yearlyLoss.toLocaleString() + ' Ø±.Ø³';
            document.getElementById('recoverMoney').textContent = recoverMin.toLocaleString() + ' - ' + recoverMax.toLocaleString() + ' Ø±.Ø³';

            // Store for later submission
            window.calculatedLoss = lostMoney;

            document.getElementById('calculator').style.display = 'none';
            document.getElementById('result').style.display = 'block';
            
            // Smooth scroll to results
            document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
        }

        function reset() {
            document.getElementById('calculator').style.display = 'block';
            document.getElementById('result').style.display = 'none';
            document.getElementById('signupForm').style.display = 'flex';
            document.getElementById('successMsg').style.display = 'none';
            document.getElementById('errorMsg').style.display = 'none';
            document.getElementById('email').disabled = false;
            document.getElementById('phone').disabled = false;
        }

        async function joinWaitlist() {
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const errorMsg = document.getElementById('errorMsg');
            errorMsg.style.display = 'none';
            
            if (!email || !email.includes('@')) {
                errorMsg.textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø±ÙŠØ¯ ØµØ­ÙŠØ­';
                errorMsg.style.display = 'block';
                return;
            }
            
            // Validate Saudi phone
            const cleanPhone = phone.replace(/\D/g, '');
            if (!cleanPhone || cleanPhone.length < 9) {
                errorMsg.textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ ØµØ­ÙŠØ­ (Ù…Ø«Ø§Ù„: 05XXXXXXXX)';
                errorMsg.style.display = 'block';
                return;
            }

            // Disable form while submitting
            document.getElementById('email').disabled = true;
            document.getElementById('phone').disabled = true;

            try {
                const res = await fetch('https://ribh-app.onrender.com/api/leads/capture', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        email,
                        phone,
                        merchantId: 'waitlist',
                        source: 'calculator',
                        monthlySales: window.calculatedLoss || 0
                    })
                });
                
                const data = await res.json();
                
                if (!data.success) {
                    errorMsg.textContent = data.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰';
                    errorMsg.style.display = 'block';
                    document.getElementById('email').disabled = false;
                    document.getElementById('phone').disabled = false;
                    return;
                }
                
                // Show success with discount info
                const successMsg = document.getElementById('successMsg');
                successMsg.innerHTML = `âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„Ùƒ! Ø®ØµÙ…Ùƒ Ø§Ù„Ø­ØµØ±ÙŠ <strong>${data.discount}</strong> ÙÙŠ Ø·Ø±ÙŠÙ‚Ù‡ Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨ ğŸ‰`;
                successMsg.style.display = 'block';
                document.getElementById('signupForm').style.display = 'none';
                
            } catch(e) {
                // Show success anyway (capture might have worked)
                document.getElementById('successMsg').style.display = 'block';
                document.getElementById('signupForm').style.display = 'none';
            }
        }
    </script>
</body>
</html>
