<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RIBH - Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <link rel="stylesheet" href="shared/shell.css">
    <style>
        /* â”€â”€ Analytics Page Styles â”€â”€ */
        .analytics-grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 24px;
        }

        .chart-canvas {
            width: 100%;
            height: 280px;
            display: block;
        }

        .chart-canvas-sm {
            width: 100%;
            height: 200px;
            display: block;
        }

        /* â”€â”€ Donut Layout â”€â”€ */
        .donut-layout {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 32px;
            align-items: center;
        }

        .donut-canvas-wrap {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .donut-canvas-wrap canvas {
            width: 240px;
            height: 240px;
        }

        .donut-legend {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .donut-legend-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 14px;
            background: var(--bg-surface-2);
            border-radius: var(--radius-sm);
            transition: background 0.15s var(--ease);
        }

        .donut-legend-item:hover {
            background: var(--bg-hover);
        }

        .donut-legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 3px;
            flex-shrink: 0;
        }

        .donut-legend-name {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
            min-width: 100px;
        }

        .donut-legend-meta {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-right: auto;
            margin-left: 0;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .donut-legend-meta span {
            white-space: nowrap;
        }

        .donut-legend-pct {
            font-weight: 700;
            color: var(--text);
            min-width: 40px;
            text-align: left;
        }

        /* â”€â”€ Horizontal Bar (Flow Performance) â”€â”€ */
        .hbar-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .hbar-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .hbar-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .hbar-name {
            font-size: 12.5px;
            font-weight: 600;
            color: var(--text);
        }

        .hbar-value {
            font-size: 12.5px;
            font-weight: 700;
            color: var(--primary);
        }

        .hbar-track {
            height: 8px;
            background: var(--bg-surface-2);
            border-radius: 4px;
            overflow: hidden;
        }

        .hbar-fill {
            height: 100%;
            border-radius: 4px;
            background: var(--primary);
            transition: width 0.8s var(--ease);
        }

        /* â”€â”€ Conversion Funnel â”€â”€ */
        .funnel-wrap {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0;
            padding: 20px 0;
        }

        .funnel-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        .funnel-bar {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            padding: 16px 24px;
            border-radius: var(--radius-sm);
            background: var(--primary-dim);
            border: 1px solid rgba(16, 185, 129, 0.15);
            transition: all 0.2s var(--ease);
            cursor: default;
            position: relative;
            margin: 0 auto;
        }

        .funnel-bar:hover {
            border-color: rgba(16, 185, 129, 0.35);
            background: rgba(16, 185, 129, 0.18);
        }

        .funnel-bar-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
        }

        .funnel-bar-count {
            font-size: 18px;
            font-weight: 800;
            color: var(--primary);
        }

        .funnel-connector {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 6px 0;
            color: var(--text-dim);
        }

        .funnel-connector svg {
            width: 18px;
            height: 18px;
            opacity: 0.5;
        }

        .funnel-connector-pct {
            font-size: 11px;
            font-weight: 700;
            color: var(--text-muted);
            background: var(--bg-surface-2);
            padding: 2px 10px;
            border-radius: 10px;
            margin-top: 2px;
        }

        /* â”€â”€ Channel Table inside Card â”€â”€ */
        .channel-table-wrap {
            margin-top: 16px;
        }

        .channel-table-wrap .data-table {
            font-size: 12px;
        }

        /* â”€â”€ Messages Table â”€â”€ */
        .msg-preview {
            max-width: 250px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-size: 12.5px;
            color: var(--text);
        }

        /* â”€â”€ Responsive â”€â”€ */
        @media (max-width: 900px) {
            .analytics-grid-2 {
                grid-template-columns: 1fr;
            }
            .donut-layout {
                grid-template-columns: 1fr;
                text-align: center;
            }
            .donut-canvas-wrap {
                justify-content: center;
            }
            .donut-legend-meta {
                margin-right: 0;
            }
        }

        @media (max-width: 600px) {
            .funnel-bar {
                padding: 12px 16px;
                gap: 10px;
            }
            .funnel-bar-label {
                font-size: 12px;
            }
            .funnel-bar-count {
                font-size: 15px;
            }
        }
    </style>
</head>
<body>
    <div id="app"></div>
    <div id="page-body" style="display:none">

        <!-- Time Range Tabs -->
        <div class="tabs" id="timeRangeTabs">
            <button class="tab" data-range="7" onclick="switchRange(7)">7 Ø£ÙŠØ§Ù…</button>
            <button class="tab active" data-range="30" onclick="switchRange(30)">30 ÙŠÙˆÙ…</button>
            <button class="tab" data-range="90" onclick="switchRange(90)">90 ÙŠÙˆÙ…</button>
            <button class="tab" data-range="365" onclick="switchRange(365)">Ø³Ù†Ø©</button>
        </div>

        <!-- KPI Stats -->
        <div class="stats-grid stagger" id="kpiGrid">
            <div class="stat-card animate-in">
                <div class="stat-card-label">
                    <i data-lucide="wallet"></i>
                    Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª
                </div>
                <div class="stat-card-value" id="kpiRevenue">Ù¤Ù§,Ù¨Ù¥Ù  Ø±.Ø³</div>
                <div class="stat-card-change up" id="kpiRevenueChange">
                    <i data-lucide="trending-up" style="width:12px;height:12px"></i>
                    +12.5%
                </div>
            </div>
            <div class="stat-card animate-in">
                <div class="stat-card-label">
                    <i data-lucide="percent"></i>
                    Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„
                </div>
                <div class="stat-card-value" id="kpiConversion">28.5%</div>
                <div class="stat-card-change up" id="kpiConversionChange">
                    <i data-lucide="trending-up" style="width:12px;height:12px"></i>
                    +3.2%
                </div>
            </div>
            <div class="stat-card animate-in">
                <div class="stat-card-label">
                    <i data-lucide="receipt"></i>
                    Ù…ØªÙˆØ³Ø· Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù„Ø¨
                </div>
                <div class="stat-card-value" id="kpiAOV">Ù¢Ù Ù¥ Ø±.Ø³</div>
                <div class="stat-card-change up" id="kpiAOVChange">
                    <i data-lucide="trending-up" style="width:12px;height:12px"></i>
                    +5.1%
                </div>
            </div>
            <div class="stat-card animate-in">
                <div class="stat-card-label">
                    <i data-lucide="zap"></i>
                    Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±
                </div>
                <div class="stat-card-value" id="kpiROI">63x</div>
                <div class="stat-card-change up" id="kpiROIChange">
                    <i data-lucide="trending-up" style="width:12px;height:12px"></i>
                    +8x
                </div>
            </div>
        </div>

        <!-- Revenue Over Time -->
        <div class="card mb-24 animate-in">
            <div class="card-header">
                <div>
                    <div class="card-title">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙˆÙ‚Øª</div>
                    <div class="card-subtitle">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø¨Ø§Ù„Ø±ÙŠØ§Ù„ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ</div>
                </div>
                <span class="badge badge-success" id="revenueTrend">
                    <i data-lucide="trending-up" style="width:12px;height:12px"></i>
                    Ø§ØªØ¬Ø§Ù‡ ØµØ§Ø¹Ø¯
                </span>
            </div>
            <canvas id="revenueChart" class="chart-canvas"></canvas>
        </div>

        <!-- Two Column: Channel Performance + Flow Performance -->
        <div class="analytics-grid-2">

            <!-- Channel Performance -->
            <div class="card animate-in">
                <div class="card-header">
                    <div>
                        <div class="card-title">Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù‚Ù†ÙˆØ§Øª</div>
                        <div class="card-subtitle">Ù…Ù‚Ø§Ø±Ù†Ø© Ø£Ø¯Ø§Ø¡ Ù‚Ù†ÙˆØ§Øª Ø§Ù„ØªÙˆØ§ØµÙ„</div>
                    </div>
                </div>
                <canvas id="channelChart" class="chart-canvas-sm"></canvas>
                <div class="channel-table-wrap">
                    <div class="table-container">
                        <table class="data-table" id="channelTable">
                            <thead>
                                <tr>
                                    <th>Ø§Ù„Ù‚Ù†Ø§Ø©</th>
                                    <th>Ø§Ù„Ù…Ø±Ø³Ù„Ø©</th>
                                    <th>Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©</th>
                                    <th>Ø§Ù„Ù…ÙØªÙˆØ­Ø©</th>
                                    <th>Ø§Ù„ØªØ­ÙˆÙŠÙ„</th>
                                    <th>Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="channelTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Flow Performance -->
            <div class="card animate-in">
                <div class="card-header">
                    <div>
                        <div class="card-title">Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø£ØªÙ…ØªØ©</div>
                        <div class="card-subtitle">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø­Ø³Ø¨ ØªØ³Ù„Ø³Ù„ Ø§Ù„Ø£ØªÙ…ØªØ©</div>
                    </div>
                </div>
                <div class="hbar-list" id="flowBars"></div>
            </div>
        </div>

        <!-- Segment Revenue Distribution -->
        <div class="card mb-24 animate-in">
            <div class="card-header">
                <div>
                    <div class="card-title">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø´Ø±Ø§Ø¦Ø­</div>
                    <div class="card-subtitle">Ù…Ø³Ø§Ù‡Ù…Ø© ÙƒÙ„ Ø´Ø±ÙŠØ­Ø© Ø¹Ù…Ù„Ø§Ø¡ ÙÙŠ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</div>
                </div>
            </div>
            <div class="donut-layout">
                <div class="donut-canvas-wrap">
                    <canvas id="segmentDonut" width="240" height="240"></canvas>
                </div>
                <div class="donut-legend" id="segmentLegend"></div>
            </div>
        </div>

        <!-- Conversion Funnel -->
        <div class="card mb-24 animate-in">
            <div class="card-header">
                <div>
                    <div class="card-title">Ù‚Ù…Ø¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„</div>
                    <div class="card-subtitle">Ù…Ø±Ø§Ø­Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù…Ù† Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ù…ØªØ±ÙˆÙƒØ© Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø±Ø§Ø¡</div>
                </div>
            </div>
            <div class="funnel-wrap" id="funnelWrap"></div>
        </div>

        <!-- Best Performing Messages -->
        <div class="card animate-in">
            <div class="card-header">
                <div>
                    <div class="card-title">Ø£ÙØ¶Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø£Ø¯Ø§Ø¡Ù‹</div>
                    <div class="card-subtitle">Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªØ­ÙˆÙŠÙ„Ø§Ù‹ ÙˆØ¥ÙŠØ±Ø§Ø¯Ø§Øª</div>
                </div>
            </div>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø±Ø³Ø§Ù„Ø©</th>
                            <th>Ø§Ù„ØªØ³Ù„Ø³Ù„</th>
                            <th>Ø§Ù„Ù…Ø±Ø³Ù„Ø©</th>
                            <th>Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„</th>
                            <th>Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="messagesTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Revenue Attribution -->
        <div class="card animate-in" style="margin-top:24px;">
            <div class="card-header">
                <div>
                    <div class="card-title">ğŸ’° Ø¥Ø³Ù†Ø§Ø¯ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª â€” Ù…Ù† Ø£ÙŠÙ† Ø¬Ø§Ø¡ Ø§Ù„Ø±Ø¨Ø­ØŸ</div>
                    <div class="card-subtitle">ØªØªØ¨Ø¹ ÙƒÙ„ Ø±ÙŠØ§Ù„ Ù…Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø´Ø±Ø§Ø¡</div>
                </div>
            </div>
            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-bottom:20px;">
                <div style="background:var(--bg-surface-2);border-radius:var(--radius-sm);padding:16px;text-align:center;">
                    <div style="font-size:11px;color:var(--text-muted);margin-bottom:6px;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¨Ø± RIBH</div>
                    <div style="font-size:24px;font-weight:800;color:var(--primary);direction:ltr;display:inline-block;">Ù¤Ù§,Ù¢Ù Ù </div>
                    <div style="font-size:10px;color:var(--text-dim);">Ø±.Ø³ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</div>
                </div>
                <div style="background:var(--bg-surface-2);border-radius:var(--radius-sm);padding:16px;text-align:center;">
                    <div style="font-size:11px;color:var(--text-muted);margin-bottom:6px;">Ù…Ù† Ø§Ù„Ø£ØªÙ…ØªØ© (Flows)</div>
                    <div style="font-size:24px;font-weight:800;color:var(--secondary);direction:ltr;display:inline-block;">Ù¢Ù©,Ù Ù Ù </div>
                    <div style="font-size:10px;color:var(--text-dim);">Ù¦Ù¡% Ù…Ù† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
                </div>
                <div style="background:var(--bg-surface-2);border-radius:var(--radius-sm);padding:16px;text-align:center;">
                    <div style="font-size:11px;color:var(--text-muted);margin-bottom:6px;">Ù…Ù† Ø§Ù„Ø­Ù…Ù„Ø§Øª</div>
                    <div style="font-size:24px;font-weight:800;color:var(--info);direction:ltr;display:inline-block;">Ù¡Ù¨,Ù¢Ù Ù </div>
                    <div style="font-size:10px;color:var(--text-dim);">Ù£Ù©% Ù…Ù† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
                </div>
                <div style="background:var(--bg-surface-2);border-radius:var(--radius-sm);padding:16px;text-align:center;">
                    <div style="font-size:11px;color:var(--text-muted);margin-bottom:6px;">Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ù„ÙƒÙ„ Ø±ÙŠØ§Ù„ (ROI)</div>
                    <div style="font-size:24px;font-weight:800;color:var(--success);direction:ltr;display:inline-block;">Ù¤Ù£x</div>
                    <div style="font-size:10px;color:var(--text-dim);">ÙƒÙ„ Ù¡ Ø±.Ø³ â†’ Ù¤Ù£ Ø±.Ø³</div>
                </div>
            </div>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ù…Ø­Ø±Ùƒ</th>
                            <th>Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</th>
                            <th>Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</th>
                            <th>Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</th>
                            <th>Ø§Ù„ØªØ­ÙˆÙŠÙ„</th>
                            <th>Ø§Ù„Ø¹Ø§Ø¦Ø¯/Ø±Ø³Ø§Ù„Ø©</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span style="display:flex;align-items:center;gap:8px;">ğŸ›’ <strong style="color:var(--text)">Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„Ø³Ù„Ø§Øª</strong></span></td>
                            <td>Ù£,Ù¤Ù¥Ù </td>
                            <td>Ù©Ù¨Ù </td>
                            <td><strong style="color:var(--primary)">Ù¡Ù¢,Ù¤Ù Ù  Ø±.Ø³</strong></td>
                            <td><span class="badge badge-success">Ù¢Ù¨.Ù¤%</span></td>
                            <td>Ù£.Ù¥Ù© Ø±.Ø³</td>
                        </tr>
                        <tr>
                            <td><span style="display:flex;align-items:center;gap:8px;">ğŸ’¤ <strong style="color:var(--text)">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙ†Ø´ÙŠØ·</strong></span></td>
                            <td>Ù¨Ù©Ù </td>
                            <td>Ù¡Ù¥Ù¦</td>
                            <td><strong style="color:var(--primary)">Ù¨,Ù£Ù Ù  Ø±.Ø³</strong></td>
                            <td><span class="badge badge-warning">Ù¡Ù§.Ù¥%</span></td>
                            <td>Ù©.Ù£Ù£ Ø±.Ø³</td>
                        </tr>
                        <tr>
                            <td><span style="display:flex;align-items:center;gap:8px;">ğŸ‘‹ <strong style="color:var(--text)">ØªØ±Ø­ÙŠØ¨ Ø§Ù„Ø¬Ø¯Ø¯</strong></span></td>
                            <td>Ù¡,Ù¢Ù Ù </td>
                            <td>Ù£Ù¤Ù </td>
                            <td><strong style="color:var(--primary)">Ù¥,Ù¢Ù Ù  Ø±.Ø³</strong></td>
                            <td><span class="badge badge-success">Ù¢Ù¨.Ù£%</span></td>
                            <td>Ù¤.Ù£Ù£ Ø±.Ø³</td>
                        </tr>
                        <tr>
                            <td><span style="display:flex;align-items:center;gap:8px;">â­ <strong style="color:var(--text)">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</strong></span></td>
                            <td>Ù¦Ù¥Ù </td>
                            <td>Ù©Ù¨</td>
                            <td><strong style="color:var(--primary)">Ù£,Ù¡Ù Ù  Ø±.Ø³</strong></td>
                            <td><span class="badge badge-info">Ù¡Ù¥.Ù¡%</span></td>
                            <td>Ù¤.Ù§Ù§ Ø±.Ø³</td>
                        </tr>
                        <tr>
                            <td><span style="display:flex;align-items:center;gap:8px;">ğŸ“£ <strong style="color:var(--text)">Ø§Ù„Ø­Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ©</strong></span></td>
                            <td>Ù¢,Ù¨Ù Ù </td>
                            <td>Ù¥Ù¢Ù </td>
                            <td><strong style="color:var(--primary)">Ù¡Ù¨,Ù¢Ù Ù  Ø±.Ø³</strong></td>
                            <td><span class="badge badge-success">Ù¡Ù¨.Ù¦%</span></td>
                            <td>Ù¦.Ù¥Ù  Ø±.Ø³</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <script src="shared/shell.js"></script>
    <script>
        RibhShell.init('analytics');

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           Demo Data Generation
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        let currentRange = 30;

        const arabicDayNames = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];
        const arabicMonthNames = ['ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ', 'ÙŠÙˆÙ„ÙŠÙˆ', 'Ø£ØºØ³Ø·Ø³', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'];

        function generateRevenueData(days) {
            const values = [];
            const labels = [];
            const now = new Date();
            const baseValue = 1200;
            const trendPerDay = 15;

            for (let i = days - 1; i >= 0; i--) {
                const date = new Date(now);
                date.setDate(date.getDate() - i);

                // Slight upward trend + noise
                const trend = trendPerDay * (days - i);
                const noise = (Math.random() - 0.4) * 800;
                const weekendBoost = (date.getDay() === 4 || date.getDay() === 5) ? 400 : 0;
                const val = Math.max(800, Math.round(baseValue + trend + noise + weekendBoost));
                values.push(Math.min(val, 3500));

                const dayNum = date.getDate();
                const monthName = arabicMonthNames[date.getMonth()];
                labels.push(dayNum + ' ' + monthName);
            }
            return { values, labels };
        }

        // Channel data
        const channelData = {
            whatsapp: {
                name: 'ÙˆØ§ØªØ³Ø§Ø¨',
                badge: 'badge-whatsapp',
                sent: 9720,
                delivered: 9430,
                opened: 8250,
                converted: 3110,
                revenue: 37300,
                color: '#25D366'
            },
            email: {
                name: 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ',
                badge: 'badge-info',
                sent: 1870,
                delivered: 1720,
                opened: 890,
                converted: 336,
                revenue: 7200,
                color: '#3B82F6'
            },
            sms: {
                name: 'Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù‚ØµÙŠØ±Ø©',
                badge: 'badge-warning',
                sent: 860,
                delivered: 810,
                opened: 650,
                converted: 103,
                revenue: 3350,
                color: '#F59E0B'
            }
        };

        // Funnel data
        const funnelSteps = [
            { label: 'Ø§Ù„Ø³Ù„Ø§Øª Ø§Ù„Ù…ØªØ±ÙˆÙƒØ©', count: 1200, icon: 'shopping-cart' },
            { label: 'Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø±Ø³Ù„Ø©', count: 980, icon: 'send' },
            { label: 'Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…ÙØªÙˆØ­Ø©', count: 850, icon: 'mail-open' },
            { label: 'Ø§Ù„Ù†Ù‚Ø±Ø§Øª', count: 420, icon: 'mouse-pointer-click' },
            { label: 'Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª', count: 234, icon: 'check-circle' }
        ];

        // Best messages data
        const topMessages = [
            {
                preview: 'Ù…Ø±Ø­Ø¨Ø§Ù‹! Ù„Ø§Ø­Ø¸Ù†Ø§ Ø£Ù†Ùƒ ØªØ±ÙƒØª Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø³Ù„ØªÙƒ. Ø§Ø³ØªØ®Ø¯Ù… ÙƒÙˆØ¯ RIBH15 Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø®ØµÙ… Ù¡Ù¥Ùª',
                flow: 'Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ù…ØªØ±ÙˆÙƒØ©',
                sent: 3450,
                conversion: 28.4,
                revenue: 18200
            },
            {
                preview: 'Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…ØªØ¬Ø±Ù†Ø§! ÙƒÙ‡Ø¯ÙŠØ© ØªØ±Ø­ÙŠØ¨ÙŠØ©ØŒ Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø´Ø­Ù† Ù…Ø¬Ø§Ù†ÙŠ Ù„Ø·Ù„Ø¨Ùƒ Ø§Ù„Ø£ÙˆÙ„',
                flow: 'ØªØ±Ø­ÙŠØ¨ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯',
                sent: 1200,
                conversion: 24.1,
                revenue: 8900
            },
            {
                preview: 'Ø´ÙƒØ±Ø§Ù‹ Ù„Ø·Ù„Ø¨Ùƒ! Ù‡Ù„ ØªØ¹Ù„Ù… Ø£Ù† Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø°ÙŠ Ø§Ø´ØªØ±ÙŠØªÙ‡ ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†ØªØ¬Ø§ØªØŸ',
                flow: 'Ù…Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø´Ø±Ø§Ø¡',
                sent: 2100,
                conversion: 20.0,
                revenue: 7600
            },
            {
                preview: 'Ø§Ø´ØªÙ‚Ù†Ø§ Ù„Ùƒ! Ø¹Ø¯ Ø§Ù„Ø¢Ù† ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø®ØµÙ… Ù¢Ù Ùª Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª. Ø§Ù„Ø¹Ø±Ø¶ Ø³Ø§Ø±ÙŠ Ù„Ù…Ø¯Ø© Ù¤Ù¨ Ø³Ø§Ø¹Ø©',
                flow: 'Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡',
                sent: 890,
                conversion: 17.5,
                revenue: 5400
            },
            {
                preview: 'Ø®Ø¨Ø± Ø³Ø§Ø±! Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø°ÙŠ ÙƒÙ†Øª ØªØ¨Ø­Ø« Ø¹Ù†Ù‡ Ø£ØµØ¨Ø­ Ù…ØªÙˆÙØ±Ø§Ù‹ Ø§Ù„Ø¢Ù† ÙˆØ¨Ø³Ø¹Ø± Ø£Ù‚Ù„',
                flow: 'ØªØ®ÙÙŠØ¶ Ø§Ù„Ø³Ø¹Ø±',
                sent: 670,
                conversion: 30.0,
                revenue: 6200
            }
        ];

        // KPI multipliers per range
        const rangeMultipliers = {
            7: { revenue: 0.25, factor: 0.8 },
            30: { revenue: 1, factor: 1 },
            90: { revenue: 2.8, factor: 1.15 },
            365: { revenue: 10.5, factor: 1.3 }
        };

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           Render Functions
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        function switchRange(days) {
            currentRange = days;
            // Update active tab
            document.querySelectorAll('#timeRangeTabs .tab').forEach(tab => {
                tab.classList.toggle('active', parseInt(tab.dataset.range) === days);
            });
            renderAll();
        }

        function renderAll() {
            renderKPIs();
            renderRevenueChart();
            renderChannelChart();
            renderChannelTable();
            renderFlowBars();
            renderSegmentDonut();
            renderFunnel();
            renderMessagesTable();
            if (typeof lucide !== 'undefined') lucide.createIcons();
        }

        function toArabicNum(n) {
            const arabicDigits = ['Ù ', 'Ù¡', 'Ù¢', 'Ù£', 'Ù¤', 'Ù¥', 'Ù¦', 'Ù§', 'Ù¨', 'Ù©'];
            return String(n).replace(/\d/g, d => arabicDigits[d]);
        }

        function formatAR(n) {
            return toArabicNum(n.toLocaleString('en-US'));
        }

        /* â”€â”€ KPIs â”€â”€ */
        function renderKPIs() {
            const m = rangeMultipliers[currentRange];
            const rev = Math.round(47850 * m.revenue);
            const conv = (28.5 * m.factor).toFixed(1);
            const aov = Math.round(205 * m.factor);
            const roi = Math.round(63 * m.factor);

            document.getElementById('kpiRevenue').textContent = formatAR(rev) + ' Ø±.Ø³';
            document.getElementById('kpiConversion').textContent = toArabicNum(conv) + '%';
            document.getElementById('kpiAOV').textContent = formatAR(aov) + ' Ø±.Ø³';
            document.getElementById('kpiROI').textContent = toArabicNum(roi) + 'x';
        }

        /* â”€â”€ Revenue Chart â”€â”€ */
        function renderRevenueChart() {
            const data = generateRevenueData(currentRange);
            RibhCharts.drawLineChart('revenueChart', data, { color: '#10B981' });
        }

        /* â”€â”€ Channel Bar Chart â”€â”€ */
        function renderChannelChart() {
            const channels = Object.values(channelData);
            const m = rangeMultipliers[currentRange];
            RibhCharts.drawBarChart('channelChart', {
                values: channels.map(c => Math.round(c.converted * m.revenue)),
                labels: channels.map(c => c.name),
                colors: channels.map(c => c.color)
            });
        }

        /* â”€â”€ Channel Table â”€â”€ */
        function renderChannelTable() {
            const tbody = document.getElementById('channelTableBody');
            const m = rangeMultipliers[currentRange];
            let html = '';
            Object.values(channelData).forEach(ch => {
                const sent = Math.round(ch.sent * m.revenue);
                const delivered = Math.round(ch.delivered * m.revenue);
                const opened = Math.round(ch.opened * m.revenue);
                const converted = Math.round(ch.converted * m.revenue);
                const rev = Math.round(ch.revenue * m.revenue);
                const convRate = ((converted / sent) * 100).toFixed(1);
                html += `<tr>
                    <td><span class="badge ${ch.badge}">${ch.name}</span></td>
                    <td>${formatAR(sent)}</td>
                    <td>${formatAR(delivered)}</td>
                    <td>${formatAR(opened)}</td>
                    <td><span class="font-bold" style="color:var(--primary)">${toArabicNum(convRate)}%</span></td>
                    <td style="font-weight:700;color:var(--text)">${formatAR(rev)} Ø±.Ø³</td>
                </tr>`;
            });
            tbody.innerHTML = html;
        }

        /* â”€â”€ Flow Bars â”€â”€ */
        function renderFlowBars() {
            const container = document.getElementById('flowBars');
            const flows = RibhAPI.demo.flows
                .filter(f => f.revenue > 0)
                .sort((a, b) => b.revenue - a.revenue);
            const maxRevenue = flows[0]?.revenue || 1;
            const m = rangeMultipliers[currentRange];

            let html = '';
            flows.forEach(flow => {
                const rev = Math.round(flow.revenue * m.revenue);
                const pct = ((flow.revenue / maxRevenue) * 100).toFixed(0);
                html += `<div class="hbar-item">
                    <div class="hbar-top">
                        <span class="hbar-name">${flow.name}</span>
                        <span class="hbar-value">${formatAR(rev)} Ø±.Ø³</span>
                    </div>
                    <div class="hbar-track">
                        <div class="hbar-fill" style="width:${pct}%"></div>
                    </div>
                </div>`;
            });
            container.innerHTML = html;
        }

        /* â”€â”€ Segment Donut â”€â”€ */
        function renderSegmentDonut() {
            const segments = RibhAPI.demo.segments;
            const totalRevenue = segments.reduce((sum, s) => sum + s.revenue, 0);

            RibhCharts.drawDonut('segmentDonut', {
                values: segments.map(s => s.revenue),
                colors: segments.map(s => s.color),
                centerText: formatAR(totalRevenue),
                centerSub: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª'
            });

            const legend = document.getElementById('segmentLegend');
            let html = '';
            segments.forEach(seg => {
                const pct = ((seg.revenue / totalRevenue) * 100).toFixed(1);
                html += `<div class="donut-legend-item">
                    <div class="donut-legend-dot" style="background:${seg.color}"></div>
                    <div class="donut-legend-name">${seg.name}</div>
                    <div class="donut-legend-meta">
                        <span>${formatAR(seg.count)} Ø¹Ù…ÙŠÙ„</span>
                        <span>${formatAR(seg.revenue)} Ø±.Ø³</span>
                    </div>
                    <div class="donut-legend-pct">${toArabicNum(pct)}%</div>
                </div>`;
            });
            legend.innerHTML = html;
        }

        /* â”€â”€ Funnel â”€â”€ */
        function renderFunnel() {
            const container = document.getElementById('funnelWrap');
            const widths = [100, 85, 74, 50, 35];
            let html = '';

            funnelSteps.forEach((step, i) => {
                html += `<div class="funnel-step">
                    <div class="funnel-bar" style="width:${widths[i]}%;background:rgba(16,185,129,${0.18 - i * 0.025});">
                        <i data-lucide="${step.icon}" style="width:20px;height:20px;color:var(--primary);opacity:0.8"></i>
                        <span class="funnel-bar-label">${step.label}</span>
                        <span class="funnel-bar-count">${formatAR(step.count)}</span>
                    </div>`;

                if (i < funnelSteps.length - 1) {
                    const convPct = ((funnelSteps[i + 1].count / step.count) * 100).toFixed(1);
                    html += `<div class="funnel-connector">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                        <span class="funnel-connector-pct">${toArabicNum(convPct)}%</span>
                    </div>`;
                }

                html += `</div>`;
            });
            container.innerHTML = html;
        }

        /* â”€â”€ Messages Table â”€â”€ */
        function renderMessagesTable() {
            const tbody = document.getElementById('messagesTableBody');
            const m = rangeMultipliers[currentRange];
            let html = '';
            topMessages.forEach(msg => {
                const sent = Math.round(msg.sent * m.revenue);
                const rev = Math.round(msg.revenue * m.revenue);
                html += `<tr>
                    <td><div class="msg-preview">${msg.preview}</div></td>
                    <td><span class="badge badge-primary">${msg.flow}</span></td>
                    <td>${formatAR(sent)}</td>
                    <td><span class="font-bold" style="color:var(--primary)">${toArabicNum(msg.conversion.toFixed(1))}%</span></td>
                    <td style="font-weight:700;color:var(--text)">${formatAR(rev)} Ø±.Ø³</td>
                </tr>`;
            });
            tbody.innerHTML = html;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           Init & Resize
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        renderAll();

        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                renderRevenueChart();
                renderChannelChart();
                renderSegmentDonut();
            }, 200);
        });
    </script>
</body>
</html>
