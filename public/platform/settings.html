<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª | Ø±ÙØ¨Ø­</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/platform/shared/shell.css">
</head>
<body>

<div id="page-content">
    <div class="page-header">
        <h1 class="page-title">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h1>
        <p class="page-subtitle">Ø¥Ø¯Ø§Ø±Ø© Ù…ØªØ¬Ø±Ùƒ ÙˆØ­Ø³Ø§Ø¨Ùƒ</p>
    </div>

    <div class="settings-layout">
        <!-- Settings Nav -->
        <div class="settings-nav">
            <button class="settings-tab active" data-section="store">ğŸª Ø§Ù„Ù…ØªØ¬Ø±</button>
            <button class="settings-tab" data-section="whatsapp">ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨</button>
            <button class="settings-tab" data-section="messaging">ğŸ“± Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</button>
            <button class="settings-tab" data-section="integrations">ğŸ”— Ø§Ù„ØªÙƒØ§Ù…Ù„Ø§Øª</button>
            <button class="settings-tab" data-section="billing">ğŸ’³ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</button>
            <button class="settings-tab" data-section="team">ğŸ‘¥ Ø§Ù„ÙØ±ÙŠÙ‚</button>
        </div>

        <!-- Settings Content -->
        <div class="settings-content">

            <!-- Store Settings -->
            <div class="settings-section active" id="section-store">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±</div>
                    </div>
                    <div class="input-group">
                        <label class="input-label">Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±</label>
                        <input type="text" class="input" id="storeName" placeholder="Ø§Ø³Ù… Ù…ØªØ¬Ø±Ùƒ">
                    </div>
                    <div class="input-group">
                        <label class="input-label">Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ØªØ¬Ø±</label>
                        <input type="url" class="input" id="storeUrl" placeholder="https://store.salla.sa" dir="ltr">
                    </div>
                    <div class="input-group">
                        <label class="input-label">Ù†ÙˆØ¹ Ø§Ù„Ù†Ø´Ø§Ø·</label>
                        <select class="input" id="storeType">
                            <option value="ecommerce">Ù…ØªØ¬Ø± Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</option>
                            <option value="cafe">Ù…Ù‚Ù‡Ù‰</option>
                            <option value="restaurant">Ù…Ø·Ø¹Ù…</option>
                            <option value="fashion">Ù…Ø­Ù„ Ø£Ø²ÙŠØ§Ø¡</option>
                            <option value="salon">ØµØ§Ù„ÙˆÙ†</option>
                            <option value="retail">Ù…Ø­Ù„ ØªØ¬Ø²Ø¦Ø©</option>
                            <option value="other">Ø£Ø®Ø±Ù‰</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label class="input-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <input type="email" class="input" id="storeEmail" placeholder="email@store.com" dir="ltr">
                    </div>
                    <button class="btn btn-primary" onclick="saveStoreSettings()">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
                </div>
            </div>

            <!-- WhatsApp Settings -->
            <div class="settings-section" id="section-whatsapp">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Ø§ØªØµØ§Ù„ ÙˆØ§ØªØ³Ø§Ø¨</div>
                    </div>
                    <div class="wa-status-card" id="waStatusCard">
                        <div class="wa-status-indicator">
                            <span class="status-dot online" id="waSettingsStatus"></span>
                            <span class="wa-status-text" id="waStatusText">Ù…ØªØµÙ„</span>
                        </div>
                        <div class="wa-status-number" id="waNumber">+966 5X XXX XXXX</div>
                    </div>

                    <div class="mt-24" id="waQrSection" style="display: none;">
                        <p class="text-muted mb-16">Ø§Ù…Ø³Ø­ ÙƒÙˆØ¯ QR Ù…Ù† ÙˆØ§ØªØ³Ø§Ø¨ Ø¹Ù„Ù‰ ØªÙ„ÙÙˆÙ†Ùƒ</p>
                        <div class="qr-placeholder" id="waQrCode">
                            <div class="empty-state-icon">ğŸ“±</div>
                            <div class="text-sm text-dim">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ QR...</div>
                        </div>
                    </div>

                    <div class="mt-24">
                        <button class="btn btn-secondary" id="waReconnectBtn" onclick="reconnectWhatsApp()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„</button>
                        <button class="btn btn-danger btn-sm" style="margin-right: 8px;" onclick="disconnectWhatsApp()">Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„</button>
                    </div>
                </div>

                <div class="card mt-24">
                    <div class="card-header">
                        <div class="card-title">Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø±Ù‚Ù…</div>
                    </div>
                    <div class="setting-row">
                        <div class="setting-info">
                            <div class="setting-name">Ø³Ø§Ø¹Ø§Øª Ù‡Ø§Ø¯Ø¦Ø©</div>
                            <div class="setting-desc">Ø¹Ø¯Ù… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„ Ø¨ÙŠÙ† 10 Ù…Ø³Ø§Ø¡Ù‹ Ùˆ 8 ØµØ¨Ø§Ø­Ø§Ù‹</div>
                        </div>
                        <label class="toggle"><input type="checkbox" checked><span class="toggle-slider"></span></label>
                    </div>
                    <div class="setting-row">
                        <div class="setting-info">
                            <div class="setting-name">Ø­Ø¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</div>
                            <div class="setting-desc">3 Ø±Ø³Ø§Ø¦Ù„ ÙˆØ§ØªØ³Ø§Ø¨ + 2 SMS ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰ Ù„ÙƒÙ„ Ø¹Ù…ÙŠÙ„</div>
                        </div>
                        <label class="toggle"><input type="checkbox" checked><span class="toggle-slider"></span></label>
                    </div>
                    <div class="setting-row">
                        <div class="setting-info">
                            <div class="setting-name">ØªØ£Ø®ÙŠØ± Ø¨Ø´Ø±ÙŠ</div>
                            <div class="setting-desc">ØªØ£Ø®ÙŠØ± Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø¨ÙŠÙ† Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù„ØªØ¨Ø¯Ùˆ Ø·Ø¨ÙŠØ¹ÙŠØ©</div>
                        </div>
                        <label class="toggle"><input type="checkbox" checked><span class="toggle-slider"></span></label>
                    </div>
                </div>
            </div>

            <!-- Messaging Settings -->
            <div class="settings-section" id="section-messaging">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</div>
                    </div>
                    <div class="setting-row">
                        <div class="setting-info">
                            <div class="setting-name">Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</div>
                            <div class="setting-desc">ØªØ®ØµÙŠØµ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø§Ù„Ù€ AI Ù„ÙƒÙ„ Ø¹Ù…ÙŠÙ„</div>
                        </div>
                        <label class="toggle"><input type="checkbox" checked><span class="toggle-slider"></span></label>
                    </div>
                    <div class="setting-row">
                        <div class="setting-info">
                            <div class="setting-name">Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª A/B</div>
                            <div class="setting-desc">Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø³Ø®ØªÙŠÙ† Ù…Ù† ÙƒÙ„ Ø±Ø³Ø§Ù„Ø© ÙˆØ§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£ÙØ¶Ù„</div>
                        </div>
                        <label class="toggle"><input type="checkbox" checked><span class="toggle-slider"></span></label>
                    </div>
                    <div class="setting-row">
                        <div class="setting-info">
                            <div class="setting-name">ØªÙˆÙ‚ÙŠØª Ø°ÙƒÙŠ</div>
                            <div class="setting-desc">Ø¥Ø±Ø³Ø§Ù„ Ù„ÙƒÙ„ Ø¹Ù…ÙŠÙ„ ÙÙŠ ÙˆÙ‚ØªÙ‡ Ø§Ù„Ù…ÙØ¶Ù„</div>
                        </div>
                        <label class="toggle"><input type="checkbox"><span class="toggle-slider"></span></label>
                    </div>
                </div>

                <div class="card mt-24">
                    <div class="card-header">
                        <div class="card-title">Ù†Ø¨Ø±Ø© Ø§Ù„Ù…ØªØ¬Ø±</div>
                        <div class="card-subtitle">ÙƒÙŠÙ ØªØ¨ÙŠ Ø±Ø³Ø§Ø¦Ù„Ùƒ ØªØ¨Ø§Ù†ØŸ</div>
                    </div>
                    <div class="input-group">
                        <label class="input-label">Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„ÙƒØªØ§Ø¨Ø©</label>
                        <select class="input">
                            <option value="casual">ÙˆØ¯ÙŠ ÙˆÙ‚Ø±ÙŠØ¨ ğŸ˜Š</option>
                            <option value="professional">Ø±Ø³Ù…ÙŠ ÙˆÙ…Ø­ØªØ±Ù</option>
                            <option value="fun">Ù…Ø±Ø­ ÙˆØ®ÙÙŠÙ ğŸ‰</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label class="input-label">Ù…Ø«Ø§Ù„ Ø¹Ù„Ù‰ Ø±Ø³Ø§Ù„Ø© Ø¨Ø£Ø³Ù„ÙˆØ¨Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                        <textarea class="input" rows="3" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© ÙƒÙ…Ø§ ØªÙƒØªØ¨Ù‡Ø§ Ø¹Ø§Ø¯Ø© Ù„Ø¹Ù…Ù„Ø§Ø¦Ùƒ..."></textarea>
                    </div>
                </div>
            </div>

            <!-- Integrations -->
            <div class="settings-section" id="section-integrations">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Ø§Ù„ØªÙƒØ§Ù…Ù„Ø§Øª</div>
                    </div>
                    <div class="integration-row">
                        <div class="integration-info">
                            <span class="integration-icon-lg">ğŸŸ£</span>
                            <div>
                                <div class="setting-name">Ø³Ù„Ø©</div>
                                <div class="setting-desc">Ù…Ù†ØµØ© Ø§Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</div>
                            </div>
                        </div>
                        <span class="badge badge-success">Ù…ØªØµÙ„</span>
                    </div>
                    <div class="integration-row">
                        <div class="integration-info">
                            <span class="integration-icon-lg">ğŸŸ¢</span>
                            <div>
                                <div class="setting-name">Ø´ÙˆØ¨ÙŠÙØ§ÙŠ</div>
                                <div class="setting-desc">Ù…Ù†ØµØ© Ø§Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</div>
                            </div>
                        </div>
                        <a href="/shopify/install" class="btn btn-secondary btn-sm">Ø±Ø¨Ø·</a>
                    </div>
                    <div class="integration-row">
                        <div class="integration-info">
                            <span class="integration-icon-lg">ğŸ’¬</span>
                            <div>
                                <div class="setting-name">ÙˆØ§ØªØ³Ø§Ø¨</div>
                                <div class="setting-desc">Ø§Ù„Ù‚Ù†Ø§Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„ØªÙˆØ§ØµÙ„</div>
                            </div>
                        </div>
                        <span class="badge badge-success">Ù…ØªØµÙ„</span>
                    </div>
                    <div class="integration-row">
                        <div class="integration-info">
                            <span class="integration-icon-lg">ğŸ“²</span>
                            <div>
                                <div class="setting-name">SMS</div>
                                <div class="setting-desc">Ø§Ù„Ù‚Ù†Ø§Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</div>
                            </div>
                        </div>
                        <span class="badge badge-success">Ù…ÙØ¹Ù‘Ù„</span>
                    </div>
                </div>
            </div>

            <!-- Billing -->
            <div class="settings-section" id="section-billing">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
                    </div>
                    <div class="plan-card">
                        <div class="plan-header">
                            <div>
                                <div class="plan-name">Ø¨Ø§Ù‚Ø© Ø§Ù„Ù†Ù…Ùˆ</div>
                                <div class="plan-price">399 Ø±.Ø³<span class="text-dim">/Ø´Ù‡Ø±</span></div>
                            </div>
                            <span class="badge badge-primary">Ù†Ø´Ø·</span>
                        </div>
                        <div class="plan-usage">
                            <div class="plan-usage-label">
                                <span>Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©</span>
                                <span>1,420 / 2,000</span>
                            </div>
                            <div class="plan-usage-bar"><div class="plan-usage-fill" style="width: 71%"></div></div>
                        </div>
                        <div class="plan-features">
                            <div class="plan-feature">âœ“ 7 Ø±Ø­Ù„Ø§Øª Ø¹Ù…Ù„Ø§Ø¡</div>
                            <div class="plan-feature">âœ“ QR Ù„Ù„Ù…Ø­Ù„Ø§Øª</div>
                            <div class="plan-feature">âœ“ ØªØµÙ†ÙŠÙ Ø°ÙƒÙŠ</div>
                            <div class="plan-feature">âœ“ A/B + ØªÙˆÙ‚ÙŠØª Ø°ÙƒÙŠ</div>
                        </div>
                    </div>
                    <div class="mt-16 flex gap-12">
                        <a href="/pricing.html" class="btn btn-secondary btn-sm">ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø¨Ø§Ù‚Ø©</a>
                        <button class="btn btn-ghost btn-sm text-danger">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</button>
                    </div>
                </div>
            </div>

            <!-- Team -->
            <div class="settings-section" id="section-team">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Ø§Ù„ÙØ±ÙŠÙ‚</div>
                        <button class="btn btn-primary btn-sm">+ Ø¯Ø¹ÙˆØ© Ø¹Ø¶Ùˆ</button>
                    </div>
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ‘¥</div>
                        <div class="empty-state-title">Ø£Ù†Øª Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„ÙˆØ­ÙŠØ¯</div>
                        <div class="empty-state-desc">Ø§Ø¯Ø¹Ù Ø£Ø¹Ø¶Ø§Ø¡ ÙØ±ÙŠÙ‚Ùƒ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ù…Ù„Ø§Øª ÙˆØ§Ù„Ø±Ø³Ø§Ø¦Ù„</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .settings-layout {
        display: grid;
        grid-template-columns: 200px 1fr;
        gap: 24px;
    }

    .settings-nav {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .settings-tab {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 14px;
        background: none;
        border: none;
        border-radius: var(--radius-sm);
        font-size: 14px;
        font-weight: 500;
        color: var(--text-muted);
        cursor: pointer;
        text-align: right;
        font-family: inherit;
        transition: all 0.15s;
    }
    .settings-tab:hover { background: var(--bg-hover); color: var(--text); }
    .settings-tab.active { background: var(--primary-subtle); color: var(--primary); font-weight: 600; }

    .settings-section { display: none; }
    .settings-section.active { display: block; }

    .setting-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px 0;
        border-bottom: 1px solid var(--border);
    }
    .setting-row:last-child { border-bottom: none; }
    .setting-name { font-size: 14px; font-weight: 600; }
    .setting-desc { font-size: 13px; color: var(--text-dim); margin-top: 2px; }

    .integration-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px 0;
        border-bottom: 1px solid var(--border);
    }
    .integration-row:last-child { border-bottom: none; }
    .integration-info { display: flex; align-items: center; gap: 14px; }
    .integration-icon-lg { font-size: 28px; }

    .wa-status-card {
        padding: 20px;
        background: var(--bg-elevated);
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
    }
    .wa-status-indicator { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
    .wa-status-text { font-size: 14px; font-weight: 600; }
    .wa-status-number { font-size: 16px; color: var(--text-dim); direction: ltr; text-align: right; }

    .qr-placeholder {
        width: 200px;
        height: 200px;
        margin: 0 auto;
        background: var(--bg-elevated);
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }

    .plan-card {
        background: var(--bg-elevated);
        border: 1px solid var(--border-active);
        border-radius: var(--radius-lg);
        padding: 24px;
    }
    .plan-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
    .plan-name { font-size: 18px; font-weight: 700; }
    .plan-price { font-size: 28px; font-weight: 800; margin-top: 4px; }
    .plan-usage { margin-bottom: 16px; }
    .plan-usage-label { display: flex; justify-content: space-between; font-size: 13px; color: var(--text-muted); margin-bottom: 8px; }
    .plan-usage-bar { height: 6px; background: var(--bg-hover); border-radius: 3px; }
    .plan-usage-fill { height: 100%; background: var(--primary); border-radius: 3px; }
    .plan-features { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .plan-feature { font-size: 13px; color: var(--text-muted); }

    @media (max-width: 768px) {
        .settings-layout { grid-template-columns: 1fr; }
        .settings-nav { flex-direction: row; overflow-x: auto; gap: 8px; padding-bottom: 8px; }
        .settings-tab { white-space: nowrap; }
    }
</style>

<script src="/platform/shared/shell.js"></script>
<script>
    // Settings tab switching
    document.querySelectorAll('.settings-tab').forEach(function(tab) {
        tab.addEventListener('click', function() {
            document.querySelectorAll('.settings-tab').forEach(function(t) { t.classList.remove('active'); });
            document.querySelectorAll('.settings-section').forEach(function(s) { s.classList.remove('active'); });
            this.classList.add('active');
            var section = document.getElementById('section-' + this.dataset.section);
            if (section) section.classList.add('active');
        });
    });

    function saveStoreSettings() {
        var name = document.getElementById('storeName').value;
        if (name) localStorage.setItem('ribh_store_name', name);
        alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª');
    }

    function reconnectWhatsApp() {
        document.getElementById('waQrSection').style.display = '';
        fetch('/api/whatsapp/connect').then(function(r) { return r.json(); })
            .then(function(data) {
                if (data.qr) {
                    document.getElementById('waQrCode').innerHTML = '<img src="' + data.qr + '" alt="QR" style="width:200px;height:200px;">';
                }
            }).catch(function() {});
    }

    function disconnectWhatsApp() {
        if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù‚Ø·Ø¹ Ø§ØªØµØ§Ù„ ÙˆØ§ØªØ³Ø§Ø¨ØŸ')) {
            fetch('/api/whatsapp/disconnect', { method: 'POST', credentials: 'include' });
        }
    }

    // Load store settings
    document.addEventListener('DOMContentLoaded', function() {
        var name = localStorage.getItem('ribh_store_name');
        if (name) document.getElementById('storeName').value = name;

        // Check WA status
        fetch('/api/whatsapp/status').then(function(r) { return r.json(); })
            .then(function(data) {
                var dot = document.getElementById('waSettingsStatus');
                var text = document.getElementById('waStatusText');
                if (data.connected) {
                    dot.className = 'status-dot online';
                    text.textContent = 'Ù…ØªØµÙ„';
                } else {
                    dot.className = 'status-dot offline';
                    text.textContent = 'ØºÙŠØ± Ù…ØªØµÙ„';
                }
            }).catch(function() {});
    });
</script>

</body>
</html>
