<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة التحكم | رِبح</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/platform/shared/shell.css">
</head>
<body>
<div id="page-content">

    <!-- 1. Hero Revenue Card -->
    <div class="hero-revenue-card">
        <div class="hero-top">
            <div class="hero-label">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                <span>اجمالي الايرادات المستردة</span>
            </div>
            <span class="badge badge-success">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
                +23% هذا الشهر
            </span>
        </div>
        <div class="hero-value" id="heroRevenue">0 ر.س</div>
        <div class="hero-narrative" id="heroNarrative">
            سلات تم استردادها هذا الشهر: <strong id="recoveredCount">0</strong> من <strong id="totalAbandoned">0</strong> (<strong id="recoveryPct">0</strong>%)
        </div>
        <div class="hero-sparkline" id="heroSparkline">
            <div class="sparkline-label">اخر 7 ايام</div>
            <div class="sparkline-bars">
                <div class="sparkline-day">
                    <div class="sparkline-bar-wrap"><div class="sparkline-bar" data-height="45"></div></div>
                    <span class="sparkline-day-label">س</span>
                </div>
                <div class="sparkline-day">
                    <div class="sparkline-bar-wrap"><div class="sparkline-bar" data-height="62"></div></div>
                    <span class="sparkline-day-label">ح</span>
                </div>
                <div class="sparkline-day">
                    <div class="sparkline-bar-wrap"><div class="sparkline-bar" data-height="38"></div></div>
                    <span class="sparkline-day-label">ن</span>
                </div>
                <div class="sparkline-day">
                    <div class="sparkline-bar-wrap"><div class="sparkline-bar" data-height="80"></div></div>
                    <span class="sparkline-day-label">ث</span>
                </div>
                <div class="sparkline-day">
                    <div class="sparkline-bar-wrap"><div class="sparkline-bar" data-height="55"></div></div>
                    <span class="sparkline-day-label">ر</span>
                </div>
                <div class="sparkline-day">
                    <div class="sparkline-bar-wrap"><div class="sparkline-bar" data-height="93"></div></div>
                    <span class="sparkline-day-label">خ</span>
                </div>
                <div class="sparkline-day">
                    <div class="sparkline-bar-wrap"><div class="sparkline-bar" data-height="70"></div></div>
                    <span class="sparkline-day-label">ج</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 2. KPI Grid -->
    <div class="kpi-grid" id="kpiGrid">
        <div class="kpi-card">
            <div class="kpi-label">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                المشتركين
            </div>
            <div class="kpi-value" id="kpiSubscribers">0</div>
            <div class="kpi-change up" id="kpiSubGrowth">+12% هذا الشهر</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-label">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 2L11 13"/><path d="M22 2l-7 20-4-9-9-4 20-7z"/></svg>
                الرسائل المرسلة
            </div>
            <div class="kpi-value" id="kpiMessages">0</div>
            <div class="kpi-change up">هذا الشهر</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-label">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                معدل القراءة
            </div>
            <div class="kpi-value kpi-value-with-indicator" id="kpiReadRate">
                <span>0%</span>
                <span class="kpi-indicator kpi-indicator-good"></span>
            </div>
            <div class="kpi-change up">اعلى من المتوسط</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-label">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 12 20 22 4 22 4 12"/><rect x="2" y="7" width="20" height="5"/><line x1="12" y1="22" x2="12" y2="7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/></svg>
                معدل التحويل
            </div>
            <div class="kpi-value kpi-value-with-indicator text-primary" id="kpiConversion">
                <span>0%</span>
                <span class="kpi-indicator kpi-indicator-primary"></span>
            </div>
            <div class="kpi-change up">+5% عن الشهر الماضي</div>
        </div>
    </div>

    <!-- 3. AI Insights Card -->
    <div class="ai-insights-card">
        <div class="ai-insights-header">
            <div class="ai-insights-title">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                <span>رؤى ذكية من رِبح</span>
            </div>
            <span class="badge badge-primary">AI</span>
        </div>
        <div class="ai-insights-list" id="aiInsightsList">
            <div class="ai-insight-item">
                <div class="ai-insight-icon ai-insight-icon-info">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                </div>
                <div class="ai-insight-content">
                    <div class="ai-insight-text">عملاء شريحة الابطال يستجيبون اكثر للرسائل الصباحية (8-10 ص)</div>
                </div>
                <a href="/platform/segments.html" class="btn btn-ghost btn-sm">عرض الشريحة</a>
            </div>
            <div class="ai-insight-item">
                <div class="ai-insight-icon ai-insight-icon-success">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
                </div>
                <div class="ai-insight-content">
                    <div class="ai-insight-text">معدل الاسترداد ارتفع 18% بعد تفعيل رسائل المتابعة</div>
                </div>
                <a href="/platform/analytics.html" class="btn btn-ghost btn-sm">التفاصيل</a>
            </div>
            <div class="ai-insight-item">
                <div class="ai-insight-icon ai-insight-icon-warning">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                </div>
                <div class="ai-insight-content">
                    <div class="ai-insight-text">43 عميل معرض للخسارة — تفعيل رحلة الاسترجاع ممكن يرجع <strong>12,000 ر.س</strong></div>
                </div>
                <a href="/platform/journeys.html" class="btn btn-primary btn-sm">فعّل الان</a>
            </div>
        </div>
    </div>

    <!-- 4. Two Column Grid -->
    <div class="grid-2 mt-24">
        <!-- LEFT: Recovery Stories -->
        <div class="card">
            <div class="card-header">
                <div>
                    <div class="card-title">قصص الاسترداد</div>
                    <div class="card-subtitle">اخر السلات المستردة</div>
                </div>
                <div class="recovery-live-dot">
                    <span class="live-pulse"></span>
                    <span class="live-label">مباشر</span>
                </div>
            </div>
            <div class="recovery-stories" id="recoveryStories">
                <div class="recovery-story">
                    <div class="recovery-channel recovery-channel-wa" title="واتساب">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                    </div>
                    <div class="recovery-content">
                        <div class="recovery-text">نورة اشترت سلتها بعد رسالة واتساب الثانية</div>
                        <div class="recovery-meta">
                            <span class="recovery-time">قبل 5 دقائق</span>
                        </div>
                    </div>
                    <div class="recovery-amount">+350 ر.س</div>
                </div>
                <div class="recovery-story">
                    <div class="recovery-channel recovery-channel-wa" title="واتساب">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                    </div>
                    <div class="recovery-content">
                        <div class="recovery-text">محمد رجع واشترى — خصم 10% اقنعه</div>
                        <div class="recovery-meta">
                            <span class="recovery-time">قبل 18 دقيقة</span>
                        </div>
                    </div>
                    <div class="recovery-amount">+520 ر.س</div>
                </div>
                <div class="recovery-story">
                    <div class="recovery-channel recovery-channel-email" title="ايميل">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                    </div>
                    <div class="recovery-content">
                        <div class="recovery-text">سارة فتحت ايميل التذكير واكملت الطلب</div>
                        <div class="recovery-meta">
                            <span class="recovery-time">قبل 42 دقيقة</span>
                        </div>
                    </div>
                    <div class="recovery-amount">+215 ر.س</div>
                </div>
                <div class="recovery-story">
                    <div class="recovery-channel recovery-channel-wa" title="واتساب">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                    </div>
                    <div class="recovery-content">
                        <div class="recovery-text">خالد اشترى سلة بقيمة عالية بعد عرض حصري</div>
                        <div class="recovery-meta">
                            <span class="recovery-time">قبل ساعة</span>
                        </div>
                    </div>
                    <div class="recovery-amount">+1,280 ر.س</div>
                </div>
                <div class="recovery-story">
                    <div class="recovery-channel recovery-channel-sms" title="SMS">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                    </div>
                    <div class="recovery-content">
                        <div class="recovery-text">فاطمة رجعت بعد رسالة SMS التذكيرية</div>
                        <div class="recovery-meta">
                            <span class="recovery-time">قبل ساعتين</span>
                        </div>
                    </div>
                    <div class="recovery-amount">+430 ر.س</div>
                </div>
            </div>
        </div>

        <!-- RIGHT: Active Journeys -->
        <div class="card">
            <div class="card-header">
                <div>
                    <div class="card-title">الرحلات النشطة</div>
                    <div class="card-subtitle">الرحلات اللي تشتغل الحين</div>
                </div>
                <a href="/platform/journeys.html" class="btn btn-ghost btn-sm">عرض الكل</a>
            </div>
            <div id="activeJourneys">
                <div class="journey-item">
                    <div class="journey-icon" style="background: var(--warning-subtle); color: var(--warning);">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
                    </div>
                    <div class="journey-info">
                        <div class="journey-name">استرداد السلات</div>
                        <div class="journey-stat">3 خطوات -- واتساب + ايميل</div>
                    </div>
                    <div class="journey-metric">
                        <span class="journey-metric-value text-success">30%</span>
                        <span class="journey-metric-label">استرداد</span>
                    </div>
                    <span class="badge badge-success">نشط</span>
                </div>
                <div class="journey-item">
                    <div class="journey-icon" style="background: var(--info-subtle); color: var(--info);">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                    </div>
                    <div class="journey-info">
                        <div class="journey-name">رحلة الترحيب</div>
                        <div class="journey-stat">3 خطوات -- واتساب + SMS</div>
                    </div>
                    <div class="journey-metric">
                        <span class="journey-metric-value text-info">68%</span>
                        <span class="journey-metric-label">تفاعل</span>
                    </div>
                    <span class="badge badge-success">نشط</span>
                </div>
                <div class="journey-item">
                    <div class="journey-icon" style="background: var(--success-subtle); color: var(--success);">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="1" y="3" width="15" height="13"/><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"/><circle cx="5.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/></svg>
                    </div>
                    <div class="journey-info">
                        <div class="journey-name">متابعة بعد الشراء</div>
                        <div class="journey-stat">3 خطوات -- واتساب</div>
                    </div>
                    <div class="journey-metric">
                        <span class="journey-metric-value text-success">45%</span>
                        <span class="journey-metric-label">تحويل</span>
                    </div>
                    <span class="badge badge-success">نشط</span>
                </div>
                <div class="journey-item">
                    <div class="journey-icon" style="background: var(--danger-subtle); color: var(--danger);">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
                    </div>
                    <div class="journey-info">
                        <div class="journey-name">استرجاع الغائبين</div>
                        <div class="journey-stat">3 خطوات -- واتساب + SMS</div>
                    </div>
                    <div class="journey-metric">
                        <span class="journey-metric-value text-dim">--</span>
                        <span class="journey-metric-label">مسودة</span>
                    </div>
                    <span class="badge badge-warning">مسودة</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 5. Quick Actions Row -->
    <div class="quick-actions mt-24">
        <a href="/platform/journeys.html" class="quick-action-card">
            <div class="quick-action-icon-wrap quick-action-icon-primary">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
            </div>
            <div class="quick-action-label">انشاء رحلة</div>
            <div class="quick-action-desc">رحلة عملاء جديدة</div>
        </a>
        <a href="/platform/campaigns.html" class="quick-action-card">
            <div class="quick-action-icon-wrap quick-action-icon-info">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 2L11 13"/><path d="M22 2l-7 20-4-9-9-4 20-7z"/></svg>
            </div>
            <div class="quick-action-label">حملة جديدة</div>
            <div class="quick-action-desc">رسالة لشريحة معينة</div>
        </a>
        <a href="/platform/signup-tools.html" class="quick-action-card">
            <div class="quick-action-icon-wrap quick-action-icon-success">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M7 7h10v10H7z"/></svg>
            </div>
            <div class="quick-action-label">انشاء QR</div>
            <div class="quick-action-desc">كود QR لمحلك</div>
        </a>
        <a href="/platform/analytics.html" class="quick-action-card">
            <div class="quick-action-icon-wrap quick-action-icon-warning">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
            </div>
            <div class="quick-action-label">التقارير</div>
            <div class="quick-action-desc">شوف الاداء بالتفصيل</div>
        </a>
    </div>

</div>

<style>
    /* ============================================
       HERO REVENUE CARD
       ============================================ */
    .hero-revenue-card {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--radius-lg);
        padding: 28px 32px;
        margin-bottom: 24px;
        position: relative;
        overflow: hidden;
    }
    .hero-revenue-card::before {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        left: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--success), #16a34a, var(--success));
        opacity: 0.8;
    }
    .hero-top {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 12px;
    }
    .hero-label {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        color: var(--text-muted);
        font-weight: 500;
    }
    .hero-label svg {
        color: var(--success);
        opacity: 0.8;
    }
    .hero-value {
        font-size: 48px;
        font-weight: 800;
        color: var(--success);
        line-height: 1.1;
        margin-bottom: 10px;
        font-variant-numeric: tabular-nums;
    }
    .hero-narrative {
        font-size: 15px;
        color: var(--text-secondary);
        margin-bottom: 20px;
        line-height: 1.7;
    }
    .hero-narrative strong {
        color: var(--text);
        font-weight: 700;
    }

    /* Sparkline */
    .hero-sparkline {
        display: flex;
        align-items: flex-end;
        gap: 16px;
    }
    .sparkline-label {
        font-size: 12px;
        color: var(--text-faint);
        white-space: nowrap;
        padding-bottom: 18px;
    }
    .sparkline-bars {
        display: flex;
        align-items: flex-end;
        gap: 8px;
        flex: 1;
        max-width: 320px;
    }
    .sparkline-day {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 6px;
        flex: 1;
    }
    .sparkline-bar-wrap {
        width: 100%;
        height: 60px;
        display: flex;
        align-items: flex-end;
        justify-content: center;
    }
    .sparkline-bar {
        width: 100%;
        max-width: 32px;
        background: linear-gradient(180deg, var(--success), rgba(34, 197, 94, 0.3));
        border-radius: 4px 4px 0 0;
        height: 0;
        transition: height 1s cubic-bezier(0.22, 1, 0.36, 1);
    }
    .sparkline-day-label {
        font-size: 11px;
        color: var(--text-faint);
        font-weight: 500;
    }

    /* ============================================
       KPI ENHANCEMENTS
       ============================================ */
    .kpi-value-with-indicator {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .kpi-indicator {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        flex-shrink: 0;
    }
    .kpi-indicator-good {
        background: var(--success);
        box-shadow: 0 0 8px rgba(34, 197, 94, 0.5);
    }
    .kpi-indicator-primary {
        background: var(--primary);
        box-shadow: 0 0 8px var(--primary-glow);
    }

    /* ============================================
       AI INSIGHTS CARD
       ============================================ */
    .ai-insights-card {
        background: var(--bg-card);
        border: 1px solid rgba(251, 191, 36, 0.2);
        border-radius: var(--radius-lg);
        padding: 24px;
        margin-bottom: 0;
        position: relative;
        box-shadow: 0 0 30px rgba(251, 191, 36, 0.03), inset 0 0 30px rgba(251, 191, 36, 0.01);
    }
    .ai-insights-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 16px;
    }
    .ai-insights-title {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 16px;
        font-weight: 700;
        color: var(--text);
    }
    .ai-insights-list {
        display: flex;
        flex-direction: column;
        gap: 0;
    }
    .ai-insight-item {
        display: flex;
        align-items: center;
        gap: 14px;
        padding: 14px 0;
        border-bottom: 1px solid var(--border);
    }
    .ai-insight-item:last-child {
        border-bottom: none;
        padding-bottom: 0;
    }
    .ai-insight-item:first-child {
        padding-top: 0;
    }
    .ai-insight-icon {
        width: 38px;
        height: 38px;
        border-radius: var(--radius-sm);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }
    .ai-insight-icon-info {
        background: var(--info-subtle);
        color: var(--info);
    }
    .ai-insight-icon-success {
        background: var(--success-subtle);
        color: var(--success);
    }
    .ai-insight-icon-warning {
        background: var(--warning-subtle);
        color: var(--warning);
    }
    .ai-insight-content {
        flex: 1;
        min-width: 0;
    }
    .ai-insight-text {
        font-size: 14px;
        color: var(--text-secondary);
        line-height: 1.6;
    }
    .ai-insight-text strong {
        color: var(--primary);
        font-weight: 700;
    }

    /* ============================================
       RECOVERY STORIES
       ============================================ */
    .recovery-live-dot {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .live-pulse {
        width: 8px;
        height: 8px;
        background: var(--success);
        border-radius: 50%;
        box-shadow: 0 0 6px var(--success);
        animation: livePulse 2s infinite;
    }
    @keyframes livePulse {
        0%, 100% { opacity: 1; box-shadow: 0 0 6px var(--success); }
        50% { opacity: 0.5; box-shadow: 0 0 12px var(--success); }
    }
    .live-label {
        font-size: 12px;
        color: var(--success);
        font-weight: 600;
    }
    .recovery-stories {
        display: flex;
        flex-direction: column;
    }
    .recovery-story {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 13px 0;
        border-bottom: 1px solid var(--border);
    }
    .recovery-story:last-child { border-bottom: none; }
    .recovery-channel {
        width: 34px;
        height: 34px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }
    .recovery-channel-wa {
        background: rgba(37, 211, 102, 0.12);
        color: #25D366;
    }
    .recovery-channel-email {
        background: var(--info-subtle);
        color: var(--info);
    }
    .recovery-channel-sms {
        background: rgba(168, 85, 247, 0.1);
        color: #A855F7;
    }
    .recovery-content {
        flex: 1;
        min-width: 0;
    }
    .recovery-text {
        font-size: 14px;
        color: var(--text-secondary);
        line-height: 1.5;
    }
    .recovery-meta {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-top: 3px;
    }
    .recovery-time {
        font-size: 12px;
        color: var(--text-faint);
    }
    .recovery-amount {
        font-size: 15px;
        font-weight: 700;
        color: var(--success);
        white-space: nowrap;
        flex-shrink: 0;
    }

    /* ============================================
       JOURNEY ITEMS (updated)
       ============================================ */
    .journey-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 13px 0;
        border-bottom: 1px solid var(--border);
    }
    .journey-item:last-child { border-bottom: none; }
    .journey-icon {
        width: 40px;
        height: 40px;
        border-radius: var(--radius-sm);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }
    .journey-info {
        flex: 1;
        min-width: 0;
    }
    .journey-name {
        font-size: 14px;
        font-weight: 600;
        color: var(--text);
    }
    .journey-stat {
        font-size: 12px;
        color: var(--text-dim);
        margin-top: 2px;
    }
    .journey-metric {
        display: flex;
        flex-direction: column;
        align-items: center;
        flex-shrink: 0;
        margin-left: 4px;
        margin-right: 4px;
    }
    .journey-metric-value {
        font-size: 16px;
        font-weight: 800;
        line-height: 1;
    }
    .journey-metric-label {
        font-size: 11px;
        color: var(--text-faint);
        margin-top: 2px;
    }
    .text-info { color: var(--info); }

    /* ============================================
       QUICK ACTIONS (upgraded)
       ============================================ */
    .quick-actions {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 14px;
    }
    .quick-action-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        gap: 12px;
        padding: 24px 16px;
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--radius-lg);
        transition: all 0.25s ease;
        text-decoration: none;
        color: inherit;
        cursor: pointer;
    }
    .quick-action-card:hover {
        border-color: var(--border-active);
        transform: translateY(-3px);
        box-shadow: var(--shadow-md);
    }
    .quick-action-icon-wrap {
        width: 48px;
        height: 48px;
        border-radius: var(--radius-md);
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .quick-action-icon-primary {
        background: var(--primary-subtle);
        color: var(--primary);
    }
    .quick-action-icon-info {
        background: var(--info-subtle);
        color: var(--info);
    }
    .quick-action-icon-success {
        background: var(--success-subtle);
        color: var(--success);
    }
    .quick-action-icon-warning {
        background: var(--warning-subtle);
        color: var(--warning);
    }
    .quick-action-label {
        font-size: 14px;
        font-weight: 700;
        color: var(--text);
    }
    .quick-action-desc {
        font-size: 12px;
        color: var(--text-dim);
        margin-top: -6px;
    }

    /* ============================================
       RESPONSIVE
       ============================================ */
    @media (max-width: 1024px) {
        .hero-value { font-size: 38px; }
        .quick-actions { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 768px) {
        .hero-revenue-card { padding: 20px; }
        .hero-value { font-size: 32px; }
        .hero-narrative { font-size: 14px; }
        .sparkline-bars { max-width: 100%; }
        .quick-actions { grid-template-columns: repeat(2, 1fr); }
        .ai-insight-item {
            flex-wrap: wrap;
        }
        .ai-insight-item .btn {
            margin-right: 52px;
            margin-top: 4px;
        }
        .journey-metric { display: none; }
    }
    @media (max-width: 480px) {
        .hero-value { font-size: 28px; }
        .quick-actions { grid-template-columns: 1fr; }
        .hero-top { flex-direction: column; align-items: flex-start; gap: 8px; }
    }
</style>

<script src="/platform/shared/shell.js"></script>
<script>
    (function() {
        // Default/sample data in case API fails
        var sampleData = {
            recoveredRevenue: 47850,
            totalSubscribers: 2847,
            subscriberGrowth: 12,
            messagesSent: 1563,
            readRate: 78,
            conversionRate: 30,
            recoveredCarts: 47,
            totalAbandoned: 156,
            weeklyRevenue: [2100, 3200, 1800, 5400, 2900, 6800, 4100]
        };

        // Animate counting up from 0 to target
        function animateCounter(element, target, duration, formatter) {
            var start = 0;
            var startTime = null;

            function step(timestamp) {
                if (!startTime) startTime = timestamp;
                var progress = Math.min((timestamp - startTime) / duration, 1);
                // Ease-out cubic
                var eased = 1 - Math.pow(1 - progress, 3);
                var current = Math.round(start + (target - start) * eased);
                element.textContent = formatter ? formatter(current) : current;
                if (progress < 1) {
                    requestAnimationFrame(step);
                }
            }
            requestAnimationFrame(step);
        }

        // Animate sparkline bars
        function animateSparkline() {
            var bars = document.querySelectorAll('.sparkline-bar');
            bars.forEach(function(bar, i) {
                var height = bar.getAttribute('data-height');
                setTimeout(function() {
                    bar.style.height = height + '%';
                }, 200 + (i * 80));
            });
        }

        // Render the dashboard with data
        function renderDashboard(data) {
            // Hero revenue counter
            var heroEl = document.getElementById('heroRevenue');
            if (heroEl) {
                animateCounter(heroEl, data.recoveredRevenue, 1800, function(n) {
                    return RibhShell.formatSAR(n);
                });
            }

            // Hero narrative
            var recoveredCountEl = document.getElementById('recoveredCount');
            var totalAbandonedEl = document.getElementById('totalAbandoned');
            var recoveryPctEl = document.getElementById('recoveryPct');
            if (recoveredCountEl) recoveredCountEl.textContent = RibhShell.formatNumber(data.recoveredCarts);
            if (totalAbandonedEl) totalAbandonedEl.textContent = RibhShell.formatNumber(data.totalAbandoned);
            if (recoveryPctEl) {
                var pct = data.totalAbandoned > 0 ? Math.round((data.recoveredCarts / data.totalAbandoned) * 100) : 0;
                recoveryPctEl.textContent = pct;
            }

            // KPI cards
            var subEl = document.getElementById('kpiSubscribers');
            if (subEl) {
                animateCounter(subEl, data.totalSubscribers, 1200, function(n) {
                    return RibhShell.formatNumber(n);
                });
            }

            var msgEl = document.getElementById('kpiMessages');
            if (msgEl) {
                animateCounter(msgEl, data.messagesSent, 1200, function(n) {
                    return RibhShell.formatNumber(n);
                });
            }

            var readEl = document.getElementById('kpiReadRate');
            if (readEl) {
                var readSpan = readEl.querySelector('span:first-child');
                if (readSpan) {
                    animateCounter(readSpan, data.readRate, 1000, function(n) {
                        return n + '%';
                    });
                }
            }

            var convEl = document.getElementById('kpiConversion');
            if (convEl) {
                var convSpan = convEl.querySelector('span:first-child');
                if (convSpan) {
                    animateCounter(convSpan, data.conversionRate, 1000, function(n) {
                        return n + '%';
                    });
                }
            }

            // Update sparkline bars with weekly data if provided
            if (data.weeklyRevenue && data.weeklyRevenue.length === 7) {
                var maxVal = Math.max.apply(null, data.weeklyRevenue);
                var bars = document.querySelectorAll('.sparkline-bar');
                bars.forEach(function(bar, i) {
                    if (data.weeklyRevenue[i] !== undefined && maxVal > 0) {
                        var pct = Math.round((data.weeklyRevenue[i] / maxVal) * 100);
                        bar.setAttribute('data-height', Math.max(pct, 8));
                    }
                });
            }

            // Animate sparkline
            animateSparkline();
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Try to load real data from API
            RibhShell.api('/api/stats').then(function(data) {
                if (data && (data.recoveredRevenue !== undefined || data.totalSubscribers !== undefined)) {
                    // Merge API data with defaults for any missing fields
                    var merged = {};
                    for (var key in sampleData) {
                        merged[key] = (data[key] !== undefined && data[key] !== null) ? data[key] : sampleData[key];
                    }
                    renderDashboard(merged);
                } else {
                    renderDashboard(sampleData);
                }
            }).catch(function() {
                // API failed, show sample data
                renderDashboard(sampleData);
            });
        });
    })();
</script>

</body>
</html>
