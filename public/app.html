<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RIBH</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{
            --bg:#09090B;--bg-raised:#18181B;
            --card:#18181B;--card-hover:#1F1F23;
            --border:#27272A;--border-hover:#3F3F46;
            --text:#FAFAFA;--text-secondary:#A1A1AA;--text-muted:#71717A;
            --primary:#10B981;--primary-hover:#059669;--primary-muted:rgba(16,185,129,0.15);
            --secondary:#6366F1;--secondary-muted:rgba(99,102,241,0.15);
            --success:#22C55E;--warning:#F59E0B;--danger:#EF4444;
            --ring:rgba(16,185,129,0.3);
            --radius:12px;--radius-sm:8px;--radius-lg:16px;
            --sidebar-w:220px;
        }
        html{scroll-behavior:smooth;overflow-x:hidden;max-width:100vw}
        html[dir="ltr"]{font-family:'Inter',system-ui,sans-serif}
        html[dir="rtl"]{font-family:'IBM Plex Sans Arabic','Inter',system-ui,sans-serif}
        body{background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;font-size:14px;line-height:1.5;width:100%;max-width:100vw}

        /* ===== SIDEBAR ===== */
        .sidebar{width:var(--sidebar-w);background:var(--bg);border-left:1px solid var(--border);position:fixed;height:100vh;z-index:100;display:flex;flex-direction:column;padding:16px 12px;overflow-y:auto}
        html[dir="rtl"] .sidebar{right:0;border-left:1px solid var(--border);border-right:none}
        html[dir="ltr"] .sidebar{left:0;border-right:1px solid var(--border);border-left:none}
        .sb-logo{display:flex;align-items:center;gap:10px;padding:8px 12px;margin-bottom:24px}
        .sb-logo-mark{width:32px;height:32px;background:linear-gradient(135deg,#10B981,#059669);border-radius:8px;display:flex;align-items:center;justify-content:center}
        .sb-logo-mark svg{color:white}
        .sb-logo-text{font-size:18px;font-weight:700;letter-spacing:-0.02em}
        .sb-section{margin-bottom:20px}
        .sb-section-label{font-size:11px;font-weight:600;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.05em;padding:0 12px;margin-bottom:6px}
        .sb-item{display:flex;align-items:center;gap:10px;padding:9px 12px;border-radius:var(--radius-sm);color:var(--text-secondary);cursor:pointer;transition:all .15s;font-size:13px;font-weight:500;text-decoration:none}
        .sb-item:hover{background:var(--bg-raised);color:var(--text)}
        .sb-item.active{background:var(--primary-muted);color:var(--primary)}
        .sb-item.active svg{color:var(--primary)}
        .sb-item svg{width:18px;height:18px;flex-shrink:0;color:var(--text-muted)}
        .sb-item:hover svg{color:var(--text-secondary)}
        .sb-spacer{flex:1}
        .sb-status{display:flex;align-items:center;gap:8px;padding:10px 12px;border-radius:var(--radius-sm);background:var(--bg-raised);font-size:12px;color:var(--text-secondary);margin-bottom:4px}
        .sb-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0}
        .sb-dot.green{background:var(--success)}
        .sb-dot.pulse{animation:dotPulse 2s infinite}
        .sb-dot.red{background:var(--danger)}
        @keyframes dotPulse{0%,100%{opacity:1}50%{opacity:0.4}}
        .sb-lang{display:flex;align-items:center;gap:8px;padding:9px 12px;border-radius:var(--radius-sm);cursor:pointer;font-size:12px;color:var(--text-muted);transition:all .15s}
        .sb-lang:hover{background:var(--bg-raised);color:var(--text-secondary)}

        /* ===== MAIN ===== */
        .main{padding:24px 28px 80px;position:relative;min-height:100vh}
        html[dir="rtl"] .main{margin-right:var(--sidebar-w)}
        html[dir="ltr"] .main{margin-left:var(--sidebar-w)}
        .page-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:28px}
        .page-title{font-size:22px;font-weight:700;letter-spacing:-0.02em}
        .page-subtitle{font-size:13px;color:var(--text-muted);margin-top:2px}
        .section{margin-bottom:32px;scroll-margin-top:20px}
        .section-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:12px}
        .section-title{font-size:16px;font-weight:600;display:flex;align-items:center;gap:8px;letter-spacing:-0.01em}
        .section-title svg{width:18px;height:18px;color:var(--text-muted)}

        /* ===== BUTTONS ===== */
        .btn{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;border-radius:var(--radius-sm);font-size:13px;font-weight:500;cursor:pointer;transition:all .15s;font-family:inherit;border:none;text-decoration:none}
        .btn-primary{background:var(--primary);color:white}
        .btn-primary:hover{background:var(--primary-hover);transform:translateY(-1px)}
        .btn-outline{background:transparent;border:1px solid var(--border);color:var(--text-secondary)}
        .btn-outline:hover{background:var(--bg-raised);border-color:var(--border-hover);color:var(--text)}
        .btn-ghost{background:transparent;color:var(--text-secondary);padding:8px}
        .btn-ghost:hover{background:var(--bg-raised);color:var(--text)}
        .btn svg{width:16px;height:16px}
        .btn-big{padding:14px 32px;font-size:16px;font-weight:600;border-radius:var(--radius);gap:10px}
        .btn-big svg{width:20px;height:20px}

        /* ===== HERO MONEY CARD ===== */
        .hero{background:linear-gradient(135deg,rgba(16,185,129,0.08),rgba(99,102,241,0.04));border:1px solid rgba(16,185,129,0.25);border-radius:var(--radius-lg);padding:32px;text-align:center;margin-bottom:24px;position:relative;overflow:hidden}
        .hero::before{content:'';position:absolute;top:-50%;right:-50%;width:200%;height:200%;background:radial-gradient(circle,rgba(16,185,129,0.03) 0%,transparent 70%);pointer-events:none}
        .hero-label{font-size:14px;font-weight:500;color:var(--text-secondary);margin-bottom:8px;display:flex;align-items:center;justify-content:center;gap:8px}
        .hero-label svg{width:20px;height:20px;color:var(--primary)}
        .hero-total{font-size:48px;font-weight:700;color:var(--primary);letter-spacing:-0.03em;margin-bottom:4px;line-height:1.1}
        .hero-total .curr{font-size:20px;font-weight:500;color:var(--text-muted)}
        .hero-sub{font-size:13px;color:var(--text-muted);margin-bottom:24px}
        .hero-breakdown{display:flex;flex-direction:column;gap:10px;max-width:440px;margin:0 auto 28px;text-align:right}
        .hero-row{display:flex;align-items:center;justify-content:space-between;padding:10px 16px;background:rgba(255,255,255,0.03);border-radius:var(--radius-sm);border:1px solid rgba(255,255,255,0.04);transition:all .2s}
        .hero-row:hover{background:rgba(255,255,255,0.05);border-color:rgba(255,255,255,0.08)}
        .hero-row-right{display:flex;align-items:center;gap:10px}
        .hero-row-icon{width:32px;height:32px;border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;font-size:15px;flex-shrink:0}
        .hero-row-info{text-align:right}
        .hero-row-count{font-size:13px;font-weight:600}
        .hero-row-desc{font-size:11px;color:var(--text-muted)}
        .hero-row-val{font-size:14px;font-weight:700;color:var(--primary)}
        .hero-cta{margin-bottom:20px}
        .hero-checks{display:flex;align-items:center;justify-content:center;gap:20px;flex-wrap:wrap}
        .hero-check{display:flex;align-items:center;gap:6px;font-size:12px;color:var(--text-secondary)}
        .hero-check svg{width:14px;height:14px;color:var(--primary)}
        @keyframes heroPulse{0%,100%{box-shadow:0 0 0 0 rgba(16,185,129,0.3)}50%{box-shadow:0 0 0 8px rgba(16,185,129,0)}}
        .btn-hero{animation:heroPulse 2.5s ease-in-out infinite}

        /* ===== STATS ROW ===== */
        .stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:24px}
        .stat{background:var(--card);border:1px solid var(--border);border-radius:var(--radius-lg);padding:20px;transition:all .2s}
        .stat:hover{border-color:var(--border-hover)}
        .stat-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
        .stat-label{font-size:13px;font-weight:500;color:var(--text-secondary)}
        .stat-icon{width:36px;height:36px;border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center}
        .stat-icon svg{width:18px;height:18px}
        .stat-icon.green{background:var(--primary-muted);color:var(--primary)}
        .stat-icon.blue{background:rgba(59,130,246,0.15);color:#3B82F6}
        .stat-icon.purple{background:var(--secondary-muted);color:var(--secondary)}
        .stat-icon.orange{background:rgba(245,158,11,0.15);color:var(--warning)}
        .stat-val{font-size:26px;font-weight:700;letter-spacing:-0.02em;line-height:1.1;margin-bottom:6px}
        .stat-trend{display:inline-flex;align-items:center;gap:3px;font-size:12px;font-weight:500;border-radius:20px;padding:2px 8px}
        .stat-trend.up{color:var(--success);background:rgba(34,197,94,0.1)}
        .stat-trend svg{width:12px;height:12px}
        .stat-sparkline{display:flex;align-items:flex-end;gap:2px;height:32px;margin-top:10px}
        .stat-sparkline .bar{flex:1;border-radius:2px;min-height:3px;transition:height .3s}

        /* ===== GRID & CARDS ===== */
        .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
        .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius-lg);padding:20px}

        /* ===== CHART ===== */
        .chart-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius-lg);padding:24px;overflow:hidden}
        .chart-title{font-size:15px;font-weight:600}
        .chart-value{font-size:32px;font-weight:700;letter-spacing:-0.03em;margin-bottom:4px}
        .chart-bars{display:flex;align-items:flex-end;gap:6px;height:120px;padding-top:8px}
        .chart-bars .c-bar{flex:1;border-radius:4px 4px 0 0;position:relative;cursor:pointer;transition:all .4s;min-height:4px}
        .chart-bars .c-bar:hover{opacity:0.8}
        .chart-bars .c-bar .c-tip{position:absolute;top:-26px;left:50%;transform:translateX(-50%);background:var(--text);color:var(--bg);font-size:10px;font-weight:600;padding:2px 6px;border-radius:4px;opacity:0;transition:opacity .2s;white-space:nowrap;pointer-events:none;z-index:10}
        .chart-bars .c-bar:hover .c-tip{opacity:1}
        .chart-labels{display:flex;gap:6px;margin-top:8px}
        .chart-labels span{flex:1;text-align:center;font-size:10px;color:var(--text-muted)}

        /* ===== ACTIVITY ===== */
        .activity-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius-lg);overflow:hidden}
        .activity-item{display:flex;align-items:center;gap:12px;padding:12px 16px;transition:background .15s;border-bottom:1px solid var(--border)}
        .activity-item:last-child{border-bottom:none}
        .activity-item:hover{background:var(--card-hover)}
        .act-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
        .act-dot.green{background:var(--success)}
        .act-dot.blue{background:#3B82F6}
        .act-dot.orange{background:var(--warning)}
        .act-body{flex:1;min-width:0}
        .act-msg{font-size:13px;font-weight:500}
        .act-time{font-size:11px;color:var(--text-muted)}
        .act-amount{font-size:13px;font-weight:600;color:var(--success);white-space:nowrap}

        /* ===== FLOW CARDS ===== */
        .flow-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
        .flow-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;transition:all .25s;position:relative}
        .flow-card:hover{border-color:var(--border-hover)}
        .flow-card.active{border-right:3px solid var(--primary)}
        html[dir="ltr"] .flow-card.active{border-left:3px solid var(--primary);border-right:1px solid var(--border)}
        .flow-top{display:flex;align-items:center;gap:12px;margin-bottom:10px}
        .flow-ico{width:36px;height:36px;border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;flex-shrink:0}
        .flow-ico svg{width:18px;height:18px}
        .flow-info{flex:1;min-width:0}
        .flow-name{font-size:13px;font-weight:600;margin-bottom:2px}
        .flow-desc{font-size:11px;color:var(--text-muted);line-height:1.4}
        .flow-toggle{position:relative;width:44px;height:24px;flex-shrink:0}
        .flow-toggle input{opacity:0;width:0;height:0;position:absolute}
        .flow-toggle .slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:var(--border);border-radius:24px;transition:all .3s}
        .flow-toggle .slider::before{content:'';position:absolute;height:18px;width:18px;border-radius:50%;background:white;bottom:3px;right:3px;transition:all .3s}
        html[dir="ltr"] .flow-toggle .slider::before{left:3px;right:auto}
        .flow-toggle input:checked+.slider{background:var(--primary)}
        .flow-toggle input:checked+.slider::before{transform:translateX(-20px)}
        html[dir="ltr"] .flow-toggle input:checked+.slider::before{transform:translateX(20px)}
        .flow-stats{display:flex;gap:16px;margin-top:10px;padding-top:10px;border-top:1px solid var(--border)}
        .flow-stat{display:flex;align-items:center;gap:4px;font-size:11px;color:var(--text-muted)}
        .flow-stat svg{width:12px;height:12px}
        .flow-stat strong{color:var(--text-secondary);font-weight:600}

        /* ===== CHAT CAMPAIGN CREATOR ===== */
        .chat-creator{background:var(--card);border:1px solid var(--border);border-radius:var(--radius-lg);overflow:hidden;margin-top:16px}
        .chat-header{padding:16px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:10px}
        .chat-header svg{width:18px;height:18px;color:var(--text-muted)}
        .chat-header-title{font-size:14px;font-weight:600}
        .chat-body{padding:16px}
        .chat-input-wrap{display:flex;gap:8px}
        .chat-input{flex:1;padding:10px 14px;background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);color:var(--text);font-size:13px;font-family:inherit;transition:border-color .15s}
        .chat-input:focus{outline:none;border-color:var(--primary)}
        .chat-input::placeholder{color:var(--text-muted)}
        .chat-send{background:var(--primary);color:white;border:none;border-radius:var(--radius-sm);padding:10px 14px;cursor:pointer;transition:all .15s;display:flex;align-items:center}
        .chat-send:hover{background:var(--primary-hover)}
        .chat-send svg{width:16px;height:16px}
        .chat-result{display:none;margin-top:16px;animation:slideUp .3s ease-out}
        .chat-result.show{display:block}
        .chat-preview{background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);padding:14px;margin-bottom:12px;font-size:13px;line-height:1.7;color:var(--text-secondary);white-space:pre-wrap}
        .chat-meta{display:flex;flex-wrap:wrap;gap:12px;margin-bottom:12px}
        .chat-meta-item{display:flex;align-items:center;gap:6px;font-size:12px;color:var(--text-secondary);padding:6px 12px;background:var(--bg);border-radius:20px;border:1px solid var(--border)}
        .chat-meta-item svg{width:14px;height:14px;color:var(--primary)}
        .chat-actions{display:flex;gap:8px;justify-content:flex-end}

        /* ===== SETTINGS ===== */
        .settings-grid{display:flex;flex-direction:column;gap:16px}
        .settings-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius-lg);padding:20px}
        .settings-card-head{display:flex;align-items:center;gap:12px;margin-bottom:16px}
        .settings-card-ico{width:36px;height:36px;border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;flex-shrink:0}
        .settings-card-ico svg{width:18px;height:18px}
        .settings-card-title{font-size:14px;font-weight:600}
        .settings-card-desc{font-size:12px;color:var(--text-muted);margin-top:2px}
        .connect-status{display:flex;align-items:center;gap:8px;padding:10px 14px;border-radius:var(--radius-sm);font-size:13px;font-weight:500}
        .connect-status.connected{background:rgba(34,197,94,0.08);color:var(--success);border:1px solid rgba(34,197,94,0.15)}
        .connect-status.disconnected{background:rgba(239,68,68,0.08);color:var(--danger);border:1px solid rgba(239,68,68,0.15)}
        .connect-status svg{width:16px;height:16px}
        .wa-info{padding:12px;background:var(--bg);border-radius:var(--radius-sm);font-size:12px;color:var(--text-muted);line-height:1.7;margin-top:12px}
        .wa-info strong{color:var(--text-secondary);font-weight:600}
        .import-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:12px}
        .import-btn{display:flex;flex-direction:column;align-items:center;gap:8px;padding:16px 12px;background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);cursor:pointer;transition:all .2s;text-decoration:none;color:var(--text-secondary)}
        .import-btn:hover{border-color:var(--primary);background:var(--primary-muted);color:var(--text)}
        .import-btn-logo{font-size:24px;height:32px;display:flex;align-items:center;justify-content:center;font-weight:700}
        .import-btn-name{font-size:11px;font-weight:500}
        .upload-mini{border:2px dashed var(--border);border-radius:var(--radius);padding:20px;text-align:center;cursor:pointer;transition:all .2s;margin-top:10px}
        .upload-mini:hover{border-color:var(--primary);background:var(--primary-muted)}
        .upload-mini svg{width:24px;height:24px;color:var(--text-muted);margin-bottom:6px}
        .badge{display:inline-flex;align-items:center;gap:4px;padding:2px 8px;border-radius:20px;font-size:11px;font-weight:600}
        .badge-success{background:rgba(34,197,94,0.1);color:var(--success);border:1px solid rgba(34,197,94,0.2)}
        .badge-success::before{content:'';width:5px;height:5px;border-radius:50%;background:var(--success);animation:dotPulse 1.5s infinite}

        /* ===== MOBILE NAV ===== */
        .mob-nav{display:none;position:fixed;bottom:0;left:0;right:0;background:var(--bg);border-top:1px solid var(--border);z-index:200;padding:6px 0 env(safe-area-inset-bottom,8px)}
        .mob-nav-inner{display:flex;justify-content:space-around}
        .mn{display:flex;flex-direction:column;align-items:center;gap:2px;padding:6px 12px;color:var(--text-muted);cursor:pointer;transition:color .15s;text-decoration:none;font-size:10px;font-weight:500}
        .mn.active{color:var(--primary)}
        .mn svg{width:20px;height:20px}
        .mn.active svg{color:var(--primary)}

        /* ===== ANIMATIONS ===== */
        .fade-in{opacity:0;animation:fadeIn .4s ease-out forwards}
        @keyframes fadeIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
        @keyframes slideUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
        .d1{animation-delay:.05s}.d2{animation-delay:.1s}.d3{animation-delay:.15s}.d4{animation-delay:.2s}.d5{animation-delay:.25s}
        @keyframes spin{to{transform:rotate(360deg)}}
        @keyframes countUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

        /* ===== SCROLLBAR ===== */
        ::-webkit-scrollbar{width:5px}
        ::-webkit-scrollbar-track{background:transparent}
        ::-webkit-scrollbar-thumb{background:var(--border);border-radius:5px}

        /* ===== RESPONSIVE ===== */
        @media(max-width:1024px){
            .stats-row{grid-template-columns:repeat(2,1fr)}
            .flow-grid{grid-template-columns:1fr}
            .grid-2{grid-template-columns:1fr}
            .import-grid{grid-template-columns:repeat(3,1fr)}
        }
        @media(max-width:768px){
            .sidebar{display:none}
            .main{margin-right:0!important;margin-left:0!important;padding:16px 16px 80px;overflow-x:hidden}
            .page-title{font-size:18px}
            .page-header{flex-wrap:wrap;gap:8px}
            .stats-row{grid-template-columns:repeat(2,1fr);gap:10px}
            .stat{padding:14px}
            .stat-val{font-size:20px}
            .stat-sparkline{height:24px}
            .hero{padding:24px 16px}
            .hero-total{font-size:36px}
            .hero-breakdown{max-width:100%}
            .hero-checks{gap:12px}
            .flow-grid{grid-template-columns:1fr}
            .grid-2{grid-template-columns:1fr}
            .chart-bars{height:60px}
            .chart-value{font-size:24px}
            .mob-nav{display:block}
            .import-grid{grid-template-columns:repeat(2,1fr)}
        }
    </style>
</head>
<body>
    <!-- ===== SIDEBAR ===== -->
    <aside class="sidebar">
        <div class="sb-logo">
            <div class="sb-logo-mark"><i data-lucide="zap" style="width:18px;height:18px;color:white"></i></div>
            <span class="sb-logo-text" data-ar="Ø±ÙØ¨Ø­" data-en="RIBH">Ø±ÙØ¨Ø­</span>
        </div>
        <div class="sb-section">
            <a class="sb-item active" data-section="dashboard" onclick="nav('dashboard')"><i data-lucide="layout-dashboard"></i><span data-ar="Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…" data-en="Dashboard">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span></a>
            <a class="sb-item" data-section="flows" onclick="nav('flows')"><i data-lucide="workflow"></i><span data-ar="Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª" data-en="Flows">Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª</span></a>
            <a class="sb-item" data-section="settings" onclick="nav('settings')"><i data-lucide="settings"></i><span data-ar="Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª" data-en="Settings">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span></a>
        </div>
        <div class="sb-spacer"></div>
        <div class="sb-status" id="sbWhatsapp"><span class="sb-dot green pulse"></span><span data-ar="ÙˆØ§ØªØ³Ø§Ø¨ Ù…ØªØµÙ„" data-en="WhatsApp connected">ÙˆØ§ØªØ³Ø§Ø¨ Ù…ØªØµÙ„</span></div>
        <div class="sb-status" id="sbStore"><span class="sb-dot green pulse"></span><span data-ar="Ø³Ù„Ø© Ù…ØªØµÙ„Ø©" data-en="Salla connected">Ø³Ù„Ø© Ù…ØªØµÙ„Ø©</span></div>
        <div class="sb-lang" onclick="toggleLang()"><i data-lucide="globe" style="width:14px;height:14px"></i><span id="langLabel">English</span></div>
    </aside>

    <!-- ===== MAIN CONTENT ===== -->
    <main class="main">

        <!-- ===== DASHBOARD SECTION ===== -->
        <div id="dashboard">
            <div class="page-header fade-in">
                <div>
                    <div class="page-title" data-ar="Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…" data-en="Dashboard">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
                    <div class="page-subtitle" data-ar="Ø£Ù…ÙˆØ§Ù„Ùƒ ÙÙŠ Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯" data-en="Your money in one place">Ø£Ù…ÙˆØ§Ù„Ùƒ ÙÙŠ Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯</div>
                </div>
            </div>

            <!-- HERO: Money Waiting -->
            <div class="hero fade-in d1" id="heroCard">
                <div class="hero-label"><i data-lucide="coins"></i><span data-ar="Ø£Ù…ÙˆØ§Ù„ ØªÙ†ØªØ¸Ø±Ùƒ" data-en="Money waiting for you">Ø£Ù…ÙˆØ§Ù„ ØªÙ†ØªØ¸Ø±Ùƒ</span></div>
                <div class="hero-total"><span id="heroTotal">0</span> <span class="curr" data-ar="Ø±.Ø³" data-en="SAR">Ø±.Ø³</span></div>
                <div class="hero-sub" data-ar="Ù…Ø¨Ù„Øº ØªÙ‚Ø¯ÙŠØ±ÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ¬Ø±Ùƒ" data-en="Estimated based on your store data">Ù…Ø¨Ù„Øº ØªÙ‚Ø¯ÙŠØ±ÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ¬Ø±Ùƒ</div>

                <div class="hero-breakdown">
                    <div class="hero-row">
                        <div class="hero-row-right">
                            <div class="hero-row-icon" style="background:rgba(239,68,68,0.12)">ğŸ›’</div>
                            <div class="hero-row-info">
                                <div class="hero-row-count"><span id="heroCarts">0</span> <span data-ar="Ø³Ù„Ø© Ù…ØªØ±ÙˆÙƒØ©" data-en="abandoned carts">Ø³Ù„Ø© Ù…ØªØ±ÙˆÙƒØ©</span></div>
                                <div class="hero-row-desc" data-ar="Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø§ ÙƒÙ…Ù„ÙˆØ§ Ø§Ù„Ø´Ø±Ø§Ø¡" data-en="Customers who didn't finish buying">Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø§ ÙƒÙ…Ù„ÙˆØ§ Ø§Ù„Ø´Ø±Ø§Ø¡</div>
                            </div>
                        </div>
                        <div class="hero-row-val"><span id="heroCartVal">0</span> <span data-ar="Ø±.Ø³" data-en="SAR">Ø±.Ø³</span></div>
                    </div>
                    <div class="hero-row">
                        <div class="hero-row-right">
                            <div class="hero-row-icon" style="background:rgba(245,158,11,0.12)">ğŸ˜´</div>
                            <div class="hero-row-info">
                                <div class="hero-row-count"><span id="heroDormant">0</span> <span data-ar="Ø¹Ù…ÙŠÙ„ Ø®Ø§Ù…Ù„" data-en="dormant customers">Ø¹Ù…ÙŠÙ„ Ø®Ø§Ù…Ù„</span></div>
                                <div class="hero-row-desc" data-ar="Ù…Ø§ Ø§Ø´ØªØ±ÙˆØ§ Ù…Ù† Ø£ÙƒØ«Ø± Ù…Ù† 30 ÙŠÙˆÙ…" data-en="Haven't bought in 30+ days">Ù…Ø§ Ø§Ø´ØªØ±ÙˆØ§ Ù…Ù† Ø£ÙƒØ«Ø± Ù…Ù† 30 ÙŠÙˆÙ…</div>
                            </div>
                        </div>
                        <div class="hero-row-val"><span id="heroDormantVal">0</span> <span data-ar="Ø±.Ø³" data-en="SAR">Ø±.Ø³</span></div>
                    </div>
                    <div class="hero-row">
                        <div class="hero-row-right">
                            <div class="hero-row-icon" style="background:rgba(99,102,241,0.12)">ğŸ›ï¸</div>
                            <div class="hero-row-info">
                                <div class="hero-row-count"><span id="heroUpsell">0</span> <span data-ar="ÙØ±ØµØ© Ø¨ÙŠØ¹ Ø¥Ø¶Ø§ÙÙŠ" data-en="upsell opportunities">ÙØ±ØµØ© Ø¨ÙŠØ¹ Ø¥Ø¶Ø§ÙÙŠ</span></div>
                                <div class="hero-row-desc" data-ar="Ø¹Ù…Ù„Ø§Ø¡ Ø§Ø´ØªØ±ÙˆØ§ Ù…Ø¤Ø®Ø±Ø§Ù‹" data-en="Customers who recently bought">Ø¹Ù…Ù„Ø§Ø¡ Ø§Ø´ØªØ±ÙˆØ§ Ù…Ø¤Ø®Ø±Ø§Ù‹</div>
                            </div>
                        </div>
                        <div class="hero-row-val"><span id="heroUpsellVal">0</span> <span data-ar="Ø±.Ø³" data-en="SAR">Ø±.Ø³</span></div>
                    </div>
                </div>

                <div class="hero-cta">
                    <button class="btn btn-primary btn-big btn-hero" onclick="activateAll()">
                        <i data-lucide="rocket"></i>
                        <span data-ar="Ø§Ø³ØªØ±Ø¬Ø¹ Ø£Ù…ÙˆØ§Ù„Ùƒ" data-en="Recover your money">Ø§Ø³ØªØ±Ø¬Ø¹ Ø£Ù…ÙˆØ§Ù„Ùƒ</span>
                    </button>
                </div>

                <div class="hero-checks">
                    <div class="hero-check"><i data-lucide="check-circle-2"></i><span data-ar="Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¬Ø§Ù‡Ø²Ø©" data-en="Messages ready">Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¬Ø§Ù‡Ø²Ø©</span></div>
                    <div class="hero-check"><i data-lucide="check-circle-2"></i><span data-ar="Ø§Ù„ØªÙˆÙ‚ÙŠØª Ù…Ø­Ø³Ù‘Ù†" data-en="Timing optimized">Ø§Ù„ØªÙˆÙ‚ÙŠØª Ù…Ø­Ø³Ù‘Ù†</span></div>
                    <div class="hero-check"><i data-lucide="check-circle-2"></i><span data-ar="Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù…ÙØ¹Ù„Ø©" data-en="Protection active">Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù…ÙØ¹Ù„Ø©</span></div>
                </div>
            </div>

            <!-- Stats Row -->
            <div class="stats-row fade-in d2">
                <div class="stat">
                    <div class="stat-top"><span class="stat-label" data-ar="ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹Ù‡" data-en="Recovered">ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹Ù‡</span><div class="stat-icon green"><i data-lucide="banknote"></i></div></div>
                    <div class="stat-val"><span id="totalRevenue">0</span> <span style="font-size:14px;font-weight:500;color:var(--text-muted)" data-ar="Ø±.Ø³" data-en="SAR">Ø±.Ø³</span></div>
                    <div class="stat-sparkline" id="revSparkline"></div>
                </div>
                <div class="stat">
                    <div class="stat-top"><span class="stat-label" data-ar="Ø±Ø³Ø§Ø¦Ù„ Ù…Ø±Ø³Ù„Ø©" data-en="Messages Sent">Ø±Ø³Ø§Ø¦Ù„ Ù…Ø±Ø³Ù„Ø©</span><div class="stat-icon blue"><i data-lucide="send"></i></div></div>
                    <div class="stat-val" id="messagesSent">0</div>
                    <div class="stat-sparkline" id="msgSparkline"></div>
                </div>
                <div class="stat">
                    <div class="stat-top"><span class="stat-label" data-ar="Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹" data-en="Recovery Rate">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹</span><div class="stat-icon orange"><i data-lucide="percent"></i></div></div>
                    <div class="stat-val" id="recoveryRate">0%</div>
                    <div class="stat-sparkline" id="rateSparkline"></div>
                </div>
                <div class="stat">
                    <div class="stat-top"><span class="stat-label" data-ar="ØªØ¯ÙÙ‚Ø§Øª Ù†Ø´Ø·Ø©" data-en="Active Flows">ØªØ¯ÙÙ‚Ø§Øª Ù†Ø´Ø·Ø©</span><div class="stat-icon purple"><i data-lucide="workflow"></i></div></div>
                    <div class="stat-val" id="activeFlowCount">0</div>
                    <div class="stat-sparkline" id="flowSparkline"></div>
                </div>
            </div>

            <!-- Chart + Activity -->
            <div class="grid-2 fade-in d3" style="margin-bottom:24px">
                <div class="chart-card">
                    <div style="margin-bottom:20px">
                        <div class="chart-title" data-ar="Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³ØªØ±Ø¬Ø¹Ø©" data-en="Recovered Revenue">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³ØªØ±Ø¬Ø¹Ø©</div>
                        <div class="chart-value" id="chartTotal">0 <span style="font-size:16px;color:var(--text-muted)" data-ar="Ø±.Ø³" data-en="SAR">Ø±.Ø³</span></div>
                    </div>
                    <div class="chart-bars" id="revenueChart"></div>
                    <div class="chart-labels" id="revenueLabels"></div>
                </div>
                <div class="activity-card">
                    <div style="padding:16px 16px 12px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border)">
                        <span style="font-size:14px;font-weight:600" data-ar="Ø¢Ø®Ø± Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª" data-en="Recent Activity">Ø¢Ø®Ø± Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª</span>
                        <span class="badge badge-success" style="font-size:10px" data-ar="Ù…Ø¨Ø§Ø´Ø±" data-en="Live">Ù…Ø¨Ø§Ø´Ø±</span>
                    </div>
                    <div id="activityList">
                        <div class="empty" id="activityEmpty" style="padding:32px 16px;text-align:center;color:var(--text-muted)">
                            <i data-lucide="activity" style="width:32px;height:32px;margin-bottom:8px;opacity:0.4"></i>
                            <div style="font-size:13px;font-weight:600;color:var(--text-secondary);margin-bottom:4px" data-ar="Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø²" data-en="System Ready">Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø²</div>
                            <div style="font-size:12px" data-ar="ÙØ¹Ù‘Ù„ Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª ÙˆØ³ØªØ¸Ù‡Ø± Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª Ù‡Ù†Ø§" data-en="Activate flows and activities will appear here">ÙØ¹Ù‘Ù„ Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª ÙˆØ³ØªØ¸Ù‡Ø± Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª Ù‡Ù†Ø§</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== FLOWS SECTION ===== -->
        <div class="section fade-in d4" id="flows">
            <div class="section-head">
                <div class="section-title"><i data-lucide="workflow"></i><span data-ar="Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©" data-en="Automated Flows">Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©</span></div>
                <div class="badge badge-success" id="flowsBadge" style="font-size:10px"><span data-ar="0 Ù†Ø´Ø·" data-en="0 active" id="flowsBadgeText">0 Ù†Ø´Ø·</span></div>
            </div>

            <div class="flow-grid" id="flowGrid"></div>

            <!-- Chat Campaign Creator -->
            <div class="chat-creator">
                <div class="chat-header">
                    <i data-lucide="message-square-plus"></i>
                    <div>
                        <div class="chat-header-title" data-ar="Ø­Ù…Ù„Ø© Ù…Ø®ØµØµØ©" data-en="Custom Campaign">Ø­Ù…Ù„Ø© Ù…Ø®ØµØµØ©</div>
                    </div>
                </div>
                <div class="chat-body">
                    <div class="chat-input-wrap">
                        <input type="text" class="chat-input" id="chatInput" data-placeholder-ar="Ø§ÙƒØªØ¨ Ù‡Ø¯Ù Ø­Ù…Ù„ØªÙƒ... Ù…Ø«Ø§Ù„: Ø¹Ø±Ø¶ Ø±Ù…Ø¶Ø§Ù†ØŒ ØªØ®ÙÙŠØ¶Ø§Øª Ø§Ù„Ø¬Ù…Ø¹Ø© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡" data-placeholder-en="Type your campaign goal... e.g. Ramadan offer, Black Friday sale" placeholder="Ø§ÙƒØªØ¨ Ù‡Ø¯Ù Ø­Ù…Ù„ØªÙƒ... Ù…Ø«Ø§Ù„: Ø¹Ø±Ø¶ Ø±Ù…Ø¶Ø§Ù†ØŒ ØªØ®ÙÙŠØ¶Ø§Øª Ø§Ù„Ø¬Ù…Ø¹Ø© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡">
                        <button class="chat-send" onclick="generateCampaign()"><i data-lucide="sparkles"></i></button>
                    </div>
                    <div class="chat-result" id="chatResult">
                        <div class="chat-preview" id="chatPreview"></div>
                        <div class="chat-meta" id="chatMeta"></div>
                        <div class="chat-actions">
                            <button class="btn btn-outline" onclick="closeChatResult()" data-ar="Ø¥Ù„ØºØ§Ø¡" data-en="Cancel">Ø¥Ù„ØºØ§Ø¡</button>
                            <button class="btn btn-primary" onclick="launchCustom()"><i data-lucide="send"></i><span data-ar="Ø£Ø·Ù„Ù‚ Ø§Ù„Ø­Ù…Ù„Ø©" data-en="Launch">Ø£Ø·Ù„Ù‚ Ø§Ù„Ø­Ù…Ù„Ø©</span></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== SETTINGS SECTION ===== -->
        <div class="section fade-in d5" id="settings">
            <div class="section-head">
                <div class="section-title"><i data-lucide="settings"></i><span data-ar="Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª" data-en="Settings">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span></div>
            </div>

            <div class="settings-grid">
                <!-- WhatsApp Connection -->
                <div class="settings-card">
                    <div class="settings-card-head">
                        <div class="settings-card-ico" style="background:rgba(34,197,94,0.12);color:var(--success)"><i data-lucide="message-circle"></i></div>
                        <div>
                            <div class="settings-card-title" data-ar="Ø§ØªØµØ§Ù„ ÙˆØ§ØªØ³Ø§Ø¨" data-en="WhatsApp Connection">Ø§ØªØµØ§Ù„ ÙˆØ§ØªØ³Ø§Ø¨</div>
                            <div class="settings-card-desc" data-ar="Ø±Ø¨Ø· Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„" data-en="Connect your WhatsApp to send messages">Ø±Ø¨Ø· Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</div>
                        </div>
                    </div>
                    <div class="connect-status connected" id="waStatus">
                        <i data-lucide="check-circle-2"></i>
                        <span data-ar="Ù…ØªØµÙ„ - Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ø±Ø³Ø§Ù„" data-en="Connected - Ready to send">Ù…ØªØµÙ„ - Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ø±Ø³Ø§Ù„</span>
                    </div>
                    <div style="display:flex;gap:8px;margin-top:12px">
                        <button class="btn btn-outline" onclick="window.location.href='/whatsapp.html'" data-ar="Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø¨Ø· QR" data-en="Reconnect QR">Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø¨Ø· QR</button>
                        <button class="btn btn-outline" data-ar="Ø±Ø¨Ø· API Ø±Ø³Ù…ÙŠ" data-en="Connect Official API">Ø±Ø¨Ø· API Ø±Ø³Ù…ÙŠ</button>
                    </div>
                    <div class="wa-info">
                        <span data-ar="Ù†Ø³ØªØ®Ø¯Ù… ÙˆØ§ØªØ³Ø§Ø¨ ØºÙŠØ± Ø±Ø³Ù…ÙŠ. Ù†Ø­Ù…ÙŠÙƒ Ø¨Ø§Ù„ØªØ§Ù„ÙŠ:" data-en="We use unofficial WhatsApp. We protect you by:">Ù†Ø³ØªØ®Ø¯Ù… ÙˆØ§ØªØ³Ø§Ø¨ ØºÙŠØ± Ø±Ø³Ù…ÙŠ. Ù†Ø­Ù…ÙŠÙƒ Ø¨Ø§Ù„ØªØ§Ù„ÙŠ:</span><br>
                        <span data-ar="âœ… Ø¥Ø±Ø³Ø§Ù„ ØªØ¯Ø±ÙŠØ¬ÙŠ Ù…Ùˆ Ø¯ÙØ¹Ø© ÙˆØ­Ø¯Ø©" data-en="âœ… Gradual sending, not all at once">âœ… Ø¥Ø±Ø³Ø§Ù„ ØªØ¯Ø±ÙŠØ¬ÙŠ Ù…Ùˆ Ø¯ÙØ¹Ø© ÙˆØ­Ø¯Ø©</span><br>
                        <span data-ar="âœ… ÙØªØ±Ø§Øª Ø±Ø§Ø­Ø© Ø¨ÙŠÙ† Ø§Ù„Ø±Ø³Ø§Ø¦Ù„" data-en="âœ… Pauses between messages">âœ… ÙØªØ±Ø§Øª Ø±Ø§Ø­Ø© Ø¨ÙŠÙ† Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</span><br>
                        <span data-ar="âœ… Ø±Ù‚Ù…Ùƒ ÙŠØ³Ø®Ù† ØªØ¯Ø±ÙŠØ¬ÙŠØ§Ù‹" data-en="âœ… Your number warms up gradually">âœ… Ø±Ù‚Ù…Ùƒ ÙŠØ³Ø®Ù† ØªØ¯Ø±ÙŠØ¬ÙŠØ§Ù‹</span><br>
                        <span style="color:var(--text-secondary);margin-top:4px;display:inline-block" data-ar="Ù„Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø©: ÙØ¹Ù‘Ù„ API Ø§Ù„Ø±Ø³Ù…ÙŠ â†‘" data-en="For full protection: enable Official API â†‘">Ù„Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø©: ÙØ¹Ù‘Ù„ API Ø§Ù„Ø±Ø³Ù…ÙŠ â†‘</span>
                    </div>
                </div>

                <!-- Store Connection -->
                <div class="settings-card">
                    <div class="settings-card-head">
                        <div class="settings-card-ico" style="background:rgba(59,130,246,0.12);color:#3B82F6"><i data-lucide="store"></i></div>
                        <div>
                            <div class="settings-card-title" data-ar="Ø±Ø¨Ø· Ø§Ù„Ù…ØªØ¬Ø±" data-en="Store Connection">Ø±Ø¨Ø· Ø§Ù„Ù…ØªØ¬Ø±</div>
                            <div class="settings-card-desc" data-ar="Ø§Ø±Ø¨Ø· Ù…ØªØ¬Ø±Ùƒ Ù„Ø³Ø­Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹" data-en="Connect your store to pull data automatically">Ø§Ø±Ø¨Ø· Ù…ØªØ¬Ø±Ùƒ Ù„Ø³Ø­Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</div>
                        </div>
                    </div>
                    <div class="connect-status connected" id="storeStatus">
                        <i data-lucide="check-circle-2"></i>
                        <span data-ar="Ø³Ù„Ø© Ù…ØªØµÙ„Ø©" data-en="Salla connected">Ø³Ù„Ø© Ù…ØªØµÙ„Ø©</span>
                    </div>
                </div>

                <!-- Customer Import -->
                <div class="settings-card">
                    <div class="settings-card-head">
                        <div class="settings-card-ico" style="background:rgba(245,158,11,0.12);color:var(--warning)"><i data-lucide="users"></i></div>
                        <div>
                            <div class="settings-card-title" data-ar="Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡" data-en="Import Customers">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
                            <div class="settings-card-desc" data-ar="Ø§Ø³ØªÙˆØ±Ø¯ Ø¹Ù…Ù„Ø§Ø¡Ùƒ Ù…Ù† Ø£ÙŠ Ù…ØµØ¯Ø±" data-en="Import your customers from any source">Ø§Ø³ØªÙˆØ±Ø¯ Ø¹Ù…Ù„Ø§Ø¡Ùƒ Ù…Ù† Ø£ÙŠ Ù…ØµØ¯Ø±</div>
                        </div>
                    </div>
                    <div class="import-grid">
                        <div class="import-btn" onclick="connectImport('salla')">
                            <div class="import-btn-logo" style="color:#6C63FF">Ø³Ù„Ø©</div>
                            <div class="import-btn-name">Salla</div>
                        </div>
                        <div class="import-btn" onclick="connectImport('foodics')">
                            <div class="import-btn-logo" style="color:#FF6B35">F</div>
                            <div class="import-btn-name">Foodics</div>
                        </div>
                        <div class="import-btn" onclick="connectImport('zid')">
                            <div class="import-btn-logo" style="color:#5B5FC7">Ø²Ø¯</div>
                            <div class="import-btn-name">Zid</div>
                        </div>
                        <div class="import-btn" onclick="connectImport('marn')">
                            <div class="import-btn-logo" style="color:#00C9A7">Ù…Ø±Ù†</div>
                            <div class="import-btn-name">Marn</div>
                        </div>
                        <div class="import-btn" onclick="connectImport('shopify')">
                            <div class="import-btn-logo" style="color:#96BF48">S</div>
                            <div class="import-btn-name">Shopify</div>
                        </div>
                        <div class="import-btn" onclick="connectImport('loyverse')">
                            <div class="import-btn-logo" style="color:#8E44AD">L</div>
                            <div class="import-btn-name">Loyverse</div>
                        </div>
                    </div>
                    <div class="upload-mini" onclick="document.getElementById('fileInput').click()">
                        <i data-lucide="upload-cloud"></i>
                        <div style="font-size:12px;color:var(--text-secondary)" data-ar="Ø£Ùˆ Ø§Ø±ÙØ¹ Ù…Ù„Ù CSV / Excel" data-en="Or upload CSV / Excel file">Ø£Ùˆ Ø§Ø±ÙØ¹ Ù…Ù„Ù CSV / Excel</div>
                    </div>
                    <input type="file" id="fileInput" accept=".csv,.xlsx,.xls,.json" onchange="handleFile(event)" style="display:none">
                </div>
            </div>
        </div>
    </main>

    <!-- ===== MOBILE NAV ===== -->
    <nav class="mob-nav"><div class="mob-nav-inner">
        <a class="mn active" data-section="dashboard" onclick="nav('dashboard')"><i data-lucide="layout-dashboard"></i><span data-ar="Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©" data-en="Home">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></a>
        <a class="mn" data-section="flows" onclick="nav('flows')"><i data-lucide="workflow"></i><span data-ar="Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª" data-en="Flows">Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª</span></a>
        <a class="mn" data-section="settings" onclick="nav('settings')"><i data-lucide="settings"></i><span data-ar="Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª" data-en="Settings">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span></a>
    </div></nav>

    <script>
    // ===== STATE =====
    const merchantId='demo';
    let lang=localStorage.getItem('ribhLang')||'ar';

    const FLOWS=[
        {id:'cart_recovery',icon:'shopping-cart',name:'Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø³Ù„Ø§Øª',nameEn:'Cart Recovery',desc:'Ø±Ø³Ø§Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù„Ù…Ù† ØªØ±Ùƒ Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚',descEn:'Auto-message when a cart is abandoned',color:'#EF4444',active:false,sent:0,revenue:0},
        {id:'winback',icon:'user-check',name:'Ø¥Ø¹Ø§Ø¯Ø© ØªÙ†Ø´ÙŠØ·',nameEn:'Win Back',desc:'Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù„ÙŠ Ù…Ø§ Ø§Ø´ØªØ±ÙˆØ§ Ù…Ù† 30 ÙŠÙˆÙ…',descEn:'Message customers inactive for 30+ days',color:'#F59E0B',active:false,sent:0,revenue:0},
        {id:'post_purchase',icon:'package',name:'Ø¨ÙŠØ¹ Ø¥Ø¶Ø§ÙÙŠ',nameEn:'Post-Purchase Upsell',desc:'Ø¹Ø±Ø¶ Ù…Ù†ØªØ¬Ø§Øª Ù…ÙƒÙ…Ù„Ø© Ø¨Ø¹Ø¯ ÙƒÙ„ Ø´Ø±Ø§Ø¡',descEn:'Suggest products after each purchase',color:'#6366F1',active:false,sent:0,revenue:0},
        {id:'review',icon:'star',name:'Ø¬Ù…Ø¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª',nameEn:'Review Collection',desc:'Ø·Ù„Ø¨ ØªÙ‚ÙŠÙŠÙ… Ø¨Ø¹Ø¯ ØªÙˆØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨',descEn:'Ask for a review after delivery',color:'#10B981',active:false,sent:0,revenue:0},
        {id:'browse',icon:'eye',name:'ØªØµÙØ­ Ø¨Ø¯ÙˆÙ† Ø´Ø±Ø§Ø¡',nameEn:'Browse Abandonment',desc:'Ø±Ø³Ø§Ù„Ø© Ù„Ù…Ù† ØªØµÙØ­ Ø¨Ø¯ÙˆÙ† Ù…Ø§ ÙŠØ´ØªØ±ÙŠ',descEn:'Message browsers who didn\'t buy',color:'#3B82F6',active:false,sent:0,revenue:0},
        {id:'cod',icon:'package-check',name:'ØªØ£ÙƒÙŠØ¯ COD',nameEn:'COD Confirmation',desc:'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ Ù‚Ø¨Ù„ Ø§Ù„Ø´Ø­Ù† Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª',descEn:'Confirm order before shipping to reduce returns',color:'#8B5CF6',active:false,sent:0,revenue:0}
    ];

    // ===== NAVIGATION =====
    function nav(s){
        const el=document.getElementById(s);
        if(el) el.scrollIntoView({behavior:'smooth',block:'start'});
        document.querySelectorAll('.sb-item,.mn').forEach(i=>i.classList.remove('active'));
        document.querySelectorAll(`[data-section="${s}"]`).forEach(i=>i.classList.add('active'));
    }

    const obs=new IntersectionObserver(es=>{
        es.forEach(e=>{
            if(e.isIntersecting){
                document.querySelectorAll('.sb-item,.mn').forEach(i=>i.classList.remove('active'));
                document.querySelectorAll(`[data-section="${e.target.id}"]`).forEach(i=>i.classList.add('active'));
            }
        });
    },{threshold:0.2,rootMargin:'-80px 0px -50% 0px'});

    // ===== LANGUAGE =====
    function toggleLang(){
        lang=lang==='ar'?'en':'ar';
        localStorage.setItem('ribhLang',lang);
        applyLang();
    }
    function applyLang(){
        const r=document.documentElement;
        r.setAttribute('dir',lang==='ar'?'rtl':'ltr');
        r.setAttribute('lang',lang);
        document.getElementById('langLabel').textContent=lang==='ar'?'English':'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©';
        document.querySelectorAll('[data-ar]').forEach(el=>{
            el.textContent=el.getAttribute('data-'+lang)||el.textContent;
        });
        // Update placeholders
        document.querySelectorAll('[data-placeholder-ar]').forEach(el=>{
            el.placeholder=el.getAttribute('data-placeholder-'+lang)||el.placeholder;
        });
        renderFlows();
        updateFlowBadge();
    }

    // ===== COUNTER ANIMATION =====
    function animateValue(el,end,duration=1200){
        const start=0;
        const startTime=performance.now();
        function update(now){
            const elapsed=now-startTime;
            const progress=Math.min(elapsed/duration,1);
            const eased=1-Math.pow(1-progress,3);
            el.textContent=Math.floor(start+(end-start)*eased).toLocaleString();
            if(progress<1) requestAnimationFrame(update);
        }
        requestAnimationFrame(update);
    }

    // ===== SPARKLINES =====
    function renderSparkline(id,data,color){
        const el=document.getElementById(id);if(!el)return;
        const mx=Math.max(...data);
        el.innerHTML=data.map(v=>`<div class="bar" style="height:${Math.max(8,(v/mx)*100)}%;background:${color}"></div>`).join('');
    }

    // ===== CHART =====
    function renderChart(data,labels){
        const c=document.getElementById('revenueChart'),l=document.getElementById('revenueLabels');
        const mx=Math.max(...data);
        c.innerHTML=data.map((v,i)=>{
            const h=Math.max(4,(v/mx)*100);
            return`<div class="c-bar" style="height:0%;background:${i===data.length-1?'var(--primary)':'var(--border-hover)'}" data-h="${h}"><div class="c-tip">${v.toLocaleString()}</div></div>`;
        }).join('');
        l.innerHTML=labels.map(x=>`<span>${x}</span>`).join('');
        // Animate bars growing
        setTimeout(()=>{
            c.querySelectorAll('.c-bar').forEach((bar,i)=>{
                setTimeout(()=>{bar.style.height=bar.dataset.h+'%';},i*60);
            });
        },200);
    }

    // ===== FLOWS =====
    function renderFlows(){
        const g=document.getElementById('flowGrid');
        g.innerHTML=FLOWS.map(f=>{
            const name=lang==='ar'?f.name:f.nameEn;
            const desc=lang==='ar'?f.desc:f.descEn;
            const sentLabel=lang==='ar'?'Ø±Ø³Ø§Ù„Ø©':'sent';
            const revLabel=lang==='ar'?'Ø±.Ø³':'SAR';
            return`<div class="flow-card ${f.active?'active':''}" id="flow_${f.id}">
                <div class="flow-top">
                    <div class="flow-ico" style="background:${f.color}15;color:${f.color}"><i data-lucide="${f.icon}"></i></div>
                    <div class="flow-info">
                        <div class="flow-name">${name}</div>
                        <div class="flow-desc">${desc}</div>
                    </div>
                    <label class="flow-toggle">
                        <input type="checkbox" ${f.active?'checked':''} onchange="toggleFlow('${f.id}',this.checked)">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="flow-stats">
                    <div class="flow-stat"><i data-lucide="send"></i> <strong>${f.sent.toLocaleString()}</strong> ${sentLabel}</div>
                    <div class="flow-stat"><i data-lucide="banknote"></i> <strong>${f.revenue.toLocaleString()}</strong> ${revLabel}</div>
                </div>
            </div>`;
        }).join('');
        lucide.createIcons();
    }

    function toggleFlow(id,on){
        const f=FLOWS.find(x=>x.id===id);
        if(!f) return;
        f.active=on;
        const card=document.getElementById('flow_'+id);
        if(on){
            card.classList.add('active');
            simulateFlow(f);
        }else{
            card.classList.remove('active');
        }
        updateFlowBadge();
    }

    function updateFlowBadge(){
        const count=FLOWS.filter(f=>f.active).length;
        const text=lang==='ar'?`${count} Ù†Ø´Ø·`:`${count} active`;
        document.getElementById('flowsBadgeText').textContent=text;
        document.getElementById('activeFlowCount').textContent=count;
    }

    function activateAll(){
        FLOWS.forEach(f=>{
            if(!f.active){
                f.active=true;
                simulateFlow(f);
            }
        });
        renderFlows();
        updateFlowBadge();
        // Scroll to flows
        setTimeout(()=>nav('flows'),300);
    }

    function simulateFlow(flow){
        const iv=setInterval(()=>{
            if(!flow.active){clearInterval(iv);return;}
            flow.sent+=Math.floor(Math.random()*8)+2;
            flow.revenue+=Math.floor(Math.random()*300)+50;
            const card=document.getElementById('flow_'+flow.id);
            if(card){
                const stats=card.querySelectorAll('.flow-stat strong');
                if(stats[0]) stats[0].textContent=flow.sent.toLocaleString();
                if(stats[1]) stats[1].textContent=flow.revenue.toLocaleString();
            }
            updateDashboardStats();
        },3000+Math.random()*2000);
    }

    function updateDashboardStats(){
        const totalRev=FLOWS.reduce((a,f)=>a+f.revenue,0);
        const totalSent=FLOWS.reduce((a,f)=>a+f.sent,0);
        const rate=totalSent>0?Math.min(Math.round((totalRev/Math.max(totalSent*100,1))*100),38):0;
        document.getElementById('totalRevenue').textContent=totalRev.toLocaleString();
        document.getElementById('messagesSent').textContent=totalSent.toLocaleString();
        document.getElementById('recoveryRate').textContent=rate+'%';
    }

    // ===== CHAT CAMPAIGN CREATOR =====
    function generateCampaign(){
        const input=document.getElementById('chatInput');
        const goal=input.value.trim();
        if(!goal) return;

        const result=document.getElementById('chatResult');
        const preview=document.getElementById('chatPreview');
        const meta=document.getElementById('chatMeta');

        const audience=Math.floor(Math.random()*800)+200;
        const bestTime=lang==='ar'?'Ø§Ù„Ø®Ù…ÙŠØ³ 8 Ù…Ø³Ø§Ø¡Ù‹':'Thursday 8 PM';

        const msgAr=`Ù…Ø±Ø­Ø¨Ø§Ù‹ {customer_name} ğŸ‘‹

Ø¹Ù†Ø¯Ù†Ø§ Ù„Ùƒ Ø¹Ø±Ø¶ Ø®Ø§Øµ: ${goal}

Ø®ØµÙ… 15% Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ğŸ‰
Ø§Ù„ÙƒÙˆØ¯: RIBH15

ğŸ›’ {store_url}

Ø§Ù„Ø¹Ø±Ø¶ Ù„ÙØªØ±Ø© Ù…Ø­Ø¯ÙˆØ¯Ø© â°`;

        const msgEn=`Hi {customer_name} ğŸ‘‹

Special offer for you: ${goal}

15% off everything ğŸ‰
Code: RIBH15

ğŸ›’ {store_url}

Limited time only â°`;

        preview.textContent=lang==='ar'?msgAr:msgEn;

        const audienceLabel=lang==='ar'?'Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±':'Audience';
        const timeLabel=lang==='ar'?'Ø£ÙØ¶Ù„ ÙˆÙ‚Øª':'Best time';
        const offerLabel=lang==='ar'?'Ø§Ù„Ø¹Ø±Ø¶':'Offer';

        meta.innerHTML=`
            <div class="chat-meta-item"><i data-lucide="users"></i>${audienceLabel}: <strong>${audience}</strong></div>
            <div class="chat-meta-item"><i data-lucide="clock"></i>${timeLabel}: <strong>${bestTime}</strong></div>
            <div class="chat-meta-item"><i data-lucide="tag"></i>${offerLabel}: <strong>15%</strong></div>
        `;
        lucide.createIcons();
        result.classList.add('show');
    }

    function closeChatResult(){
        document.getElementById('chatResult').classList.remove('show');
        document.getElementById('chatInput').value='';
    }

    function launchCustom(){
        closeChatResult();
        const msg=lang==='ar'?'ØªÙ… Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ø­Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­! ğŸš€':'Campaign launched! ğŸš€';
        // Brief success feedback
        const input=document.getElementById('chatInput');
        input.value='';
        input.placeholder=msg;
        setTimeout(()=>{
            input.placeholder=input.getAttribute('data-placeholder-'+lang);
        },3000);
    }

    // ===== IMPORT =====
    function connectImport(platform){
        if(platform==='salla'){
            window.location.href='/setup.html';
        }else{
            const msg=lang==='ar'?`Ø±Ø¨Ø· ${platform} Ù‚Ø±ÙŠØ¨Ø§Ù‹`:`${platform} integration coming soon`;
            alert(msg);
        }
    }

    function handleFile(e){
        if(!e.target.files[0]) return;
        const f=e.target.files[0];
        if(f.size>10*1024*1024){alert(lang==='ar'?'Ø­Ø¬Ù… ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹':'File too large');return;}
        const msg=lang==='ar'?`ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù…Ù† ${f.name}`:`Imported customers from ${f.name}`;
        alert(msg);
    }

    // ===== HERO DATA =====
    function loadHeroData(){
        // Demo data - in production this comes from API
        const carts=347,cartVal=42000;
        const dormant=891,dormantVal=89000;
        const upsell=156,upsellVal=23000;
        const total=cartVal+dormantVal+upsellVal;

        setTimeout(()=>{
            animateValue(document.getElementById('heroTotal'),total,1800);
            animateValue(document.getElementById('heroCarts'),carts,1200);
            animateValue(document.getElementById('heroCartVal'),cartVal,1400);
            animateValue(document.getElementById('heroDormant'),dormant,1200);
            animateValue(document.getElementById('heroDormantVal'),dormantVal,1400);
            animateValue(document.getElementById('heroUpsell'),upsell,1200);
            animateValue(document.getElementById('heroUpsellVal'),upsellVal,1400);
        },400);
    }

    // ===== API CALLS =====
    async function loadStats(){
        try{
            const r=await fetch('/api/ribh/stats');
            const d=await r.json();
            if(d.success){
                document.getElementById('totalRevenue').textContent=(d.totalRevenue||0).toLocaleString();
                document.getElementById('recoveryRate').textContent=(d.recoveryRate||0)+'%';
            }
        }catch(e){}
    }

    async function loadActivity(){
        try{
            const r=await fetch('/api/ribh/activity');
            const d=await r.json();
            if(d.success&&d.activities?.length>0){
                const list=document.getElementById('activityList');
                const empty=document.getElementById('activityEmpty');
                if(empty) empty.style.display='none';
                list.innerHTML=d.activities.slice(0,8).map(a=>{
                    const dc=a.type==='recovered'?'green':a.type==='sent'?'blue':'orange';
                    const amt=a.amount?`<span class="act-amount">+${a.amount.toLocaleString()} ${lang==='ar'?'Ø±.Ø³':'SAR'}</span>`:'';
                    return`<div class="activity-item"><span class="act-dot ${dc}"></span><div class="act-body"><div class="act-msg">${a.message||a.title}</div><div class="act-time">${a.time||(lang==='ar'?'Ø§Ù„Ø¢Ù†':'Now')}</div></div>${amt}</div>`;
                }).join('');
            }
        }catch(e){}
    }

    // ===== ENTER KEY FOR CHAT =====
    document.addEventListener('keydown',e=>{
        if(e.key==='Enter'&&document.activeElement===document.getElementById('chatInput')){
            generateCampaign();
        }
    });

    // ===== INIT =====
    document.addEventListener('DOMContentLoaded',()=>{
        lucide.createIcons();
        applyLang();
        renderFlows();
        updateFlowBadge();
        loadHeroData();
        loadStats();
        loadActivity();

        // Observe sections
        ['dashboard','flows','settings'].forEach(id=>{
            const el=document.getElementById(id);
            if(el) obs.observe(el);
        });

        // Sparklines
        renderSparkline('revSparkline',[30,45,28,55,42,68,75,60,85,72,90,95],'var(--primary)');
        renderSparkline('msgSparkline',[12,18,15,22,19,28,25,30,27,35,32,38],'rgba(59,130,246,0.6)');
        renderSparkline('rateSparkline',[10,12,11,14,13,16,15,18,17,20,19,22],'rgba(245,158,11,0.6)');
        renderSparkline('flowSparkline',[1,1,2,2,3,3,4,4,5,5,6,6],'rgba(99,102,241,0.6)');

        // Chart
        const months=lang==='ar'?['ÙŠÙ†Ø§ÙŠØ±','ÙØ¨Ø±Ø§ÙŠØ±','Ù…Ø§Ø±Ø³','Ø£Ø¨Ø±ÙŠÙ„','Ù…Ø§ÙŠÙˆ','ÙŠÙˆÙ†ÙŠÙˆ','ÙŠÙˆÙ„ÙŠÙˆ','Ø£ØºØ³Ø·Ø³','Ø³Ø¨ØªÙ…Ø¨Ø±','Ø£ÙƒØªÙˆØ¨Ø±','Ù†ÙˆÙÙ…Ø¨Ø±','Ø¯ÙŠØ³Ù…Ø¨Ø±']:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
        const now=new Date().getMonth();
        const d7=[],l7=[];
        for(let i=6;i>=0;i--){
            d7.push(Math.floor(Math.random()*8000)+2000);
            l7.push(months[(now-i+12)%12]);
        }
        renderChart(d7,l7);
        document.getElementById('chartTotal').innerHTML=d7.reduce((a,b)=>a+b,0).toLocaleString()+` <span style="font-size:16px;color:var(--text-muted)">${lang==='ar'?'Ø±.Ø³':'SAR'}</span>`;

        // Poll
        setInterval(()=>{loadStats();loadActivity();},30000);
    });
    </script>
</body>
</html>
