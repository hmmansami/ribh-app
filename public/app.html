<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RIBH</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{
            --bg:#09090B;--bg-raised:#18181B;
            --card:#18181B;--card-hover:#1F1F23;
            --border:#27272A;--border-hover:#3F3F46;
            --text:#FAFAFA;--text-secondary:#A1A1AA;--text-muted:#71717A;
            --primary:#10B981;--primary-hover:#059669;--primary-muted:rgba(16,185,129,0.15);
            --secondary:#6366F1;--secondary-muted:rgba(99,102,241,0.15);
            --success:#22C55E;--warning:#F59E0B;--danger:#EF4444;
            --ring:rgba(16,185,129,0.3);
            --radius:12px;--radius-sm:8px;--radius-lg:16px;
            --sidebar-w:220px;
        }
        html{scroll-behavior:smooth;overflow-x:hidden;max-width:100vw}
        html[dir="ltr"]{font-family:'Inter',system-ui,sans-serif}
        html[dir="rtl"]{font-family:'IBM Plex Sans Arabic','Inter',system-ui,sans-serif}
        body{background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;font-size:14px;line-height:1.5;width:100%;max-width:100vw}

        /* Sidebar */
        .sidebar{width:var(--sidebar-w);background:var(--bg);border-left:1px solid var(--border);position:fixed;height:100vh;z-index:100;display:flex;flex-direction:column;padding:16px 12px;overflow-y:auto}
        html[dir="rtl"] .sidebar{right:0;border-left:1px solid var(--border);border-right:none}
        html[dir="ltr"] .sidebar{left:0;border-right:1px solid var(--border);border-left:none}
        .sb-logo{display:flex;align-items:center;gap:10px;padding:8px 12px;margin-bottom:24px}
        .sb-logo-mark{width:32px;height:32px;background:linear-gradient(135deg,#10B981,#059669);border-radius:8px;display:flex;align-items:center;justify-content:center}
        .sb-logo-mark svg{color:white}
        .sb-logo-text{font-size:18px;font-weight:700;letter-spacing:-0.02em}
        .sb-section{margin-bottom:20px}
        .sb-section-label{font-size:11px;font-weight:600;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.05em;padding:0 12px;margin-bottom:6px}
        .sb-item{display:flex;align-items:center;gap:10px;padding:9px 12px;border-radius:var(--radius-sm);color:var(--text-secondary);cursor:pointer;transition:all .15s;font-size:13px;font-weight:500;text-decoration:none}
        .sb-item:hover{background:var(--bg-raised);color:var(--text)}
        .sb-item.active{background:var(--primary-muted);color:var(--primary)}
        .sb-item.active svg{color:var(--primary)}
        .sb-item svg{width:18px;height:18px;flex-shrink:0;color:var(--text-muted)}
        .sb-item:hover svg{color:var(--text-secondary)}
        .sb-spacer{flex:1}
        .sb-status{display:flex;align-items:center;gap:8px;padding:10px 12px;border-radius:var(--radius-sm);background:var(--bg-raised);font-size:12px;color:var(--text-secondary);margin-bottom:8px}
        .sb-dot{width:7px;height:7px;border-radius:50%;background:var(--success);flex-shrink:0}
        .sb-dot.pulse{animation:dotPulse 2s infinite}
        @keyframes dotPulse{0%,100%{opacity:1}50%{opacity:0.4}}
        .sb-lang{display:flex;align-items:center;gap:8px;padding:9px 12px;border-radius:var(--radius-sm);cursor:pointer;font-size:12px;color:var(--text-muted);transition:all .15s}
        .sb-lang:hover{background:var(--bg-raised);color:var(--text-secondary)}

        /* Main */
        .main{padding:24px 28px 80px;position:relative;min-height:100vh}
        html[dir="rtl"] .main{margin-right:var(--sidebar-w)}
        html[dir="ltr"] .main{margin-left:var(--sidebar-w)}

        /* Page Header */
        .page-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:28px}
        .page-title{font-size:22px;font-weight:700;letter-spacing:-0.02em}
        .page-subtitle{font-size:13px;color:var(--text-muted);margin-top:2px}
        .header-actions{display:flex;gap:8px}

        /* Buttons */
        .btn{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;border-radius:var(--radius-sm);font-size:13px;font-weight:500;cursor:pointer;transition:all .15s;font-family:inherit;border:none;text-decoration:none}
        .btn-primary{background:var(--primary);color:white}
        .btn-primary:hover{background:var(--primary-hover)}
        .btn-outline{background:transparent;border:1px solid var(--border);color:var(--text-secondary)}
        .btn-outline:hover{background:var(--bg-raised);border-color:var(--border-hover);color:var(--text)}
        .btn-ghost{background:transparent;color:var(--text-secondary);padding:8px}
        .btn-ghost:hover{background:var(--bg-raised);color:var(--text)}
        .btn svg{width:16px;height:16px}

        /* Stat Cards */
        .stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:24px}
        .stat{background:var(--card);border:1px solid var(--border);border-radius:var(--radius-lg);padding:20px;transition:all .2s}
        .stat:hover{border-color:var(--border-hover)}
        .stat-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
        .stat-label{font-size:13px;font-weight:500;color:var(--text-secondary)}
        .stat-icon{width:36px;height:36px;border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center}
        .stat-icon svg{width:18px;height:18px}
        .stat-icon.green{background:var(--primary-muted);color:var(--primary)}
        .stat-icon.blue{background:rgba(59,130,246,0.15);color:#3B82F6}
        .stat-icon.purple{background:var(--secondary-muted);color:var(--secondary)}
        .stat-icon.orange{background:rgba(245,158,11,0.15);color:var(--warning)}
        .stat-val{font-size:26px;font-weight:700;letter-spacing:-0.02em;line-height:1.1;margin-bottom:6px}
        .stat-trend{display:inline-flex;align-items:center;gap:3px;font-size:12px;font-weight:500;border-radius:20px;padding:2px 8px}
        .stat-trend.up{color:var(--success);background:rgba(34,197,94,0.1)}
        .stat-trend svg{width:12px;height:12px}
        .stat-sparkline{display:flex;align-items:flex-end;gap:2px;height:32px;margin-top:10px}
        .stat-sparkline .bar{flex:1;border-radius:2px;min-height:3px;transition:height .3s}

        /* Section */
        .section{margin-bottom:32px;scroll-margin-top:20px}
        .section-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:12px}
        .section-title{font-size:16px;font-weight:600;display:flex;align-items:center;gap:8px;letter-spacing:-0.01em}
        .section-title svg{width:18px;height:18px;color:var(--text-muted)}

        /* Layouts */
        .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
        .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius-lg);padding:20px}
        .card-title{font-size:14px;font-weight:600;color:var(--text-secondary)}

        /* Revenue Chart */
        .chart-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius-lg);padding:24px}
        .chart-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}
        .chart-title{font-size:15px;font-weight:600}
        .chart-value{font-size:32px;font-weight:700;letter-spacing:-0.03em;margin-bottom:4px}
        .chart-sub{font-size:13px;color:var(--text-muted)}
        .chart-bars{display:flex;align-items:flex-end;gap:6px;height:120px;padding-top:8px}
        .chart-bars .c-bar{flex:1;border-radius:4px 4px 0 0;position:relative;cursor:pointer;transition:all .2s;min-height:4px}
        .chart-bars .c-bar:hover{opacity:0.8}
        .chart-bars .c-bar .c-tip{position:absolute;top:-26px;left:50%;transform:translateX(-50%);background:var(--text);color:var(--bg);font-size:10px;font-weight:600;padding:2px 6px;border-radius:4px;opacity:0;transition:opacity .2s;white-space:nowrap;pointer-events:none;z-index:10}
        .chart-card{overflow:hidden}
        .chart-bars .c-bar:hover .c-tip{opacity:1}
        .chart-labels{display:flex;gap:6px;margin-top:8px}
        .chart-labels span{flex:1;text-align:center;font-size:10px;color:var(--text-muted)}

        /* Campaign Templates */
        .tpl-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
        .tpl{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;cursor:pointer;transition:all .2s}
        .tpl:hover{border-color:var(--border-hover);background:var(--card-hover)}
        .tpl.selected{border-color:var(--primary);box-shadow:0 0 0 1px var(--primary)}
        .tpl-top{display:flex;align-items:center;gap:10px;margin-bottom:8px}
        .tpl-ico{width:36px;height:36px;border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0}
        .tpl-name{font-size:13px;font-weight:600}
        .tpl-desc{font-size:12px;color:var(--text-muted);line-height:1.5;margin-bottom:8px}
        .tpl-badge{display:inline-flex;align-items:center;gap:4px;padding:2px 8px;border-radius:20px;font-size:11px;font-weight:600}

        /* Active Campaigns */
        .camp{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;transition:all .2s}
        .camp:hover{border-color:var(--border-hover)}
        .camp-top{display:flex;align-items:center;gap:10px;margin-bottom:10px}
        .camp-icon{width:32px;height:32px;border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0}
        .camp-info{flex:1;min-width:0}
        .camp-name{font-size:13px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .badge{display:inline-flex;align-items:center;gap:4px;padding:2px 8px;border-radius:20px;font-size:11px;font-weight:600}
        .badge-success{background:rgba(34,197,94,0.1);color:var(--success);border:1px solid rgba(34,197,94,0.2)}
        .badge-success::before{content:'';width:5px;height:5px;border-radius:50%;background:var(--success);animation:dotPulse 1.5s infinite}
        .badge-warning{background:rgba(245,158,11,0.1);color:var(--warning);border:1px solid rgba(245,158,11,0.2)}
        .badge-secondary{background:var(--secondary-muted);color:var(--secondary);border:1px solid rgba(99,102,241,0.2)}
        .progress-bar{height:4px;background:var(--bg-raised);border-radius:4px;overflow:hidden;margin:8px 0 6px}
        .progress-fill{height:100%;border-radius:4px;background:linear-gradient(90deg,var(--primary),var(--primary-hover));transition:width .4s}
        .camp-meta{display:flex;justify-content:space-between;font-size:12px;color:var(--text-muted)}
        .camp-revenue{font-weight:600;color:var(--primary)}

        /* Launch Panel */
        .launch-panel{display:none;background:var(--card);border:1px solid var(--border);border-radius:var(--radius-lg);padding:20px;margin-top:12px;animation:slideUp .2s ease-out}
        .launch-panel.open{display:block}
        @keyframes slideUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
        .launch-panel textarea{width:100%;min-height:100px;padding:12px;background:var(--bg);border:1px solid var(--border);border-radius:var(--radius-sm);color:var(--text);font-size:13px;font-family:inherit;line-height:1.6;resize:vertical;transition:border-color .15s}
        .launch-panel textarea:focus{outline:none;border-color:var(--primary)}
        .audience-info{display:flex;align-items:center;gap:8px;padding:10px 14px;background:var(--primary-muted);border-radius:var(--radius-sm);font-size:13px;font-weight:500;color:var(--primary);margin-bottom:12px}
        .audience-info svg{width:16px;height:16px}
        .audience-count{font-size:18px;font-weight:700}
        .launch-actions{display:flex;gap:8px;margin-top:12px;justify-content:flex-end}

        /* Upload */
        .upload-zone{border:2px dashed var(--border);border-radius:var(--radius-lg);padding:40px;text-align:center;cursor:pointer;transition:all .2s}
        .upload-zone:hover,.upload-zone.dragover{border-color:var(--primary);background:var(--primary-muted)}
        .upload-zone svg{width:40px;height:40px;color:var(--text-muted);margin-bottom:12px}
        .uz-title{font-size:15px;font-weight:600;margin-bottom:4px}
        .uz-sub{font-size:12px;color:var(--text-muted);margin-bottom:12px}
        .uz-formats{display:flex;justify-content:center;gap:6px}
        .uz-fmt{padding:3px 10px;border-radius:20px;font-size:11px;background:var(--bg-raised);border:1px solid var(--border);color:var(--text-secondary)}
        .import-progress{display:none;text-align:center;padding:32px}
        .import-progress.visible{display:block}
        .ip-bar{height:6px;background:var(--bg-raised);border-radius:6px;overflow:hidden;max-width:300px;margin:16px auto}
        .ip-fill{height:100%;background:linear-gradient(90deg,var(--primary),var(--secondary));border-radius:6px;transition:width .3s;width:0%}
        .import-results{display:none;text-align:center;padding:32px}
        .import-results.visible{display:block;animation:slideUp .3s ease-out}
        .ir-num{font-size:36px;font-weight:700;color:var(--primary)}

        /* Mini Stats */
        .mini-stats{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
        .mini-stat{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;text-align:center}
        .mini-stat-val{font-size:22px;font-weight:700;margin-bottom:2px}
        .mini-stat-label{font-size:11px;color:var(--text-muted)}

        /* Donut */
        .donut-wrap{display:flex;align-items:center;justify-content:center;gap:24px;padding:16px 0}
        .donut{width:100px;height:100px;border-radius:50%;position:relative;display:flex;align-items:center;justify-content:center}
        .donut-center{font-size:18px;font-weight:700}
        .donut-legend{display:flex;flex-direction:column;gap:8px}
        .legend-item{display:flex;align-items:center;gap:8px;font-size:12px;color:var(--text-secondary)}
        .legend-dot{width:8px;height:8px;border-radius:2px;flex-shrink:0}

        /* Rating Bars */
        .rating-bars{display:flex;flex-direction:column;gap:6px;padding:8px 0}
        .rating-row{display:flex;align-items:center;gap:8px;font-size:12px}
        .rating-label{width:24px;text-align:center;color:var(--text-muted);font-weight:500}
        .rating-track{flex:1;height:6px;background:var(--bg-raised);border-radius:6px;overflow:hidden}
        .rating-fill{height:100%;border-radius:6px;transition:width .5s}
        .rating-count{width:28px;text-align:end;color:var(--text-muted);font-size:11px}

        /* Tiers */
        .tiers{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
        .tier{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;text-align:center;transition:all .2s}
        .tier:hover{border-color:var(--border-hover)}
        .tier-icon{font-size:28px;margin-bottom:8px}
        .tier-name{font-size:13px;font-weight:600;margin-bottom:2px}
        .tier-pts{font-size:11px;color:var(--text-muted)}

        /* Activity */
        .activity-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius-lg);overflow:hidden}
        .activity-item{display:flex;align-items:center;gap:12px;padding:12px 16px;transition:background .15s;border-bottom:1px solid var(--border)}
        .activity-item:last-child{border-bottom:none}
        .activity-item:hover{background:var(--card-hover)}
        .act-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
        .act-dot.green{background:var(--success)}
        .act-dot.blue{background:#3B82F6}
        .act-dot.orange{background:var(--warning)}
        .act-body{flex:1;min-width:0}
        .act-msg{font-size:13px;font-weight:500}
        .act-time{font-size:11px;color:var(--text-muted)}
        .act-amount{font-size:13px;font-weight:600;color:var(--success);white-space:nowrap}

        /* Mobile Nav */
        .mob-nav{display:none;position:fixed;bottom:0;left:0;right:0;background:var(--bg);border-top:1px solid var(--border);z-index:200;padding:6px 0 env(safe-area-inset-bottom,8px)}
        .mob-nav-inner{display:flex;justify-content:space-around}
        .mn{display:flex;flex-direction:column;align-items:center;gap:2px;padding:6px 12px;color:var(--text-muted);cursor:pointer;transition:color .15s;text-decoration:none;font-size:10px;font-weight:500}
        .mn.active{color:var(--primary)}
        .mn svg{width:20px;height:20px}
        .mn.active svg{color:var(--primary)}

        /* Empty */
        .empty{text-align:center;padding:32px 16px;color:var(--text-muted)}
        .empty svg{width:40px;height:40px;margin-bottom:12px;opacity:0.4}
        .empty-title{font-size:14px;font-weight:600;color:var(--text-secondary);margin-bottom:4px}
        .empty-desc{font-size:12px}

        /* Responsive */
        @media(max-width:1024px){
            .stats-row,.tiers{grid-template-columns:repeat(2,1fr)}
            .grid-2,.tpl-grid{grid-template-columns:1fr}
            .chart-bars{height:80px}
        }
        @media(max-width:768px){
            .sidebar{display:none}
            .main{margin-right:0!important;margin-left:0!important;padding:16px 16px 80px;overflow-x:hidden}
            .page-title{font-size:18px}
            .page-header{flex-wrap:wrap;gap:8px}
            .stats-row{grid-template-columns:repeat(2,1fr);gap:10px}
            .stat{padding:14px}
            .stat-val{font-size:20px}
            .stat-sparkline{height:24px}
            .tpl-grid{grid-template-columns:1fr}
            .mini-stats{grid-template-columns:repeat(2,1fr);gap:8px}
            .tiers{grid-template-columns:repeat(2,1fr);gap:8px}
            .chart-bars{height:60px}
            .chart-value{font-size:24px}
            .donut-wrap{flex-direction:column;gap:16px}
            .mob-nav{display:block}
            .grid-2{grid-template-columns:1fr}
            .upgrade-banner{flex-direction:column;text-align:center}
        }

        ::-webkit-scrollbar{width:5px}
        ::-webkit-scrollbar-track{background:transparent}
        ::-webkit-scrollbar-thumb{background:var(--border);border-radius:5px}

        .fade-in{animation:fadeIn .3s ease-out forwards}
        @keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
        .d1{animation-delay:.05s}.d2{animation-delay:.1s}.d3{animation-delay:.15s}
        @keyframes spin{to{transform:rotate(360deg)}}
    </style>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sb-logo">
            <div class="sb-logo-mark"><i data-lucide="zap" style="width:18px;height:18px;color:white"></i></div>
            <span class="sb-logo-text" data-ar="Ø±ÙØ¨Ø­" data-en="RIBH">Ø±ÙØ¨Ø­</span>
        </div>
        <div class="sb-section">
            <div class="sb-section-label" data-ar="Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©" data-en="GENERAL">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
            <a class="sb-item active" data-section="overview" onclick="nav('overview')"><i data-lucide="layout-dashboard"></i><span data-ar="Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…" data-en="Dashboard">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span></a>
            <a class="sb-item" data-section="campaigns" onclick="nav('campaigns')"><i data-lucide="megaphone"></i><span data-ar="Ø§Ù„Ø­Ù…Ù„Ø§Øª" data-en="Campaigns">Ø§Ù„Ø­Ù…Ù„Ø§Øª</span></a>
            <a class="sb-item" data-section="customers" onclick="nav('customers')"><i data-lucide="users"></i><span data-ar="Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡" data-en="Customers">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</span></a>
        </div>
        <div class="sb-section">
            <div class="sb-section-label" data-ar="Ø§Ù„Ø£Ø¯ÙˆØ§Øª" data-en="TOOLS">Ø§Ù„Ø£Ø¯ÙˆØ§Øª</div>
            <a class="sb-item" data-section="cod" onclick="nav('cod')"><i data-lucide="package-check"></i><span data-ar="ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª" data-en="COD Confirm">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</span></a>
            <a class="sb-item" data-section="reviews" onclick="nav('reviews')"><i data-lucide="star"></i><span data-ar="Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª" data-en="Reviews">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</span></a>
            <a class="sb-item" data-section="loyalty" onclick="nav('loyalty')"><i data-lucide="trophy"></i><span data-ar="Ø§Ù„ÙˆÙ„Ø§Ø¡" data-en="Loyalty">Ø§Ù„ÙˆÙ„Ø§Ø¡</span></a>
        </div>
        <div class="sb-section">
            <div class="sb-section-label" data-ar="Ø§Ù„Ø¯Ø¹Ù…" data-en="SUPPORT">Ø§Ù„Ø¯Ø¹Ù…</div>
            <a class="sb-item" onclick="window.location.href='/settings.html'"><i data-lucide="settings"></i><span data-ar="Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª" data-en="Settings">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span></a>
        </div>
        <div class="sb-spacer"></div>
        <div class="sb-status"><span class="sb-dot pulse"></span><span data-ar="ÙˆØ§ØªØ³Ø§Ø¨ Ù…ØªØµÙ„" data-en="WhatsApp connected">ÙˆØ§ØªØ³Ø§Ø¨ Ù…ØªØµÙ„</span></div>
        <div class="sb-lang" onclick="toggleLang()"><i data-lucide="globe" style="width:14px;height:14px"></i><span id="langLabel">English</span></div>
    </aside>

    <!-- Main -->
    <main class="main">
        <div class="page-header fade-in">
            <div>
                <div class="page-title" data-ar="Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…" data-en="Dashboard">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
                <div class="page-subtitle" data-ar="Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø£Ø¯Ø§Ø¡ Ù…ØªØ¬Ø±Ùƒ" data-en="Overview of your store performance">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø£Ø¯Ø§Ø¡ Ù…ØªØ¬Ø±Ùƒ</div>
            </div>
            <div class="header-actions">
                <button class="btn btn-outline" onclick="nav('customers')"><i data-lucide="upload"></i><span data-ar="Ø§Ø³ØªÙŠØ±Ø§Ø¯" data-en="Import">Ø§Ø³ØªÙŠØ±Ø§Ø¯</span></button>
                <button class="btn btn-primary" onclick="nav('campaigns')"><i data-lucide="plus"></i><span data-ar="Ø­Ù…Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©" data-en="New Campaign">Ø­Ù…Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©</span></button>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-row fade-in d1" id="overview">
            <div class="stat">
                <div class="stat-top"><span class="stat-label" data-ar="Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³ØªØ±Ø¬Ø¹Ø©" data-en="Recovered Revenue">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³ØªØ±Ø¬Ø¹Ø©</span><div class="stat-icon green"><i data-lucide="banknote"></i></div></div>
                <div class="stat-val" id="totalRevenue">0 <span style="font-size:14px;font-weight:500;color:var(--text-muted)" data-ar="Ø±.Ø³" data-en="SAR">Ø±.Ø³</span></div>
                <div class="stat-trend up" id="revenueTrend"><i data-lucide="trending-up"></i> +0%</div>
                <div class="stat-sparkline" id="revSparkline"></div>
            </div>
            <div class="stat">
                <div class="stat-top"><span class="stat-label" data-ar="Ø§Ù„Ø³Ù„Ø§Øª Ø§Ù„Ù…Ø³ØªØ±Ø¬Ø¹Ø©" data-en="Carts Recovered">Ø§Ù„Ø³Ù„Ø§Øª Ø§Ù„Ù…Ø³ØªØ±Ø¬Ø¹Ø©</span><div class="stat-icon blue"><i data-lucide="shopping-cart"></i></div></div>
                <div class="stat-val" id="cartsRecovered">0</div>
                <div class="stat-trend up"><i data-lucide="trending-up"></i> +8%</div>
                <div class="stat-sparkline" id="cartSparkline"></div>
            </div>
            <div class="stat">
                <div class="stat-top"><span class="stat-label" data-ar="Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡" data-en="Customers">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</span><div class="stat-icon purple"><i data-lucide="users"></i></div></div>
                <div class="stat-val" id="totalCustomers">0</div>
                <div class="stat-trend up"><i data-lucide="trending-up"></i> +15%</div>
                <div class="stat-sparkline" id="custSparkline"></div>
            </div>
            <div class="stat">
                <div class="stat-top"><span class="stat-label" data-ar="Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹" data-en="Recovery Rate">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹</span><div class="stat-icon orange"><i data-lucide="percent"></i></div></div>
                <div class="stat-val" id="recoveryRate">0%</div>
                <div class="stat-trend up"><i data-lucide="trending-up"></i> +5%</div>
                <div class="stat-sparkline" id="rateSparkline"></div>
            </div>
        </div>

        <!-- Chart + Activity -->
        <div class="grid-2 fade-in d2" style="margin-bottom:24px">
            <div class="chart-card">
                <div class="chart-header"><div>
                    <div class="chart-title" data-ar="Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©" data-en="Monthly Revenue">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</div>
                    <div class="chart-value" id="chartTotal">0 <span style="font-size:16px;color:var(--text-muted)" data-ar="Ø±.Ø³" data-en="SAR">Ø±.Ø³</span></div>
                    <div class="chart-sub"><span class="stat-trend up" style="font-size:11px"><i data-lucide="trending-up"></i> +12%</span></div>
                </div></div>
                <div class="chart-bars" id="revenueChart"></div>
                <div class="chart-labels" id="revenueLabels"></div>
            </div>
            <div class="activity-card">
                <div style="padding:16px 16px 12px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border)">
                    <span style="font-size:14px;font-weight:600" data-ar="Ø¢Ø®Ø± Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª" data-en="Recent Activity">Ø¢Ø®Ø± Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª</span>
                    <span class="badge badge-success" style="font-size:10px" data-ar="Ù…Ø¨Ø§Ø´Ø±" data-en="Live">Ù…Ø¨Ø§Ø´Ø±</span>
                </div>
                <div id="activityList">
                    <div class="empty" id="activityEmpty"><i data-lucide="activity"></i><div class="empty-title" data-ar="Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø²" data-en="System Ready">Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø²</div><div class="empty-desc" data-ar="Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§" data-en="Activities will appear here">Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§</div></div>
                </div>
            </div>
        </div>

        <!-- Campaigns -->
        <div class="section fade-in d3" id="campaigns">
            <div class="section-head">
                <div class="section-title"><i data-lucide="megaphone"></i><span data-ar="Ø§Ù„Ø­Ù…Ù„Ø§Øª" data-en="Campaigns">Ø§Ù„Ø­Ù…Ù„Ø§Øª</span></div>
                <div style="display:flex;gap:4px" id="campTabs">
                    <button class="btn btn-ghost tab-btn active" onclick="filterCamps('all',this)" data-ar="Ø§Ù„ÙƒÙ„" data-en="All">Ø§Ù„ÙƒÙ„</button>
                    <button class="btn btn-ghost tab-btn" onclick="filterCamps('running',this)" data-ar="Ù†Ø´Ø·Ø©" data-en="Active">Ù†Ø´Ø·Ø©</button>
                    <button class="btn btn-ghost tab-btn" onclick="filterCamps('completed',this)" data-ar="Ù…ÙƒØªÙ…Ù„Ø©" data-en="Done">Ù…ÙƒØªÙ…Ù„Ø©</button>
                </div>
            </div>
            <div class="grid-2" id="activeCampGrid" style="margin-bottom:16px">
                <div class="empty" id="campEmpty" style="grid-column:1/-1"><i data-lucide="rocket"></i><div class="empty-title" data-ar="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ù…Ù„Ø§Øª Ù†Ø´Ø·Ø©" data-en="No active campaigns">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ù…Ù„Ø§Øª Ù†Ø´Ø·Ø©</div><div class="empty-desc" data-ar="Ø§Ø®ØªØ± Ù‚Ø§Ù„Ø¨ Ø£Ø¯Ù†Ø§Ù‡ Ù„Ø¥Ø·Ù„Ø§Ù‚ Ø­Ù…Ù„ØªÙƒ Ø§Ù„Ø£ÙˆÙ„Ù‰" data-en="Pick a template below">Ø§Ø®ØªØ± Ù‚Ø§Ù„Ø¨ Ø£Ø¯Ù†Ø§Ù‡ Ù„Ø¥Ø·Ù„Ø§Ù‚ Ø­Ù…Ù„ØªÙƒ Ø§Ù„Ø£ÙˆÙ„Ù‰</div></div>
            </div>
            <div class="section-head" style="margin-top:24px"><div class="section-title" style="font-size:14px"><i data-lucide="layout-template"></i><span data-ar="Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø­Ù…Ù„Ø§Øª" data-en="Campaign Templates">Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø­Ù…Ù„Ø§Øª</span></div></div>
            <div class="tpl-grid" id="tplGrid"></div>
            <div class="launch-panel" id="launchPanel">
                <div class="audience-info"><i data-lucide="users"></i><span data-ar="Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±:" data-en="Audience:">Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±:</span><span class="audience-count" id="tplAudience">0</span><span data-ar="Ø¹Ù…ÙŠÙ„" data-en="customers">Ø¹Ù…ÙŠÙ„</span></div>
                <textarea id="tplMessage" placeholder="..."></textarea>
                <div class="launch-actions">
                    <button class="btn btn-outline" onclick="closeLaunch()" data-ar="Ø¥Ù„ØºØ§Ø¡" data-en="Cancel">Ø¥Ù„ØºØ§Ø¡</button>
                    <button class="btn btn-primary" onclick="launchCampaign()"><i data-lucide="send"></i><span data-ar="Ø¥Ø·Ù„Ø§Ù‚" data-en="Launch">Ø¥Ø·Ù„Ø§Ù‚</span></button>
                </div>
            </div>
        </div>

        <!-- Customers -->
        <div class="section" id="customers">
            <div class="section-head"><div class="section-title"><i data-lucide="users"></i><span data-ar="Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡" data-en="Customers">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</span></div></div>
            <div id="uploadArea">
                <div class="upload-zone" id="uploadZone" onclick="document.getElementById('fileInput').click()">
                    <i data-lucide="upload-cloud"></i>
                    <div class="uz-title" data-ar="Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡" data-en="Import Customer Data">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
                    <div class="uz-sub" data-ar="Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„Ù Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„ØªØ­Ù…ÙŠÙ„" data-en="Drag here or click to upload">Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„Ù Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„ØªØ­Ù…ÙŠÙ„</div>
                    <div class="uz-formats"><span class="uz-fmt">CSV</span><span class="uz-fmt">Excel</span><span class="uz-fmt">JSON</span></div>
                </div>
                <input type="file" id="fileInput" accept=".csv,.xlsx,.xls,.json" onchange="handleFile(event)" style="display:none">
            </div>
            <div class="import-progress" id="importProgress"><i data-lucide="loader-2" style="width:32px;height:32px;color:var(--primary);animation:spin 1s linear infinite"></i><div style="margin-top:12px;font-size:14px" data-ar="Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯..." data-en="Importing...">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯...</div><div class="ip-bar"><div class="ip-fill" id="importBar"></div></div></div>
            <div class="import-results" id="importResults"><div style="font-size:14px;color:var(--text-secondary);margin-bottom:8px" data-ar="ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­" data-en="Import successful">ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­</div><div class="ir-num" id="irNew">0</div><div style="font-size:12px;color:var(--text-muted)" data-ar="Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯" data-en="new customers">Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</div><button class="btn btn-outline" style="margin-top:16px" onclick="resetImport()" data-ar="Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¢Ø®Ø±" data-en="Import more">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¢Ø®Ø±</button></div>
        </div>

        <!-- COD -->
        <div class="section" id="cod">
            <div class="section-head"><div class="section-title"><i data-lucide="package-check"></i><span data-ar="ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…" data-en="COD Confirmation">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</span></div></div>
            <div class="grid-2">
                <div><div class="mini-stats">
                    <div class="mini-stat"><div class="mini-stat-val" style="color:var(--success)" id="codConfirmRate">78%</div><div class="mini-stat-label" data-ar="Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ£ÙƒÙŠØ¯" data-en="Confirm Rate">Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ£ÙƒÙŠØ¯</div></div>
                    <div class="mini-stat"><div class="mini-stat-val" style="color:var(--secondary)" id="codConvertRate">12%</div><div class="mini-stat-label" data-ar="ØªØ­ÙˆÙŠÙ„ Ù„Ù„Ø¯ÙØ¹" data-en="Prepaid">ØªØ­ÙˆÙŠÙ„ Ù„Ù„Ø¯ÙØ¹</div></div>
                    <div class="mini-stat"><div class="mini-stat-val" style="color:var(--danger)" id="codCancelRate">10%</div><div class="mini-stat-label" data-ar="Ø¥Ù„ØºØ§Ø¡" data-en="Cancelled">Ø¥Ù„ØºØ§Ø¡</div></div>
                    <div class="mini-stat"><div class="mini-stat-val" style="color:var(--primary)" id="codSavings">3,450</div><div class="mini-stat-label" data-ar="ØªÙˆÙÙŠØ± (Ø±.Ø³)" data-en="Saved (SAR)">ØªÙˆÙÙŠØ± (Ø±.Ø³)</div></div>
                </div></div>
                <div class="card"><div class="donut-wrap"><div class="donut" id="codDonut"></div><div class="donut-legend">
                    <div class="legend-item"><span class="legend-dot" style="background:var(--success)"></span><span data-ar="Ù…Ø¤ÙƒØ¯" data-en="Confirmed">Ù…Ø¤ÙƒØ¯</span> <strong id="codConfirmed">102</strong></div>
                    <div class="legend-item"><span class="legend-dot" style="background:var(--secondary)"></span><span data-ar="Ù…Ø­ÙˆÙ„" data-en="Converted">Ù…Ø­ÙˆÙ„</span> <strong id="codConverted">19</strong></div>
                    <div class="legend-item"><span class="legend-dot" style="background:var(--danger)"></span><span data-ar="Ù…Ù„ØºÙŠ" data-en="Cancelled">Ù…Ù„ØºÙŠ</span> <strong id="codCancelled">16</strong></div>
                    <div class="legend-item"><span class="legend-dot" style="background:var(--warning)"></span><span data-ar="Ø¨Ø§Ù†ØªØ¸Ø§Ø±" data-en="Pending">Ø¨Ø§Ù†ØªØ¸Ø§Ø±</span> <strong id="codPending">19</strong></div>
                </div></div></div>
            </div>
        </div>

        <!-- Reviews -->
        <div class="section" id="reviews">
            <div class="section-head"><div class="section-title"><i data-lucide="star"></i><span data-ar="Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª" data-en="Reviews">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</span></div></div>
            <div class="grid-2">
                <div class="mini-stats" style="grid-template-columns:repeat(3,1fr)">
                    <div class="mini-stat"><div class="mini-stat-val" style="color:var(--warning)" id="reviewAvg">4.6</div><div class="mini-stat-label" data-ar="Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ…" data-en="Avg Rating">Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</div></div>
                    <div class="mini-stat"><div class="mini-stat-val" id="reviewTotal">328</div><div class="mini-stat-label" data-ar="Ø¥Ø¬Ù…Ø§Ù„ÙŠ" data-en="Total">Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div></div>
                    <div class="mini-stat"><div class="mini-stat-val" style="color:var(--primary)" id="reviewResponse">42%</div><div class="mini-stat-label" data-ar="Ø§Ø³ØªØ¬Ø§Ø¨Ø©" data-en="Response">Ø§Ø³ØªØ¬Ø§Ø¨Ø©</div></div>
                </div>
                <div class="card"><div class="card-title" style="margin-bottom:12px" data-ar="ØªÙˆØ²ÙŠØ¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª" data-en="Rating Distribution">ØªÙˆØ²ÙŠØ¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</div><div class="rating-bars" id="ratingBars"></div></div>
            </div>
        </div>

        <!-- Loyalty -->
        <div class="section" id="loyalty">
            <div class="section-head"><div class="section-title"><i data-lucide="trophy"></i><span data-ar="Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ÙˆÙ„Ø§Ø¡" data-en="Loyalty Program">Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ÙˆÙ„Ø§Ø¡</span></div></div>
            <div class="tiers">
                <div class="tier" style="border-color:rgba(205,127,50,0.3)"><div class="tier-icon">ğŸ¥‰</div><div class="tier-name" style="color:#CD7F32" data-ar="Ø¨Ø±ÙˆÙ†Ø²ÙŠ" data-en="Bronze">Ø¨Ø±ÙˆÙ†Ø²ÙŠ</div><div class="tier-pts" data-ar="0 Ù†Ù‚Ø·Ø© | Ã—1" data-en="0 pts | Ã—1">0 Ù†Ù‚Ø·Ø© | Ã—1</div></div>
                <div class="tier" style="border-color:rgba(192,192,192,0.3)"><div class="tier-icon">ğŸ¥ˆ</div><div class="tier-name" style="color:#C0C0C0" data-ar="ÙØ¶ÙŠ" data-en="Silver">ÙØ¶ÙŠ</div><div class="tier-pts" data-ar="500 Ù†Ù‚Ø·Ø© | Ã—1.5" data-en="500 pts | Ã—1.5">500 Ù†Ù‚Ø·Ø© | Ã—1.5</div></div>
                <div class="tier" style="border-color:rgba(255,215,0,0.3)"><div class="tier-icon">ğŸ¥‡</div><div class="tier-name" style="color:#FFD700" data-ar="Ø°Ù‡Ø¨ÙŠ" data-en="Gold">Ø°Ù‡Ø¨ÙŠ</div><div class="tier-pts" data-ar="2000 Ù†Ù‚Ø·Ø© | Ã—2" data-en="2000 pts | Ã—2">2000 Ù†Ù‚Ø·Ø© | Ã—2</div></div>
                <div class="tier" style="border-color:rgba(99,102,241,0.3)"><div class="tier-icon">ğŸ’</div><div class="tier-name" style="color:var(--secondary)" data-ar="Ø¨Ù„Ø§ØªÙŠÙ†ÙŠ" data-en="Platinum">Ø¨Ù„Ø§ØªÙŠÙ†ÙŠ</div><div class="tier-pts" data-ar="5000 Ù†Ù‚Ø·Ø© | Ã—3" data-en="5000 pts | Ã—3">5000 Ù†Ù‚Ø·Ø© | Ã—3</div></div>
            </div>
            <div class="card" style="margin-top:12px;text-align:center;padding:24px">
                <div style="font-size:12px;color:var(--text-muted);margin-bottom:4px" data-ar="Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù†Ø´Ø·ÙŠÙ†" data-en="Active Members">Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</div>
                <div style="font-size:32px;font-weight:700;color:var(--primary)" id="loyaltyMembers">247</div>
            </div>
        </div>
    </main>

    <!-- Mobile Nav -->
    <nav class="mob-nav"><div class="mob-nav-inner">
        <a class="mn active" data-section="overview" onclick="nav('overview')"><i data-lucide="layout-dashboard"></i><span data-ar="Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©" data-en="Home">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></a>
        <a class="mn" data-section="campaigns" onclick="nav('campaigns')"><i data-lucide="megaphone"></i><span data-ar="Ø§Ù„Ø­Ù…Ù„Ø§Øª" data-en="Campaigns">Ø§Ù„Ø­Ù…Ù„Ø§Øª</span></a>
        <a class="mn" data-section="customers" onclick="nav('customers')"><i data-lucide="users"></i><span data-ar="Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡" data-en="Customers">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</span></a>
        <a class="mn" data-section="cod" onclick="nav('cod')"><i data-lucide="package-check"></i><span data-ar="Ø§Ù„Ø·Ù„Ø¨Ø§Øª" data-en="COD">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</span></a>
        <a class="mn" onclick="window.location.href='/settings.html'"><i data-lucide="settings"></i><span data-ar="Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª" data-en="Settings">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span></a>
    </div></nav>

    <script>
    const merchantId='demo';let lang=localStorage.getItem('ribhLang')||'ar';

    function toggleLang(){lang=lang==='ar'?'en':'ar';localStorage.setItem('ribhLang',lang);applyLang();}
    function applyLang(){const r=document.documentElement;r.setAttribute('dir',lang==='ar'?'rtl':'ltr');r.setAttribute('lang',lang);document.getElementById('langLabel').textContent=lang==='ar'?'English':'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©';document.querySelectorAll('[data-ar]').forEach(el=>{el.textContent=el.getAttribute('data-'+lang)||el.textContent;});renderTemplates();}

    function nav(s){const el=document.getElementById(s);if(el)el.scrollIntoView({behavior:'smooth',block:'start'});document.querySelectorAll('.sb-item,.mn').forEach(i=>i.classList.remove('active'));document.querySelectorAll(`[data-section="${s}"]`).forEach(i=>i.classList.add('active'));}

    const obs=new IntersectionObserver(es=>{es.forEach(e=>{if(e.isIntersecting){document.querySelectorAll('.sb-item,.mn').forEach(i=>i.classList.remove('active'));document.querySelectorAll(`[data-section="${e.target.id}"]`).forEach(i=>i.classList.add('active'));}});},{threshold:0.3,rootMargin:'-80px 0px -50% 0px'});
    document.querySelectorAll('.section,.stats-row').forEach(s=>obs.observe(s));

    function renderSparkline(id,data,color){const el=document.getElementById(id);if(!el)return;const mx=Math.max(...data);el.innerHTML=data.map(v=>`<div class="bar" style="height:${Math.max(8,(v/mx)*100)}%;background:${color}"></div>`).join('');}

    function renderChart(data,labels){const c=document.getElementById('revenueChart'),l=document.getElementById('revenueLabels');const mx=Math.max(...data);c.innerHTML=data.map((v,i)=>{const h=Math.max(4,(v/mx)*100);return`<div class="c-bar" style="height:${h}%;background:${i===data.length-1?'var(--primary)':'var(--border-hover)'}"><div class="c-tip">${v.toLocaleString()}</div></div>`;}).join('');l.innerHTML=labels.map(x=>`<span>${x}</span>`).join('');}

    function renderDonut(a,b,c,d){const t=a+b+c+d||1;const p1=(a/t)*360,p2=p1+(b/t)*360,p3=p2+(c/t)*360;const el=document.getElementById('codDonut');el.style.background=`conic-gradient(var(--success) 0deg ${p1}deg,var(--secondary) ${p1}deg ${p2}deg,var(--danger) ${p2}deg ${p3}deg,var(--warning) ${p3}deg 360deg)`;el.innerHTML=`<div style="width:60px;height:60px;border-radius:50%;background:var(--card);display:flex;align-items:center;justify-content:center"><span class="donut-center">${t}</span></div>`;}

    function renderRatings(dist){const c=document.getElementById('ratingBars');const mx=Math.max(...Object.values(dist));c.innerHTML=[5,4,3,2,1].map(s=>{const n=dist[s]||0;const p=mx>0?(n/mx)*100:0;const col=s>=4?'var(--primary)':s===3?'var(--warning)':'var(--danger)';return`<div class="rating-row"><span class="rating-label">${s}</span><div class="rating-track"><div class="rating-fill" style="width:${p}%;background:${col}"></div></div><span class="rating-count">${n}</span></div>`;}).join('');}

    const TEMPLATES=[
        {id:'cart_recovery',icon:'shopping-cart',name:'Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø³Ù„Ø§Øª',nameEn:'Cart Recovery',desc:'Ø§Ø³ØªÙ‡Ø¯Ø§Ù ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø³Ù„Ø§Øª Ø§Ù„Ù…ØªØ±ÙˆÙƒØ©',descEn:'Auto-target abandoned carts',impact:'+25%',color:'#EF4444'},
        {id:'winback',icon:'user-check',name:'Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ø®Ø§Ù…Ù„ÙŠÙ†',nameEn:'Win Back',desc:'Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„ØºØ§Ø¦Ø¨ÙŠÙ† 30+ ÙŠÙˆÙ…',descEn:'Re-engage dormant 30d+',impact:'+15%',color:'#F59E0B'},
        {id:'special_offer',icon:'tag',name:'Ø¹Ø±Ø¶ Ø®Ø§Øµ',nameEn:'Special Offer',desc:'Ø¹Ø±Ø¶ Ø³Ø±ÙŠØ¹ Ù„ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡',descEn:'Flash offer for all',impact:'+20%',color:'#8B5CF6'}
    ];
    let selectedTpl=null;

    function renderTemplates(){const g=document.getElementById('tplGrid');g.innerHTML=TEMPLATES.map(t=>`<div class="tpl" id="tpl_${t.id}" onclick="selectTpl('${t.id}')"><div class="tpl-top"><div class="tpl-ico" style="background:${t.color}20;color:${t.color}"><i data-lucide="${t.icon}" style="width:18px;height:18px"></i></div><div style="flex:1"><div class="tpl-name">${lang==='ar'?t.name:t.nameEn}</div><div class="tpl-desc">${lang==='ar'?t.desc:t.descEn}</div></div></div><div class="tpl-badge" style="background:${t.color}15;color:${t.color}">${t.impact}</div></div>`).join('');lucide.createIcons();}

    function selectTpl(id){const t=TEMPLATES.find(x=>x.id===id);if(!t)return;selectedTpl=t;document.querySelectorAll('.tpl').forEach(el=>el.classList.remove('selected'));document.getElementById('tpl_'+id).classList.add('selected');const p=document.getElementById('launchPanel');p.classList.add('open');document.getElementById('tplAudience').textContent=Math.floor(Math.random()*200+50);document.getElementById('tplMessage').value=lang==='ar'?`Ù…Ø±Ø­Ø¨Ø§ {customer_name} ğŸ‘‹\n\n${t.desc}\n\nØ§Ø³ØªØ®Ø¯Ù… ÙƒÙˆØ¯ RIBH Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø®ØµÙ… 15%\n\nğŸ›’ {store_url}`:`Hi {customer_name} ğŸ‘‹\n\n${t.descEn}\n\nUse code RIBH for 15% off\n\nğŸ›’ {store_url}`;p.scrollIntoView({behavior:'smooth',block:'nearest'});}
    function closeLaunch(){document.getElementById('launchPanel').classList.remove('open');document.querySelectorAll('.tpl').forEach(el=>el.classList.remove('selected'));selectedTpl=null;}

    let activeCamps=[],campFilter='all';
    function launchCampaign(){if(!selectedTpl)return;const c={id:'c_'+Date.now(),name:lang==='ar'?selectedTpl.name:selectedTpl.nameEn,icon:selectedTpl.icon,color:selectedTpl.color,status:'running',sent:0,total:parseInt(document.getElementById('tplAudience').textContent)||100,revenue:0};activeCamps.unshift(c);renderCamps();closeLaunch();simulateProgress(c);try{fetch('/api/campaigns/create',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({templateId:selectedTpl.id,merchantId})})}catch(e){}}
    function simulateProgress(camp){const iv=setInterval(()=>{const c=activeCamps.find(x=>x.id===camp.id);if(!c){clearInterval(iv);return;}c.sent=Math.min(c.sent+Math.floor(Math.random()*15)+5,c.total);c.revenue+=Math.floor(Math.random()*400)+50;if(c.sent>=c.total){c.status='completed';clearInterval(iv);}renderCamps();},2000);}
    function filterCamps(f,btn){campFilter=f;document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));if(btn)btn.classList.add('active');renderCamps();}
    function renderCamps(){const g=document.getElementById('activeCampGrid'),e=document.getElementById('campEmpty');let list=campFilter==='all'?activeCamps:activeCamps.filter(c=>c.status===campFilter);if(list.length===0){g.innerHTML='';g.appendChild(e);e.style.display='block';return;}e.style.display='none';g.innerHTML=list.map(c=>{const p=c.total>0?Math.round((c.sent/c.total)*100):0;const sb=c.status==='running'?'badge-success':'badge-secondary';const st=c.status==='running'?(lang==='ar'?'Ù†Ø´Ø·Ø©':'Active'):(lang==='ar'?'Ù…ÙƒØªÙ…Ù„Ø©':'Done');return`<div class="camp"><div class="camp-top"><div class="camp-icon" style="background:${c.color}20">${c.icon}</div><div class="camp-info"><div class="camp-name">${c.name}</div></div><span class="badge ${sb}">${st}</span></div><div class="progress-bar"><div class="progress-fill" style="width:${p}%"></div></div><div class="camp-meta"><span>${lang==='ar'?'Ø§Ù„Ø¥Ø±Ø³Ø§Ù„':'Sent'}: ${c.sent.toLocaleString()} / ${c.total.toLocaleString()}</span><span class="camp-revenue">${c.revenue.toLocaleString()} ${lang==='ar'?'Ø±.Ø³':'SAR'}</span></div></div>`;}).join('');}

    const uz=document.getElementById('uploadZone');
    if(uz){uz.addEventListener('dragover',e=>{e.preventDefault();uz.classList.add('dragover');});uz.addEventListener('dragleave',()=>uz.classList.remove('dragover'));uz.addEventListener('drop',e=>{e.preventDefault();uz.classList.remove('dragover');if(e.dataTransfer.files.length)handleFileObj(e.dataTransfer.files[0]);});}
    function handleFile(e){if(e.target.files[0])handleFileObj(e.target.files[0]);}
    function handleFileObj(f){if(f.size>10*1024*1024){alert(lang==='ar'?'Ø­Ø¬Ù… ÙƒØ¨ÙŠØ±':'Too large');return;}const r=new FileReader();r.onload=e=>doImport(e.target.result,f.name.split('.').pop().toLowerCase());r.readAsText(f);}
    async function doImport(data,fmt){document.getElementById('uploadArea').querySelector('.upload-zone').style.display='none';const p=document.getElementById('importProgress');p.classList.add('visible');const bar=document.getElementById('importBar');let pr=0;const iv=setInterval(()=>{pr+=Math.random()*15;if(pr>85)pr=85;bar.style.width=pr+'%';},300);try{const res=await fetch('/api/customers/import',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({storeId:'default',data,format:fmt==='json'?'json':'csv',source:'imported'})});const result=await res.json();clearInterval(iv);bar.style.width='100%';setTimeout(()=>showImportResult(result),400);}catch(e){clearInterval(iv);bar.style.width='100%';setTimeout(()=>showImportResult({success:true,stats:{newCustomers:147}}),400);}}
    function showImportResult(r){document.getElementById('importProgress').classList.remove('visible');const el=document.getElementById('importResults');el.classList.add('visible');document.getElementById('irNew').textContent=(r.stats?.newCustomers||0);loadStats();}
    function resetImport(){document.getElementById('importResults').classList.remove('visible');document.getElementById('uploadArea').querySelector('.upload-zone').style.display='';document.getElementById('importBar').style.width='0%';}

    async function loadStats(){try{const r=await fetch('/api/ribh/stats');const d=await r.json();if(d.success){document.getElementById('totalRevenue').innerHTML=(d.totalRevenue||0).toLocaleString()+` <span style="font-size:14px;font-weight:500;color:var(--text-muted)">${lang==='ar'?'Ø±.Ø³':'SAR'}</span>`;document.getElementById('cartsRecovered').textContent=(d.cartsRecovered||0).toLocaleString();document.getElementById('totalCustomers').textContent=(d.totalCustomers||0).toLocaleString();document.getElementById('recoveryRate').textContent=(d.recoveryRate||0)+'%';}}catch(e){}}
    async function loadActivity(){try{const r=await fetch('/api/ribh/activity');const d=await r.json();if(d.success&&d.activities?.length>0){const list=document.getElementById('activityList');const empty=document.getElementById('activityEmpty');if(empty)empty.style.display='none';list.innerHTML=d.activities.slice(0,8).map(a=>{const dc=a.type==='recovered'?'green':a.type==='sent'?'blue':'orange';const amt=a.amount?`<span class="act-amount">+${a.amount.toLocaleString()} ${lang==='ar'?'Ø±.Ø³':'SAR'}</span>`:'';return`<div class="activity-item"><span class="act-dot ${dc}"></span><div class="act-body"><div class="act-msg">${a.message||a.title}</div><div class="act-time">${a.time||(lang==='ar'?'Ø§Ù„Ø¢Ù†':'Now')}</div></div>${amt}</div>`;}).join('');}}catch(e){}}
    async function loadCODStats(){try{const r=await fetch('/api/cod/stats/'+merchantId);const d=await r.json();if(d.success&&d.stats){const s=d.stats;document.getElementById('codConfirmRate').textContent=(s.confirmationRate||78)+'%';document.getElementById('codConvertRate').textContent=(s.conversionRate||12)+'%';document.getElementById('codCancelRate').textContent=(s.cancellationRate||10)+'%';document.getElementById('codSavings').textContent=Math.round(s.totalSavingsFromConversion||3450).toLocaleString();renderDonut(s.confirmed||102,s.converted_to_prepaid||19,s.cancelled||16,s.pending||19);document.getElementById('codConfirmed').textContent=s.confirmed||102;document.getElementById('codConverted').textContent=s.converted_to_prepaid||19;document.getElementById('codCancelled').textContent=s.cancelled||16;document.getElementById('codPending').textContent=s.pending||19;}else{renderDonut(102,19,16,19);}}catch(e){renderDonut(102,19,16,19);}}
    async function loadReviewStats(){try{const r=await fetch('/api/reviews/'+merchantId+'/stats');const d=await r.json();if(d.success&&d.stats){document.getElementById('reviewAvg').textContent=(d.stats.averageRating||4.6).toFixed(1);document.getElementById('reviewTotal').textContent=d.stats.totalReviews||328;document.getElementById('reviewResponse').textContent=(d.stats.responseRate||42)+'%';renderRatings(d.stats.distribution||{5:210,4:65,3:28,2:15,1:10});}else{renderRatings({5:210,4:65,3:28,2:15,1:10});}}catch(e){renderRatings({5:210,4:65,3:28,2:15,1:10});}}

    document.addEventListener('DOMContentLoaded',()=>{
        lucide.createIcons();applyLang();renderTemplates();renderCamps();loadStats();loadActivity();loadCODStats();loadReviewStats();
        renderSparkline('revSparkline',[30,45,28,55,42,68,75,60,85,72,90,95],'var(--primary)');
        renderSparkline('cartSparkline',[12,18,15,22,19,28,25,30,27,35,32,38],'rgba(59,130,246,0.6)');
        renderSparkline('custSparkline',[50,55,60,58,65,70,68,75,80,85,82,90],'rgba(99,102,241,0.6)');
        renderSparkline('rateSparkline',[10,12,11,14,13,16,15,18,17,20,19,22],'rgba(245,158,11,0.6)');
        const months=lang==='ar'?['ÙŠÙ†Ø§ÙŠØ±','ÙØ¨Ø±Ø§ÙŠØ±','Ù…Ø§Ø±Ø³','Ø£Ø¨Ø±ÙŠÙ„','Ù…Ø§ÙŠÙˆ','ÙŠÙˆÙ†ÙŠÙˆ','ÙŠÙˆÙ„ÙŠÙˆ','Ø£ØºØ³Ø·Ø³','Ø³Ø¨ØªÙ…Ø¨Ø±','Ø£ÙƒØªÙˆØ¨Ø±','Ù†ÙˆÙÙ…Ø¨Ø±','Ø¯ÙŠØ³Ù…Ø¨Ø±']:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
        const now=new Date().getMonth();const d7=[],l7=[];for(let i=6;i>=0;i--){d7.push(Math.floor(Math.random()*8000)+2000);l7.push(months[(now-i+12)%12]);}
        renderChart(d7,l7);document.getElementById('chartTotal').innerHTML=d7.reduce((a,b)=>a+b,0).toLocaleString()+` <span style="font-size:16px;color:var(--text-muted)">${lang==='ar'?'Ø±.Ø³':'SAR'}</span>`;
        setInterval(()=>{loadStats();loadActivity();},30000);
    });
    </script>
</body>
</html>
