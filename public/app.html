<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RIBH</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{
            --bg:#09090B;--bg-raised:#18181B;
            --card:#18181B;--card-hover:#1F1F23;
            --border:#27272A;--border-hover:#3F3F46;
            --text:#FAFAFA;--text-secondary:#A1A1AA;--text-muted:#71717A;
            --primary:#10B981;--primary-hover:#059669;--primary-muted:rgba(16,185,129,0.15);
            --secondary:#6366F1;--secondary-muted:rgba(99,102,241,0.15);
            --success:#22C55E;--warning:#F59E0B;--danger:#EF4444;
            --ring:rgba(16,185,129,0.3);
            --radius:12px;--radius-sm:8px;--radius-lg:16px;
            --sidebar-w:220px;
        }
        html{scroll-behavior:smooth;overflow-x:hidden;max-width:100vw}
        html[dir="ltr"]{font-family:'Inter',system-ui,sans-serif}
        html[dir="rtl"]{font-family:'IBM Plex Sans Arabic','Inter',system-ui,sans-serif}
        body{background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;font-size:14px;line-height:1.5;width:100%;max-width:100vw}

        /* ===== SIDEBAR ===== */
        .sidebar{width:var(--sidebar-w);background:var(--bg);border-left:1px solid var(--border);position:fixed;height:100vh;z-index:100;display:flex;flex-direction:column;padding:16px 12px;overflow-y:auto}
        html[dir="rtl"] .sidebar{right:0;border-left:1px solid var(--border);border-right:none}
        html[dir="ltr"] .sidebar{left:0;border-right:1px solid var(--border);border-left:none}
        .sb-logo{display:flex;align-items:center;gap:10px;padding:8px 12px;margin-bottom:24px}
        .sb-logo-mark{width:32px;height:32px;background:linear-gradient(135deg,#10B981,#059669);border-radius:8px;display:flex;align-items:center;justify-content:center}
        .sb-logo-mark svg{color:white}
        .sb-logo-text{font-size:18px;font-weight:700;letter-spacing:-0.02em}
        .sb-section{margin-bottom:20px}
        .sb-item{display:flex;align-items:center;gap:10px;padding:9px 12px;border-radius:var(--radius-sm);color:var(--text-secondary);cursor:pointer;transition:all .15s;font-size:13px;font-weight:500;text-decoration:none}
        .sb-item:hover{background:var(--bg-raised);color:var(--text)}
        .sb-item.active{background:var(--primary-muted);color:var(--primary)}
        .sb-item.active svg{color:var(--primary)}
        .sb-item svg{width:18px;height:18px;flex-shrink:0;color:var(--text-muted)}
        .sb-item:hover svg{color:var(--text-secondary)}
        .sb-spacer{flex:1}
        .sb-status{display:flex;align-items:center;gap:8px;padding:10px 12px;border-radius:var(--radius-sm);background:var(--bg-raised);font-size:12px;color:var(--text-secondary);margin-bottom:4px}
        .sb-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0}
        .sb-dot.green{background:var(--success)}
        .sb-dot.pulse{animation:dotPulse 2s infinite}
        .sb-dot.red{background:var(--danger)}
        @keyframes dotPulse{0%,100%{opacity:1}50%{opacity:0.4}}
        .sb-lang{display:flex;align-items:center;gap:8px;padding:9px 12px;border-radius:var(--radius-sm);cursor:pointer;font-size:12px;color:var(--text-muted);transition:all .15s}
        .sb-lang:hover{background:var(--bg-raised);color:var(--text-secondary)}

        /* ===== MAIN ===== */
        .main{padding:24px 28px 80px;position:relative;min-height:100vh}
        html[dir="rtl"] .main{margin-right:var(--sidebar-w)}
        html[dir="ltr"] .main{margin-left:var(--sidebar-w)}
        .section{margin-bottom:40px;scroll-margin-top:20px}
        .section-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:12px}
        .section-title{font-size:16px;font-weight:600;display:flex;align-items:center;gap:8px;letter-spacing:-0.01em}
        .section-title svg{width:18px;height:18px;color:var(--text-muted)}

        /* ===== BUTTONS ===== */
        .btn{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;border-radius:var(--radius-sm);font-size:13px;font-weight:500;cursor:pointer;transition:all .2s;font-family:inherit;border:none;text-decoration:none}
        .btn-primary{background:var(--primary);color:white}
        .btn-primary:hover{background:var(--primary-hover);transform:translateY(-1px)}
        .btn-outline{background:transparent;border:1px solid var(--border);color:var(--text-secondary)}
        .btn-outline:hover{background:var(--bg-raised);border-color:var(--border-hover);color:var(--text)}
        .btn-ghost{background:transparent;color:var(--text-secondary);padding:8px}
        .btn-ghost:hover{background:var(--bg-raised);color:var(--text)}
        .btn svg{width:16px;height:16px}

        /* ===== HERO â€” THE MACHINE ===== */
        .hero{background:var(--bg);border-radius:var(--radius-lg);padding:48px 32px;text-align:center;margin-bottom:32px;position:relative;overflow:hidden}
        .hero-glow{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:600px;height:600px;background:radial-gradient(circle,rgba(16,185,129,0.06) 0%,transparent 70%);pointer-events:none;transition:opacity .6s}
        .hero-amount{font-size:56px;font-weight:700;color:var(--text);letter-spacing:-0.04em;line-height:1;margin-bottom:4px;opacity:0;animation:heroReveal .8s ease-out .2s forwards}
        .hero-amount .curr{font-size:22px;font-weight:500;color:var(--text-muted);margin:0 4px}
        .hero-amount .money{color:var(--primary)}
        .hero-subtitle{font-size:15px;color:var(--text-muted);margin-bottom:36px;opacity:0;animation:heroReveal .8s ease-out .4s forwards}
        @keyframes heroReveal{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}

        .hero-cta{margin-bottom:40px;opacity:0;animation:heroReveal .8s ease-out .6s forwards}
        .btn-machine{padding:18px 48px;font-size:18px;font-weight:700;border-radius:14px;gap:12px;background:linear-gradient(135deg,#10B981,#059669);color:white;border:none;cursor:pointer;position:relative;overflow:hidden;transition:all .3s;box-shadow:0 0 0 0 rgba(16,185,129,0.4)}
        .btn-machine:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(16,185,129,0.3)}
        .btn-machine:active{transform:translateY(0);box-shadow:0 2px 10px rgba(16,185,129,0.2)}
        .btn-machine svg{width:22px;height:22px}
        .btn-machine-pulse{animation:machinePulse 3s ease-in-out infinite}
        @keyframes machinePulse{0%,100%{box-shadow:0 0 0 0 rgba(16,185,129,0.4)}50%{box-shadow:0 0 0 12px rgba(16,185,129,0)}}
        .btn-machine .shine{position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.15),transparent);transition:none}
        .btn-machine:hover .shine{left:100%;transition:left .6s}

        .hero-breakdown{display:flex;gap:12px;max-width:600px;margin:0 auto;opacity:0;animation:heroReveal .8s ease-out .8s forwards}
        .hero-pill{flex:1;display:flex;align-items:center;gap:10px;padding:14px 16px;background:var(--card);border:1px solid var(--border);border-radius:var(--radius);transition:all .25s;cursor:default}
        .hero-pill:hover{border-color:var(--border-hover);background:var(--card-hover)}
        .hero-pill-icon{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
        .hero-pill-info{text-align:start;min-width:0}
        .hero-pill-val{font-size:15px;font-weight:700;color:var(--text)}
        .hero-pill-label{font-size:11px;color:var(--text-muted);white-space:nowrap}

        /* ===== STATS â€” PROGRESSIVE ===== */
        .stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:28px}
        .stat{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:18px;transition:all .3s;opacity:0;transform:translateY(12px)}
        .stat.visible{opacity:1;transform:translateY(0)}
        .stat:hover{border-color:var(--border-hover)}
        .stat-label{font-size:12px;font-weight:500;color:var(--text-muted);margin-bottom:8px}
        .stat-val{font-size:24px;font-weight:700;letter-spacing:-0.02em;line-height:1}
        .stat-val .unit{font-size:13px;font-weight:500;color:var(--text-muted)}

        .stats-empty{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:28px;text-align:center;margin-bottom:28px;color:var(--text-muted);font-size:13px}
        .stats-empty svg{width:24px;height:24px;margin-bottom:8px;opacity:0.4}

        /* ===== GRID ===== */
        .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
        .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius-lg);padding:20px}

        /* ===== CHART ===== */
        .chart-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius-lg);padding:24px;overflow:hidden}
        .chart-empty{display:flex;flex-direction:column;align-items:center;justify-content:center;height:160px;color:var(--text-muted)}
        .chart-empty svg{width:32px;height:32px;margin-bottom:10px;opacity:0.3}
        .chart-empty-text{font-size:13px}
        .chart-bars{display:flex;align-items:flex-end;gap:6px;height:120px;padding-top:8px}
        .chart-bars .c-bar{flex:1;border-radius:4px 4px 0 0;position:relative;cursor:pointer;transition:all .4s;min-height:4px}
        .chart-bars .c-bar:hover{opacity:0.8}
        .chart-bars .c-bar .c-tip{position:absolute;top:-26px;left:50%;transform:translateX(-50%);background:var(--text);color:var(--bg);font-size:10px;font-weight:600;padding:2px 6px;border-radius:4px;opacity:0;transition:opacity .2s;white-space:nowrap;pointer-events:none;z-index:10}
        .chart-bars .c-bar:hover .c-tip{opacity:1}
        .chart-labels{display:flex;gap:6px;margin-top:8px}
        .chart-labels span{flex:1;text-align:center;font-size:10px;color:var(--text-muted)}

        /* ===== ACTIVITY ===== */
        .activity-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius-lg);overflow:hidden}
        .activity-header{padding:16px 16px 12px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border)}
        .activity-item{display:flex;align-items:center;gap:12px;padding:12px 16px;transition:all .3s;border-bottom:1px solid var(--border);opacity:0;transform:translateX(20px)}
        html[dir="ltr"] .activity-item{transform:translateX(-20px)}
        .activity-item.slide-in{opacity:1;transform:translateX(0)}
        .activity-item:last-child{border-bottom:none}
        .activity-item:hover{background:var(--card-hover)}
        .activity-item.flash{animation:actFlash .6s ease-out}
        @keyframes actFlash{0%{background:rgba(16,185,129,0.15)}100%{background:transparent}}
        .act-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
        .act-dot.green{background:var(--success)}
        .act-dot.blue{background:#3B82F6}
        .act-dot.orange{background:var(--warning)}
        .act-body{flex:1;min-width:0}
        .act-msg{font-size:13px;font-weight:500}
        .act-time{font-size:11px;color:var(--text-muted)}
        .act-amount{font-size:13px;font-weight:600;color:var(--success);white-space:nowrap}
        .activity-empty{padding:40px 16px;text-align:center;color:var(--text-muted)}
        .activity-empty svg{width:28px;height:28px;margin-bottom:8px;opacity:0.3}

        /* ===== FLOW CARDS ===== */
        .flow-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
        .flow-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:18px;transition:all .35s;position:relative;overflow:hidden;opacity:0;transform:translateY(16px)}
        .flow-card.entered{opacity:1;transform:translateY(0)}
        .flow-card:hover{border-color:var(--border-hover);transform:translateY(-2px)}
        .flow-card.entered:hover{transform:translateY(-2px)}
        .flow-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;opacity:0;transition:opacity .35s}
        .flow-card.active::before{opacity:1}
        .flow-card.active{border-color:rgba(16,185,129,0.3);box-shadow:0 0 20px rgba(16,185,129,0.05)}
        .flow-top{display:flex;align-items:center;gap:12px;margin-bottom:10px}
        .flow-ico{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .35s}
        .flow-ico svg{width:18px;height:18px}
        .flow-card.active .flow-ico{transform:scale(1.05)}
        .flow-info{flex:1;min-width:0}
        .flow-name{font-size:14px;font-weight:600;margin-bottom:2px}
        .flow-desc{font-size:11px;color:var(--text-muted);line-height:1.4}
        .flow-toggle{position:relative;width:44px;height:24px;flex-shrink:0}
        .flow-toggle input{opacity:0;width:0;height:0;position:absolute}
        .flow-toggle .slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:var(--border);border-radius:24px;transition:all .3s}
        .flow-toggle .slider::before{content:'';position:absolute;height:18px;width:18px;border-radius:50%;background:white;bottom:3px;right:3px;transition:all .3s}
        html[dir="ltr"] .flow-toggle .slider::before{left:3px;right:auto}
        .flow-toggle input:checked+.slider{background:var(--primary);box-shadow:0 0 10px rgba(16,185,129,0.3)}
        .flow-toggle input:checked+.slider::before{transform:translateX(-20px)}
        html[dir="ltr"] .flow-toggle input:checked+.slider::before{transform:translateX(20px)}
        .flow-bottom{display:flex;align-items:center;justify-content:space-between;margin-top:12px;padding-top:12px;border-top:1px solid var(--border)}
        .flow-estimate{font-size:11px;color:var(--text-muted);display:flex;align-items:center;gap:4px}
        .flow-estimate svg{width:12px;height:12px;color:var(--primary)}
        .flow-estimate strong{color:var(--primary);font-weight:600}
        .flow-stats-row{display:flex;gap:14px}
        .flow-stat{display:flex;align-items:center;gap:4px;font-size:11px;color:var(--text-muted)}
        .flow-stat svg{width:12px;height:12px}
        .flow-stat strong{color:var(--text-secondary);font-weight:600}

        /* ===== CHAT CAMPAIGN CREATOR ===== */
        .chat-creator{background:var(--card);border:1px solid var(--border);border-radius:var(--radius-lg);overflow:hidden;margin-top:16px}
        .chat-header{padding:16px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:10px}
        .chat-header svg{width:18px;height:18px;color:var(--primary)}
        .chat-header-title{font-size:14px;font-weight:600}
        .chat-body{padding:16px;min-height:60px}
        .chat-bubbles{margin-bottom:16px}
        .chat-bubble{max-width:80%;padding:12px 16px;border-radius:16px;font-size:13px;line-height:1.6;margin-bottom:8px;opacity:0;transform:translateY(8px);animation:bubbleIn .3s ease-out forwards}
        @keyframes bubbleIn{to{opacity:1;transform:translateY(0)}}
        .chat-bubble.user{background:var(--primary);color:white;border-radius:16px 16px 4px 16px;margin-left:auto}
        html[dir="ltr"] .chat-bubble.user{border-radius:16px 16px 16px 4px;margin-right:auto;margin-left:0}
        .chat-bubble.ai{background:var(--bg);border:1px solid var(--border);color:var(--text-secondary);border-radius:16px 16px 16px 4px;white-space:pre-wrap}
        html[dir="ltr"] .chat-bubble.ai{border-radius:16px 16px 4px 16px}
        .typing-dots{display:flex;gap:4px;padding:12px 16px;max-width:70px}
        .typing-dots span{width:6px;height:6px;border-radius:50%;background:var(--text-muted);animation:typeBounce 1.4s infinite}
        .typing-dots span:nth-child(2){animation-delay:.2s}
        .typing-dots span:nth-child(3){animation-delay:.4s}
        @keyframes typeBounce{0%,60%,100%{transform:translateY(0);opacity:0.4}30%{transform:translateY(-6px);opacity:1}}
        .chat-input-wrap{display:flex;gap:8px}
        .chat-input{flex:1;padding:12px 16px;background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);color:var(--text);font-size:13px;font-family:inherit;transition:all .2s}
        .chat-input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(16,185,129,0.1)}
        .chat-input::placeholder{color:var(--text-muted)}
        .chat-send{background:var(--primary);color:white;border:none;border-radius:var(--radius-sm);padding:12px 16px;cursor:pointer;transition:all .2s;display:flex;align-items:center}
        .chat-send:hover{background:var(--primary-hover);transform:scale(1.05)}
        .chat-send:active{transform:scale(0.95)}
        .chat-send svg{width:16px;height:16px}
        .chat-actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px;opacity:0;animation:bubbleIn .3s ease-out forwards}

        /* ===== SETTINGS ===== */
        .settings-grid{display:flex;flex-direction:column;gap:16px}
        .settings-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius-lg);padding:20px;transition:all .3s}
        .settings-card:hover{border-color:var(--border-hover)}
        .settings-card-head{display:flex;align-items:center;gap:12px;margin-bottom:16px}
        .settings-card-ico{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
        .settings-card-ico svg{width:18px;height:18px}
        .settings-card-title{font-size:14px;font-weight:600}
        .settings-card-desc{font-size:12px;color:var(--text-muted);margin-top:2px}
        .connect-status{display:flex;align-items:center;gap:8px;padding:10px 14px;border-radius:var(--radius-sm);font-size:13px;font-weight:500}
        .connect-status.connected{background:rgba(34,197,94,0.08);color:var(--success);border:1px solid rgba(34,197,94,0.15)}
        .connect-status.disconnected{background:rgba(239,68,68,0.08);color:var(--danger);border:1px solid rgba(239,68,68,0.15)}
        .connect-status svg{width:16px;height:16px}
        .connect-checkmark{display:inline-flex;width:16px;height:16px;border-radius:50%;background:var(--success);align-items:center;justify-content:center;animation:checkPop .4s ease-out}
        .connect-checkmark svg{width:10px;height:10px;color:white}
        @keyframes checkPop{0%{transform:scale(0)}60%{transform:scale(1.2)}100%{transform:scale(1)}}
        .wa-info-toggle{display:flex;align-items:center;gap:6px;padding:8px 0;cursor:pointer;font-size:12px;color:var(--text-muted);margin-top:12px;transition:color .15s;background:none;border:none;font-family:inherit}
        .wa-info-toggle:hover{color:var(--text-secondary)}
        .wa-info-toggle svg{width:14px;height:14px;transition:transform .2s}
        .wa-info-toggle.open svg{transform:rotate(90deg)}
        html[dir="ltr"] .wa-info-toggle.open svg{transform:rotate(90deg)}
        .wa-info{max-height:0;overflow:hidden;transition:max-height .3s ease-out,opacity .3s;opacity:0}
        .wa-info.open{max-height:200px;opacity:1}
        .wa-info-inner{padding:12px;background:var(--bg);border-radius:var(--radius-sm);font-size:12px;color:var(--text-muted);line-height:1.8}
        .import-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:12px}
        .import-btn{display:flex;flex-direction:column;align-items:center;gap:8px;padding:16px 12px;background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);cursor:pointer;transition:all .25s;text-decoration:none;color:var(--text-secondary)}
        .import-btn:hover{border-color:var(--primary);background:var(--primary-muted);color:var(--text);transform:translateY(-2px)}
        .import-btn-logo{font-size:24px;height:32px;display:flex;align-items:center;justify-content:center;font-weight:700}
        .import-btn-name{font-size:11px;font-weight:500}
        .upload-mini{border:2px dashed var(--border);border-radius:var(--radius);padding:20px;text-align:center;cursor:pointer;transition:all .25s;margin-top:10px}
        .upload-mini:hover{border-color:var(--primary);background:var(--primary-muted)}
        .upload-mini svg{width:24px;height:24px;color:var(--text-muted);margin-bottom:6px}

        /* ===== BADGE ===== */
        .badge{display:inline-flex;align-items:center;gap:4px;padding:2px 8px;border-radius:20px;font-size:11px;font-weight:600}
        .badge-success{background:rgba(34,197,94,0.1);color:var(--success);border:1px solid rgba(34,197,94,0.2)}
        .badge-success::before{content:'';width:5px;height:5px;border-radius:50%;background:var(--success);animation:dotPulse 1.5s infinite}

        /* ===== TOAST ===== */
        .toast-container{position:fixed;top:20px;left:50%;transform:translateX(-50%);z-index:9999;display:flex;flex-direction:column;gap:8px;pointer-events:none}
        .toast{padding:12px 20px;background:var(--card);border:1px solid var(--border);border-radius:var(--radius);font-size:13px;font-weight:500;display:flex;align-items:center;gap:8px;opacity:0;transform:translateY(-12px);animation:toastIn .3s ease-out forwards;box-shadow:0 8px 30px rgba(0,0,0,0.3);pointer-events:auto}
        .toast.success{border-color:rgba(34,197,94,0.3);background:rgba(16,185,129,0.1)}
        .toast svg{width:16px;height:16px;color:var(--primary);flex-shrink:0}
        @keyframes toastIn{to{opacity:1;transform:translateY(0)}}
        @keyframes toastOut{to{opacity:0;transform:translateY(-12px)}}

        /* ===== CONFETTI CANVAS ===== */
        #confetti{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:9998}

        /* ===== MOBILE NAV ===== */
        .mob-nav{display:none;position:fixed;bottom:0;left:0;right:0;background:var(--bg);border-top:1px solid var(--border);z-index:200;padding:6px 0 env(safe-area-inset-bottom,8px)}
        .mob-nav-inner{display:flex;justify-content:space-around}
        .mn{display:flex;flex-direction:column;align-items:center;gap:2px;padding:6px 12px;color:var(--text-muted);cursor:pointer;transition:color .15s;text-decoration:none;font-size:10px;font-weight:500}
        .mn.active{color:var(--primary)}
        .mn svg{width:20px;height:20px}
        .mn.active svg{color:var(--primary)}

        /* ===== SCROLLBAR ===== */
        ::-webkit-scrollbar{width:5px}
        ::-webkit-scrollbar-track{background:transparent}
        ::-webkit-scrollbar-thumb{background:var(--border);border-radius:5px}

        /* ===== RESPONSIVE ===== */
        @media(max-width:1024px){
            .stats-row{grid-template-columns:repeat(2,1fr)}
            .flow-grid{grid-template-columns:1fr}
            .grid-2{grid-template-columns:1fr}
            .hero-breakdown{flex-direction:column}
        }
        @media(max-width:768px){
            .sidebar{display:none}
            .main{margin-right:0!important;margin-left:0!important;padding:16px 16px 80px;overflow-x:hidden}
            .stats-row{grid-template-columns:repeat(2,1fr);gap:8px}
            .stat{padding:14px}
            .stat-val{font-size:20px}
            .hero{padding:36px 20px}
            .hero-amount{font-size:40px}
            .btn-machine{padding:16px 36px;font-size:16px}
            .hero-breakdown{flex-direction:column;gap:8px}
            .hero-pill{padding:12px}
            .flow-grid{grid-template-columns:1fr}
            .grid-2{grid-template-columns:1fr}
            .mob-nav{display:block}
            .import-grid{grid-template-columns:repeat(2,1fr)}
        }
    </style>
</head>
<body>
    <!-- Confetti Canvas -->
    <canvas id="confetti"></canvas>

    <!-- Toast Container -->
    <div class="toast-container" id="toasts"></div>

    <!-- ===== SIDEBAR ===== -->
    <aside class="sidebar">
        <div class="sb-logo">
            <div class="sb-logo-mark"><i data-lucide="zap" style="width:18px;height:18px;color:white"></i></div>
            <span class="sb-logo-text" data-ar="Ø±ÙØ¨Ø­" data-en="RIBH">Ø±ÙØ¨Ø­</span>
        </div>
        <div class="sb-section">
            <a class="sb-item active" data-section="dashboard" onclick="nav('dashboard')"><i data-lucide="layout-dashboard"></i><span data-ar="Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…" data-en="Dashboard">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span></a>
            <a class="sb-item" data-section="flows" onclick="nav('flows')"><i data-lucide="workflow"></i><span data-ar="Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª" data-en="Flows">Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª</span></a>
            <a class="sb-item" data-section="settings" onclick="nav('settings')"><i data-lucide="settings"></i><span data-ar="Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª" data-en="Settings">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span></a>
        </div>
        <div class="sb-spacer"></div>
        <div class="sb-status" id="sbWhatsapp"><span class="sb-dot green pulse"></span><span data-ar="ÙˆØ§ØªØ³Ø§Ø¨ Ù…ØªØµÙ„" data-en="WhatsApp connected">ÙˆØ§ØªØ³Ø§Ø¨ Ù…ØªØµÙ„</span></div>
        <div class="sb-status" id="sbStore"><span class="sb-dot green pulse"></span><span data-ar="Ø³Ù„Ø© Ù…ØªØµÙ„Ø©" data-en="Salla connected">Ø³Ù„Ø© Ù…ØªØµÙ„Ø©</span></div>
        <div class="sb-lang" onclick="toggleLang()"><i data-lucide="globe" style="width:14px;height:14px"></i><span id="langLabel">English</span></div>
    </aside>

    <!-- ===== MAIN CONTENT ===== -->
    <main class="main">

        <!-- ===== DASHBOARD ===== -->
        <div id="dashboard">

            <!-- HERO: The Machine -->
            <div class="hero">
                <div class="hero-glow"></div>
                <div class="hero-amount">
                    <span class="money" id="heroTotal">0</span>
                    <span class="curr" data-ar="Ø±.Ø³" data-en="SAR">Ø±.Ø³</span>
                </div>
                <div class="hero-subtitle" data-ar="ØªÙ†ØªØ¸Ø±Ùƒ ÙÙŠ Ù…ØªØ¬Ø±Ùƒ Ø§Ù„Ø¢Ù†" data-en="waiting in your store right now">ØªÙ†ØªØ¸Ø±Ùƒ ÙÙŠ Ù…ØªØ¬Ø±Ùƒ Ø§Ù„Ø¢Ù†</div>

                <div class="hero-cta">
                    <button class="btn-machine btn-machine-pulse" id="heroBtn" onclick="activateAll()">
                        <div class="shine"></div>
                        <i data-lucide="zap"></i>
                        <span data-ar="Ø§Ø³ØªØ±Ø¬Ø¹ Ø£Ù…ÙˆØ§Ù„Ùƒ" data-en="Recover your money">Ø§Ø³ØªØ±Ø¬Ø¹ Ø£Ù…ÙˆØ§Ù„Ùƒ</span>
                    </button>
                </div>

                <div class="hero-breakdown">
                    <div class="hero-pill">
                        <div class="hero-pill-icon" style="background:rgba(239,68,68,0.12)">ğŸ›’</div>
                        <div class="hero-pill-info">
                            <div class="hero-pill-val"><span id="heroCarts">0</span> <span data-ar="Ø³Ù„Ø©" data-en="carts">Ø³Ù„Ø©</span></div>
                            <div class="hero-pill-label" data-ar="Ù…ØªØ±ÙˆÙƒØ©" data-en="abandoned">Ù…ØªØ±ÙˆÙƒØ©</div>
                        </div>
                    </div>
                    <div class="hero-pill">
                        <div class="hero-pill-icon" style="background:rgba(245,158,11,0.12)">ğŸ˜´</div>
                        <div class="hero-pill-info">
                            <div class="hero-pill-val"><span id="heroDormant">0</span> <span data-ar="Ø¹Ù…ÙŠÙ„" data-en="customers">Ø¹Ù…ÙŠÙ„</span></div>
                            <div class="hero-pill-label" data-ar="Ø®Ø§Ù…Ù„" data-en="dormant">Ø®Ø§Ù…Ù„</div>
                        </div>
                    </div>
                    <div class="hero-pill">
                        <div class="hero-pill-icon" style="background:rgba(99,102,241,0.12)">ğŸ›ï¸</div>
                        <div class="hero-pill-info">
                            <div class="hero-pill-val"><span id="heroUpsell">0</span> <span data-ar="ÙØ±ØµØ©" data-en="opportunities">ÙØ±ØµØ©</span></div>
                            <div class="hero-pill-label" data-ar="Ø¨ÙŠØ¹ Ø¥Ø¶Ø§ÙÙŠ" data-en="upsell">Ø¨ÙŠØ¹ Ø¥Ø¶Ø§ÙÙŠ</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats â€” Hidden until flows active -->
            <div id="statsEmpty" class="stats-empty">
                <i data-lucide="bar-chart-3"></i>
                <div data-ar="ÙØ¹Ù‘Ù„ Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª ÙˆØ³ØªØ¸Ù‡Ø± Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª" data-en="Activate flows to see your stats">ÙØ¹Ù‘Ù„ Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª ÙˆØ³ØªØ¸Ù‡Ø± Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</div>
            </div>
            <div class="stats-row" id="statsRow" style="display:none">
                <div class="stat" id="stat0">
                    <div class="stat-label" data-ar="ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹Ù‡" data-en="Recovered">ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹Ù‡</div>
                    <div class="stat-val"><span id="totalRevenue">0</span> <span class="unit" data-ar="Ø±.Ø³" data-en="SAR">Ø±.Ø³</span></div>
                </div>
                <div class="stat" id="stat1">
                    <div class="stat-label" data-ar="Ø±Ø³Ø§Ø¦Ù„ Ù…Ø±Ø³Ù„Ø©" data-en="Messages Sent">Ø±Ø³Ø§Ø¦Ù„ Ù…Ø±Ø³Ù„Ø©</div>
                    <div class="stat-val" id="messagesSent">0</div>
                </div>
                <div class="stat" id="stat2">
                    <div class="stat-label" data-ar="Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹" data-en="Recovery Rate">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹</div>
                    <div class="stat-val" id="recoveryRate">0<span class="unit">%</span></div>
                </div>
                <div class="stat" id="stat3">
                    <div class="stat-label" data-ar="ØªØ¯ÙÙ‚Ø§Øª Ù†Ø´Ø·Ø©" data-en="Active Flows">ØªØ¯ÙÙ‚Ø§Øª Ù†Ø´Ø·Ø©</div>
                    <div class="stat-val" id="activeFlowCount">0</div>
                </div>
            </div>

            <!-- Chart + Activity -->
            <div class="grid-2" style="margin-bottom:24px">
                <div class="chart-card" id="chartCard">
                    <div style="margin-bottom:16px">
                        <div style="font-size:14px;font-weight:600;color:var(--text-secondary)" data-ar="Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³ØªØ±Ø¬Ø¹Ø©" data-en="Recovered Revenue">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³ØªØ±Ø¬Ø¹Ø©</div>
                    </div>
                    <div class="chart-empty" id="chartEmpty">
                        <i data-lucide="trending-up"></i>
                        <div class="chart-empty-text" data-ar="Ø³ØªØ¸Ù‡Ø± Ø¥ÙŠØ±Ø§Ø¯Ø§ØªÙƒ Ù‡Ù†Ø§" data-en="Your revenue will appear here">Ø³ØªØ¸Ù‡Ø± Ø¥ÙŠØ±Ø§Ø¯Ø§ØªÙƒ Ù‡Ù†Ø§</div>
                    </div>
                    <div class="chart-bars" id="revenueChart" style="display:none"></div>
                    <div class="chart-labels" id="revenueLabels" style="display:none"></div>
                </div>
                <div class="activity-card">
                    <div class="activity-header">
                        <span style="font-size:14px;font-weight:600" data-ar="Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª" data-en="Activity">Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª</span>
                        <span class="badge badge-success" style="font-size:10px" data-ar="Ù…Ø¨Ø§Ø´Ø±" data-en="Live">Ù…Ø¨Ø§Ø´Ø±</span>
                    </div>
                    <div id="activityList">
                        <div class="activity-empty" id="activityEmpty">
                            <i data-lucide="activity"></i>
                            <div style="font-size:13px;color:var(--text-secondary);margin-bottom:2px" data-ar="Ø¬Ø§Ù‡Ø²" data-en="Ready">Ø¬Ø§Ù‡Ø²</div>
                            <div style="font-size:12px" data-ar="ÙØ¹Ù‘Ù„ Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª ÙˆØ³ØªØ¸Ù‡Ø± Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª" data-en="Activate flows to see activity">ÙØ¹Ù‘Ù„ Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª ÙˆØ³ØªØ¸Ù‡Ø± Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== FLOWS ===== -->
        <div class="section" id="flows">
            <div class="section-head">
                <div class="section-title"><i data-lucide="workflow"></i><span data-ar="Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª" data-en="Flows">Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª</span></div>
                <div class="badge badge-success" id="flowsBadge" style="font-size:10px"><span data-ar="0 Ù†Ø´Ø·" data-en="0 active" id="flowsBadgeText">0 Ù†Ø´Ø·</span></div>
            </div>

            <div class="flow-grid" id="flowGrid"></div>

            <!-- Chat Campaign Creator -->
            <div class="chat-creator">
                <div class="chat-header">
                    <i data-lucide="sparkles"></i>
                    <div class="chat-header-title" data-ar="Ø­Ù…Ù„Ø© Ù…Ø®ØµØµØ©" data-en="Custom Campaign">Ø­Ù…Ù„Ø© Ù…Ø®ØµØµØ©</div>
                </div>
                <div class="chat-body">
                    <div class="chat-bubbles" id="chatBubbles"></div>
                    <div class="chat-input-wrap">
                        <input type="text" class="chat-input" id="chatInput" data-placeholder-ar="Ø§ÙƒØªØ¨ Ù‡Ø¯ÙÙƒ... Ù…Ø«Ø§Ù„: Ø¹Ø±Ø¶ Ø±Ù…Ø¶Ø§Ù†" data-placeholder-en="Type your goal... e.g. Ramadan offer" placeholder="Ø§ÙƒØªØ¨ Ù‡Ø¯ÙÙƒ... Ù…Ø«Ø§Ù„: Ø¹Ø±Ø¶ Ø±Ù…Ø¶Ø§Ù†">
                        <button class="chat-send" onclick="generateCampaign()"><i data-lucide="send"></i></button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== SETTINGS ===== -->
        <div class="section" id="settings">
            <div class="section-head">
                <div class="section-title"><i data-lucide="settings"></i><span data-ar="Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª" data-en="Settings">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span></div>
            </div>

            <div class="settings-grid">
                <!-- WhatsApp Connection -->
                <div class="settings-card">
                    <div class="settings-card-head">
                        <div class="settings-card-ico" style="background:rgba(34,197,94,0.12);color:var(--success)"><i data-lucide="message-circle"></i></div>
                        <div>
                            <div class="settings-card-title" data-ar="ÙˆØ§ØªØ³Ø§Ø¨" data-en="WhatsApp">ÙˆØ§ØªØ³Ø§Ø¨</div>
                            <div class="settings-card-desc" data-ar="Ø±Ø¨Ø· Ø±Ù‚Ù…Ùƒ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„" data-en="Connect your number to send messages">Ø±Ø¨Ø· Ø±Ù‚Ù…Ùƒ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</div>
                        </div>
                    </div>
                    <div class="connect-status connected" id="waStatus">
                        <span class="connect-checkmark"><i data-lucide="check"></i></span>
                        <span data-ar="Ù…ØªØµÙ„" data-en="Connected">Ù…ØªØµÙ„</span>
                    </div>
                    <div style="display:flex;gap:8px;margin-top:12px">
                        <button class="btn btn-outline" onclick="window.location.href='/whatsapp.html'" data-ar="Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø¨Ø·" data-en="Reconnect">Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø¨Ø·</button>
                        <button class="btn btn-outline" data-ar="API Ø±Ø³Ù…ÙŠ" data-en="Official API">API Ø±Ø³Ù…ÙŠ</button>
                    </div>
                    <button class="wa-info-toggle" id="waInfoToggle" onclick="toggleWaInfo()">
                        <i data-lucide="chevron-left"></i>
                        <span data-ar="ÙƒÙŠÙ Ù†Ø­Ù…ÙŠ Ø±Ù‚Ù…ÙƒØŸ" data-en="How do we protect your number?">ÙƒÙŠÙ Ù†Ø­Ù…ÙŠ Ø±Ù‚Ù…ÙƒØŸ</span>
                    </button>
                    <div class="wa-info" id="waInfo">
                        <div class="wa-info-inner">
                            <span data-ar="Ø¥Ø±Ø³Ø§Ù„ ØªØ¯Ø±ÙŠØ¬ÙŠØŒ ÙØªØ±Ø§Øª Ø±Ø§Ø­Ø©ØŒ ØªØ³Ø®ÙŠÙ† ØªÙ„Ù‚Ø§Ø¦ÙŠ" data-en="Gradual sending, pauses, auto warm-up">Ø¥Ø±Ø³Ø§Ù„ ØªØ¯Ø±ÙŠØ¬ÙŠØŒ ÙØªØ±Ø§Øª Ø±Ø§Ø­Ø©ØŒ ØªØ³Ø®ÙŠÙ† ØªÙ„Ù‚Ø§Ø¦ÙŠ</span><br>
                            <span style="color:var(--text-secondary);margin-top:4px;display:inline-block" data-ar="Ù„Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø©: ÙØ¹Ù‘Ù„ API Ø§Ù„Ø±Ø³Ù…ÙŠ â†‘" data-en="For full protection: enable Official API â†‘">Ù„Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø©: ÙØ¹Ù‘Ù„ API Ø§Ù„Ø±Ø³Ù…ÙŠ â†‘</span>
                        </div>
                    </div>
                </div>

                <!-- Store Connection -->
                <div class="settings-card">
                    <div class="settings-card-head">
                        <div class="settings-card-ico" style="background:rgba(59,130,246,0.12);color:#3B82F6"><i data-lucide="store"></i></div>
                        <div>
                            <div class="settings-card-title" data-ar="Ø§Ù„Ù…ØªØ¬Ø±" data-en="Store">Ø§Ù„Ù…ØªØ¬Ø±</div>
                            <div class="settings-card-desc" data-ar="Ø§Ø±Ø¨Ø· Ù…ØªØ¬Ø±Ùƒ Ù„Ø³Ø­Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª" data-en="Connect your store to pull data">Ø§Ø±Ø¨Ø· Ù…ØªØ¬Ø±Ùƒ Ù„Ø³Ø­Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
                        </div>
                    </div>
                    <div class="connect-status connected" id="storeStatus">
                        <span class="connect-checkmark"><i data-lucide="check"></i></span>
                        <span data-ar="Ø³Ù„Ø© Ù…ØªØµÙ„Ø©" data-en="Salla connected">Ø³Ù„Ø© Ù…ØªØµÙ„Ø©</span>
                    </div>
                </div>

                <!-- Customer Import -->
                <div class="settings-card">
                    <div class="settings-card-head">
                        <div class="settings-card-ico" style="background:rgba(245,158,11,0.12);color:var(--warning)"><i data-lucide="users"></i></div>
                        <div>
                            <div class="settings-card-title" data-ar="Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡" data-en="Import Customers">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
                            <div class="settings-card-desc" data-ar="Ù…Ù† Ø£ÙŠ Ù…ØµØ¯Ø±" data-en="From any source">Ù…Ù† Ø£ÙŠ Ù…ØµØ¯Ø±</div>
                        </div>
                    </div>
                    <div class="import-grid">
                        <div class="import-btn" onclick="connectImport('salla')">
                            <div class="import-btn-logo" style="color:#6C63FF">Ø³Ù„Ø©</div>
                            <div class="import-btn-name">Salla</div>
                        </div>
                        <div class="import-btn" onclick="connectImport('foodics')">
                            <div class="import-btn-logo" style="color:#FF6B35">F</div>
                            <div class="import-btn-name">Foodics</div>
                        </div>
                        <div class="import-btn" onclick="connectImport('zid')">
                            <div class="import-btn-logo" style="color:#5B5FC7">Ø²Ø¯</div>
                            <div class="import-btn-name">Zid</div>
                        </div>
                        <div class="import-btn" onclick="connectImport('marn')">
                            <div class="import-btn-logo" style="color:#00C9A7">Ù…Ø±Ù†</div>
                            <div class="import-btn-name">Marn</div>
                        </div>
                        <div class="import-btn" onclick="connectImport('shopify')">
                            <div class="import-btn-logo" style="color:#96BF48">S</div>
                            <div class="import-btn-name">Shopify</div>
                        </div>
                        <div class="import-btn" onclick="connectImport('loyverse')">
                            <div class="import-btn-logo" style="color:#8E44AD">L</div>
                            <div class="import-btn-name">Loyverse</div>
                        </div>
                    </div>
                    <div class="upload-mini" onclick="document.getElementById('fileInput').click()">
                        <i data-lucide="upload-cloud"></i>
                        <div style="font-size:12px;color:var(--text-secondary)" data-ar="Ø£Ùˆ Ø§Ø±ÙØ¹ Ù…Ù„Ù CSV / Excel" data-en="Or upload CSV / Excel file">Ø£Ùˆ Ø§Ø±ÙØ¹ Ù…Ù„Ù CSV / Excel</div>
                    </div>
                    <input type="file" id="fileInput" accept=".csv,.xlsx,.xls,.json" onchange="handleFile(event)" style="display:none">
                </div>
            </div>
        </div>
    </main>

    <!-- ===== MOBILE NAV ===== -->
    <nav class="mob-nav"><div class="mob-nav-inner">
        <a class="mn active" data-section="dashboard" onclick="nav('dashboard')"><i data-lucide="layout-dashboard"></i><span data-ar="Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©" data-en="Home">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></a>
        <a class="mn" data-section="flows" onclick="nav('flows')"><i data-lucide="workflow"></i><span data-ar="Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª" data-en="Flows">Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª</span></a>
        <a class="mn" data-section="settings" onclick="nav('settings')"><i data-lucide="settings"></i><span data-ar="Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª" data-en="Settings">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span></a>
    </div></nav>

    <script>
    // ===== STATE =====
    const merchantId='demo';
    let lang=localStorage.getItem('ribhLang')||'ar';
    let flowsActivated=false;
    let hasRealData=false;

    const FLOWS=[
        {id:'cart_recovery',icon:'shopping-cart',name:'Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø³Ù„Ø§Øª',nameEn:'Cart Recovery',desc:'Ø±Ø³Ø§Ù„Ø© Ù„Ù…Ù† ØªØ±Ùƒ Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚',descEn:'Message when a cart is abandoned',color:'#EF4444',gradient:'linear-gradient(135deg,#EF4444,#DC2626)',estimate:12000,active:false,sent:0,revenue:0},
        {id:'winback',icon:'user-check',name:'Ø¥Ø¹Ø§Ø¯Ø© ØªÙ†Ø´ÙŠØ·',nameEn:'Win Back',desc:'Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ø®Ø§Ù…Ù„ÙŠÙ†',descEn:'Message inactive customers',color:'#F59E0B',gradient:'linear-gradient(135deg,#F59E0B,#D97706)',estimate:8900,active:false,sent:0,revenue:0},
        {id:'post_purchase',icon:'package',name:'Ø¨ÙŠØ¹ Ø¥Ø¶Ø§ÙÙŠ',nameEn:'Post-Purchase Upsell',desc:'Ø¹Ø±Ø¶ Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯ ÙƒÙ„ Ø´Ø±Ø§Ø¡',descEn:'Suggest products after purchase',color:'#6366F1',gradient:'linear-gradient(135deg,#6366F1,#4F46E5)',estimate:6500,active:false,sent:0,revenue:0},
        {id:'review',icon:'star',name:'Ø¬Ù…Ø¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª',nameEn:'Review Collection',desc:'Ø·Ù„Ø¨ ØªÙ‚ÙŠÙŠÙ… Ø¨Ø¹Ø¯ Ø§Ù„ØªÙˆØµÙŠÙ„',descEn:'Ask for review after delivery',color:'#10B981',gradient:'linear-gradient(135deg,#10B981,#059669)',estimate:3200,active:false,sent:0,revenue:0},
        {id:'browse',icon:'eye',name:'ØªØµÙØ­ Ø¨Ø¯ÙˆÙ† Ø´Ø±Ø§Ø¡',nameEn:'Browse Abandonment',desc:'Ø±Ø³Ø§Ù„Ø© Ù„Ù…Ù† ØªØµÙØ­ Ø¨Ø¯ÙˆÙ† Ø´Ø±Ø§Ø¡',descEn:'Message browsers who didn\'t buy',color:'#3B82F6',gradient:'linear-gradient(135deg,#3B82F6,#2563EB)',estimate:5400,active:false,sent:0,revenue:0},
        {id:'cod',icon:'package-check',name:'ØªØ£ÙƒÙŠØ¯ COD',nameEn:'COD Confirmation',desc:'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª',descEn:'Confirm order to reduce returns',color:'#8B5CF6',gradient:'linear-gradient(135deg,#8B5CF6,#7C3AED)',estimate:4100,active:false,sent:0,revenue:0}
    ];

    // ===== NAVIGATION =====
    function nav(s){
        const el=document.getElementById(s);
        if(el) el.scrollIntoView({behavior:'smooth',block:'start'});
        document.querySelectorAll('.sb-item,.mn').forEach(i=>i.classList.remove('active'));
        document.querySelectorAll(`[data-section="${s}"]`).forEach(i=>i.classList.add('active'));
    }

    const obs=new IntersectionObserver(es=>{
        es.forEach(e=>{
            if(e.isIntersecting){
                document.querySelectorAll('.sb-item,.mn').forEach(i=>i.classList.remove('active'));
                document.querySelectorAll(`[data-section="${e.target.id}"]`).forEach(i=>i.classList.add('active'));
            }
        });
    },{threshold:0.2,rootMargin:'-80px 0px -50% 0px'});

    // ===== LANGUAGE =====
    function toggleLang(){
        lang=lang==='ar'?'en':'ar';
        localStorage.setItem('ribhLang',lang);
        applyLang();
    }
    function applyLang(){
        const r=document.documentElement;
        r.setAttribute('dir',lang==='ar'?'rtl':'ltr');
        r.setAttribute('lang',lang);
        document.getElementById('langLabel').textContent=lang==='ar'?'English':'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©';
        document.querySelectorAll('[data-ar]').forEach(el=>{
            el.textContent=el.getAttribute('data-'+lang)||el.textContent;
        });
        document.querySelectorAll('[data-placeholder-ar]').forEach(el=>{
            el.placeholder=el.getAttribute('data-placeholder-'+lang)||el.placeholder;
        });
        renderFlows();
        updateFlowBadge();
    }

    // ===== COUNTER ANIMATION =====
    function animateValue(el,end,duration=1200){
        const start=0;
        const startTime=performance.now();
        function update(now){
            const elapsed=now-startTime;
            const progress=Math.min(elapsed/duration,1);
            const eased=1-Math.pow(1-progress,3);
            el.textContent=Math.floor(start+(end-start)*eased).toLocaleString();
            if(progress<1) requestAnimationFrame(update);
        }
        requestAnimationFrame(update);
    }

    // ===== TOAST NOTIFICATIONS =====
    function showToast(msg,type='success'){
        const c=document.getElementById('toasts');
        const t=document.createElement('div');
        t.className='toast '+type;
        t.innerHTML=`<i data-lucide="check-circle-2"></i><span>${msg}</span>`;
        c.appendChild(t);
        lucide.createIcons({nodes:[t]});
        setTimeout(()=>{
            t.style.animation='toastOut .3s ease-out forwards';
            setTimeout(()=>t.remove(),300);
        },3000);
    }

    // ===== CONFETTI =====
    function launchConfetti(){
        const canvas=document.getElementById('confetti');
        const ctx=canvas.getContext('2d');
        canvas.width=window.innerWidth;
        canvas.height=window.innerHeight;
        const particles=[];
        const colors=['#10B981','#22C55E','#6366F1','#F59E0B','#3B82F6','#EF4444','#FAFAFA'];
        for(let i=0;i<120;i++){
            particles.push({
                x:canvas.width/2+(Math.random()-0.5)*200,
                y:canvas.height/2,
                vx:(Math.random()-0.5)*12,
                vy:Math.random()*-16-4,
                w:Math.random()*8+4,
                h:Math.random()*6+2,
                color:colors[Math.floor(Math.random()*colors.length)],
                rotation:Math.random()*360,
                rv:(Math.random()-0.5)*12,
                gravity:0.3,
                opacity:1
            });
        }
        let frame=0;
        function draw(){
            ctx.clearRect(0,0,canvas.width,canvas.height);
            let alive=false;
            particles.forEach(p=>{
                p.x+=p.vx;
                p.vy+=p.gravity;
                p.y+=p.vy;
                p.rotation+=p.rv;
                if(frame>40) p.opacity-=0.015;
                if(p.opacity<=0) return;
                alive=true;
                ctx.save();
                ctx.translate(p.x,p.y);
                ctx.rotate(p.rotation*Math.PI/180);
                ctx.globalAlpha=p.opacity;
                ctx.fillStyle=p.color;
                ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h);
                ctx.restore();
            });
            frame++;
            if(alive) requestAnimationFrame(draw);
            else ctx.clearRect(0,0,canvas.width,canvas.height);
        }
        requestAnimationFrame(draw);
    }

    // ===== PROGRESSIVE STATS =====
    function showStats(){
        if(flowsActivated) return;
        flowsActivated=true;
        document.getElementById('statsEmpty').style.display='none';
        document.getElementById('statsRow').style.display='grid';
        // Staggered reveal
        for(let i=0;i<4;i++){
            setTimeout(()=>{
                const s=document.getElementById('stat'+i);
                if(s) s.classList.add('visible');
            },i*100);
        }
    }

    function showChart(){
        if(hasRealData) return;
        hasRealData=true;
        document.getElementById('chartEmpty').style.display='none';
        document.getElementById('revenueChart').style.display='flex';
        document.getElementById('revenueLabels').style.display='flex';
    }

    // ===== CHART =====
    function renderChart(data,labels){
        const c=document.getElementById('revenueChart'),l=document.getElementById('revenueLabels');
        const mx=Math.max(...data);
        c.innerHTML=data.map((v,i)=>{
            const h=Math.max(4,(v/mx)*100);
            return`<div class="c-bar" style="height:0%;background:${i===data.length-1?'var(--primary)':'var(--border-hover)'}" data-h="${h}"><div class="c-tip">${v.toLocaleString()}</div></div>`;
        }).join('');
        l.innerHTML=labels.map(x=>`<span>${x}</span>`).join('');
        setTimeout(()=>{
            c.querySelectorAll('.c-bar').forEach((bar,i)=>{
                setTimeout(()=>{bar.style.height=bar.dataset.h+'%';},i*60);
            });
        },200);
    }

    // ===== FLOWS =====
    function renderFlows(){
        const g=document.getElementById('flowGrid');
        g.innerHTML=FLOWS.map((f,idx)=>{
            const name=lang==='ar'?f.name:f.nameEn;
            const desc=lang==='ar'?f.desc:f.descEn;
            const sentLabel=lang==='ar'?'Ø±Ø³Ø§Ù„Ø©':'sent';
            const revLabel=lang==='ar'?'Ø±.Ø³':'SAR';
            const estLabel=lang==='ar'?'Ø±.Ø³/Ø´Ù‡Ø± ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹':'SAR/mo est.';
            return`<div class="flow-card ${f.active?'active':''}" id="flow_${f.id}" style="transition-delay:${idx*0.06}s">
                <div style="position:absolute;top:0;left:0;right:0;height:3px;background:${f.gradient};border-radius:3px 3px 0 0"></div>
                <div class="flow-top">
                    <div class="flow-ico" style="background:${f.color}18;color:${f.color}"><i data-lucide="${f.icon}"></i></div>
                    <div class="flow-info">
                        <div class="flow-name">${name}</div>
                        <div class="flow-desc">${desc}</div>
                    </div>
                    <label class="flow-toggle">
                        <input type="checkbox" ${f.active?'checked':''} onchange="toggleFlow('${f.id}',this.checked)">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="flow-bottom">
                    <div class="flow-estimate"><i data-lucide="trending-up"></i> ~<strong>${f.estimate.toLocaleString()}</strong> ${estLabel}</div>
                    <div class="flow-stats-row">
                        <div class="flow-stat"><i data-lucide="send"></i> <strong>${f.sent.toLocaleString()}</strong> ${sentLabel}</div>
                        <div class="flow-stat"><i data-lucide="banknote"></i> <strong>${f.revenue.toLocaleString()}</strong> ${revLabel}</div>
                    </div>
                </div>
            </div>`;
        }).join('');
        lucide.createIcons();
        // Stagger entrance
        setTimeout(()=>{
            g.querySelectorAll('.flow-card').forEach((c,i)=>{
                setTimeout(()=>c.classList.add('entered'),i*80);
            });
        },100);
    }

    function toggleFlow(id,on){
        const f=FLOWS.find(x=>x.id===id);
        if(!f) return;
        f.active=on;
        const card=document.getElementById('flow_'+id);
        if(on){
            card.classList.add('active');
            showStats();
            simulateFlow(f);
            const name=lang==='ar'?f.name:f.nameEn;
            showToast(lang==='ar'?`${name} Ù…ÙØ¹Ù‘Ù„`:`${name} activated`);
        }else{
            card.classList.remove('active');
        }
        updateFlowBadge();
    }

    function updateFlowBadge(){
        const count=FLOWS.filter(f=>f.active).length;
        const text=lang==='ar'?`${count} Ù†Ø´Ø·`:`${count} active`;
        document.getElementById('flowsBadgeText').textContent=text;
        document.getElementById('activeFlowCount').textContent=count;
    }

    function activateAll(){
        // Launch confetti celebration
        launchConfetti();
        showToast(lang==='ar'?'ØªÙ… ØªÙØ¹ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª!':'All flows activated!');

        // Stop the pulse animation â€” machine is running now
        const btn=document.getElementById('heroBtn');
        btn.classList.remove('btn-machine-pulse');
        btn.innerHTML='<i data-lucide="check-circle-2"></i><span>'+(lang==='ar'?'Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª ØªØ¹Ù…Ù„':'Flows running')+'</span>';
        btn.style.background='linear-gradient(135deg,#059669,#047857)';
        btn.onclick=null;
        btn.style.cursor='default';
        lucide.createIcons({nodes:[btn]});

        // Activate all flows
        showStats();
        FLOWS.forEach(f=>{
            if(!f.active){
                f.active=true;
                simulateFlow(f);
            }
        });
        renderFlows();
        updateFlowBadge();

        // Scroll to flows after a beat
        setTimeout(()=>nav('flows'),800);
    }

    function simulateFlow(flow){
        const addActivity=(f)=>{
            const msgs=lang==='ar'?
                [`Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø³Ù„Ø© â€” ${f.name}`,`Ø±Ø³Ø§Ù„Ø© Ù…Ø±Ø³Ù„Ø© â€” ${f.name}`,`ØªØ­ÙˆÙŠÙ„ Ù†Ø§Ø¬Ø­ â€” ${f.name}`]:
                [`Cart recovered â€” ${f.nameEn}`,`Message sent â€” ${f.nameEn}`,`Conversion â€” ${f.nameEn}`];
            const types=['green','blue','orange'];
            const idx=Math.floor(Math.random()*3);
            const amount=idx===0?Math.floor(Math.random()*500)+100:0;
            addActivityItem(msgs[idx],types[idx],amount);
        };

        const iv=setInterval(()=>{
            if(!flow.active){clearInterval(iv);return;}
            flow.sent+=Math.floor(Math.random()*8)+2;
            flow.revenue+=Math.floor(Math.random()*300)+50;
            const card=document.getElementById('flow_'+flow.id);
            if(card){
                const stats=card.querySelectorAll('.flow-stat strong');
                if(stats[0]) stats[0].textContent=flow.sent.toLocaleString();
                if(stats[1]) stats[1].textContent=flow.revenue.toLocaleString();
            }
            updateDashboardStats();
            // Show chart data once we have some
            if(!hasRealData && FLOWS.some(f=>f.revenue>0)){
                showChart();
                const totalRev=FLOWS.reduce((a,f)=>a+f.revenue,0);
                renderChart([Math.floor(totalRev*0.1),Math.floor(totalRev*0.15),Math.floor(totalRev*0.2),Math.floor(totalRev*0.3),Math.floor(totalRev*0.5),Math.floor(totalRev*0.7),totalRev],
                    lang==='ar'?['Ø³','Ø£Ø­','Ø¥Ø«','Ø«Ù„','Ø£Ø±','Ø®Ù…','Ø¬Ù…']:['Sa','Su','Mo','Tu','We','Th','Fr']);
            }
            // Random activity
            if(Math.random()>0.5) addActivity(flow);
        },3000+Math.random()*2000);
    }

    function addActivityItem(msg,dotColor,amount){
        const list=document.getElementById('activityList');
        const empty=document.getElementById('activityEmpty');
        if(empty) empty.style.display='none';

        const item=document.createElement('div');
        item.className='activity-item';
        const amtHtml=amount?`<span class="act-amount">+${amount.toLocaleString()} ${lang==='ar'?'Ø±.Ø³':'SAR'}</span>`:'';
        item.innerHTML=`<span class="act-dot ${dotColor}"></span><div class="act-body"><div class="act-msg">${msg}</div><div class="act-time">${lang==='ar'?'Ø§Ù„Ø¢Ù†':'Now'}</div></div>${amtHtml}`;

        // Insert at top
        if(list.firstChild) list.insertBefore(item,list.firstChild);
        else list.appendChild(item);

        // Slide in animation
        requestAnimationFrame(()=>{
            requestAnimationFrame(()=>{
                item.classList.add('slide-in');
                item.classList.add('flash');
            });
        });

        // Keep max 8 items
        while(list.children.length>8) list.removeChild(list.lastChild);
        lucide.createIcons({nodes:[item]});
    }

    function updateDashboardStats(){
        const totalRev=FLOWS.reduce((a,f)=>a+f.revenue,0);
        const totalSent=FLOWS.reduce((a,f)=>a+f.sent,0);
        const rate=totalSent>0?Math.min(Math.round((totalRev/Math.max(totalSent*100,1))*100),38):0;
        document.getElementById('totalRevenue').textContent=totalRev.toLocaleString();
        document.getElementById('messagesSent').textContent=totalSent.toLocaleString();
        document.getElementById('recoveryRate').textContent=rate;
    }

    // ===== CHAT CAMPAIGN CREATOR =====
    function generateCampaign(){
        const input=document.getElementById('chatInput');
        const goal=input.value.trim();
        if(!goal) return;

        const bubbles=document.getElementById('chatBubbles');

        // User bubble
        const userBubble=document.createElement('div');
        userBubble.className='chat-bubble user';
        userBubble.textContent=goal;
        bubbles.appendChild(userBubble);
        input.value='';

        // AI typing dots
        const typing=document.createElement('div');
        typing.className='chat-bubble ai';
        typing.innerHTML='<div class="typing-dots"><span></span><span></span><span></span></div>';
        typing.style.animationDelay='.2s';
        bubbles.appendChild(typing);

        // Scroll to bottom
        bubbles.scrollTop=bubbles.scrollHeight;

        // Simulate AI response
        setTimeout(()=>{
            typing.remove();

            const audience=Math.floor(Math.random()*800)+200;
            const bestTime=lang==='ar'?'Ø§Ù„Ø®Ù…ÙŠØ³ 8 Ù…Ø³Ø§Ø¡Ù‹':'Thursday 8 PM';

            const msgAr=`Ù…Ø±Ø­Ø¨Ø§Ù‹ {customer_name} ğŸ‘‹\n\nØ¹Ù†Ø¯Ù†Ø§ Ù„Ùƒ Ø¹Ø±Ø¶ Ø®Ø§Øµ: ${goal}\n\nØ®ØµÙ… 15% Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ğŸ‰\nØ§Ù„ÙƒÙˆØ¯: RIBH15\n\nğŸ›’ {store_url}\n\nØ§Ù„Ø¹Ø±Ø¶ Ù„ÙØªØ±Ø© Ù…Ø­Ø¯ÙˆØ¯Ø© â°`;
            const msgEn=`Hi {customer_name} ğŸ‘‹\n\nSpecial offer: ${goal}\n\n15% off everything ğŸ‰\nCode: RIBH15\n\nğŸ›’ {store_url}\n\nLimited time only â°`;

            const aiBubble=document.createElement('div');
            aiBubble.className='chat-bubble ai';
            aiBubble.textContent=lang==='ar'?msgAr:msgEn;
            aiBubble.style.animationDelay='.1s';
            bubbles.appendChild(aiBubble);

            // Meta + actions
            const actions=document.createElement('div');
            actions.className='chat-actions';
            actions.innerHTML=`
                <span style="font-size:11px;color:var(--text-muted);display:flex;align-items:center;gap:12px;flex:1">
                    <span><i data-lucide="users" style="width:12px;height:12px;display:inline"></i> ${audience}</span>
                    <span><i data-lucide="clock" style="width:12px;height:12px;display:inline"></i> ${bestTime}</span>
                </span>
                <button class="btn btn-outline" onclick="clearChat()" data-ar="Ù…Ø³Ø­" data-en="Clear">${lang==='ar'?'Ù…Ø³Ø­':'Clear'}</button>
                <button class="btn btn-primary" onclick="launchCustom()"><i data-lucide="send"></i><span data-ar="Ø£Ø·Ù„Ù‚" data-en="Launch">${lang==='ar'?'Ø£Ø·Ù„Ù‚':'Launch'}</span></button>
            `;
            bubbles.appendChild(actions);
            lucide.createIcons({nodes:[aiBubble,actions]});
            bubbles.scrollTop=bubbles.scrollHeight;
        },1500+Math.random()*1000);
    }

    function clearChat(){
        document.getElementById('chatBubbles').innerHTML='';
    }

    function launchCustom(){
        clearChat();
        showToast(lang==='ar'?'ØªÙ… Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ø­Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!':'Campaign launched!');
        launchConfetti();
    }

    // ===== WHATSAPP INFO TOGGLE =====
    function toggleWaInfo(){
        const toggle=document.getElementById('waInfoToggle');
        const info=document.getElementById('waInfo');
        toggle.classList.toggle('open');
        info.classList.toggle('open');
    }

    // ===== IMPORT =====
    function connectImport(platform){
        if(platform==='salla'){
            window.location.href='/setup.html';
        }else{
            showToast(lang==='ar'?`Ø±Ø¨Ø· ${platform} Ù‚Ø±ÙŠØ¨Ø§Ù‹`:`${platform} coming soon`);
        }
    }

    function handleFile(e){
        if(!e.target.files[0]) return;
        const f=e.target.files[0];
        if(f.size>10*1024*1024){showToast(lang==='ar'?'Ø­Ø¬Ù… ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹':'File too large');return;}
        showToast(lang==='ar'?`ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù…Ù† ${f.name}`:`Imported from ${f.name}`);
    }

    // ===== HERO DATA =====
    function loadHeroData(){
        const carts=347,dormant=891,upsell=156;
        const total=154000;

        setTimeout(()=>{
            animateValue(document.getElementById('heroTotal'),total,1800);
            animateValue(document.getElementById('heroCarts'),carts,1200);
            animateValue(document.getElementById('heroDormant'),dormant,1200);
            animateValue(document.getElementById('heroUpsell'),upsell,1200);
        },600);
    }

    // ===== API CALLS =====
    async function loadStats(){
        try{
            const r=await fetch('/api/ribh/stats');
            const d=await r.json();
            if(d.success){
                showStats();
                document.getElementById('totalRevenue').textContent=(d.totalRevenue||0).toLocaleString();
                document.getElementById('recoveryRate').textContent=(d.recoveryRate||0);
            }
        }catch(e){}
    }

    async function loadActivity(){
        try{
            const r=await fetch('/api/ribh/activity');
            const d=await r.json();
            if(d.success&&d.activities?.length>0){
                const list=document.getElementById('activityList');
                const empty=document.getElementById('activityEmpty');
                if(empty) empty.style.display='none';
                d.activities.slice(0,8).forEach((a,i)=>{
                    setTimeout(()=>{
                        addActivityItem(
                            a.message||a.title,
                            a.type==='recovered'?'green':a.type==='sent'?'blue':'orange',
                            a.amount||0
                        );
                    },i*100);
                });
            }
        }catch(e){}
    }

    // ===== ENTER KEY =====
    document.addEventListener('keydown',e=>{
        if(e.key==='Enter'&&document.activeElement===document.getElementById('chatInput')){
            generateCampaign();
        }
    });

    // ===== INIT =====
    document.addEventListener('DOMContentLoaded',()=>{
        lucide.createIcons();
        applyLang();
        renderFlows();
        updateFlowBadge();
        loadHeroData();
        loadStats();
        loadActivity();

        ['dashboard','flows','settings'].forEach(id=>{
            const el=document.getElementById(id);
            if(el) obs.observe(el);
        });

        setInterval(()=>{loadStats();loadActivity();},30000);
    });
    </script>
</body>
</html>
