<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RIBH | Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>
    <meta name="description" content="Ø±ÙØ¨Ø­ - Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{
            --bg:#000000;--bg-secondary:#0a0a0a;
            --card:rgba(18,18,18,0.95);--card-hover:rgba(28,28,28,0.95);
            --card-border:rgba(255,255,255,0.06);
            --text:#FFFFFF;--text-secondary:#A1A1AA;--text-dim:#52525B;
            --primary:#10B981;--primary-glow:rgba(16,185,129,0.5);
            --secondary:#6366F1;
            --gradient:linear-gradient(135deg,#10B981 0%,#059669 100%);
            --gradient-accent:linear-gradient(135deg,#6366F1 0%,#8B5CF6 100%);
            --success:#22C55E;--warning:#F59E0B;--danger:#EF4444;
            --sidebar-w:240px;
        }
        html[dir="ltr"]{font-family:'Inter',sans-serif}
        html[dir="rtl"]{font-family:'IBM Plex Sans Arabic',sans-serif}
        body{font-family:inherit;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}

        /* Background Effects */
        .bg-effects{position:fixed;inset:0;pointer-events:none;z-index:0}
        .bg-effects::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;
            background:radial-gradient(ellipse 600px 600px at 10% 20%,rgba(16,185,129,0.08),transparent 50%),
            radial-gradient(ellipse 500px 500px at 90% 80%,rgba(99,102,241,0.06),transparent 50%);
            animation:bgFloat 30s ease-in-out infinite}
        @keyframes bgFloat{0%,100%{transform:translate(0,0)}50%{transform:translate(20px,20px)}}
        .grid-bg{position:fixed;inset:0;background-image:
            linear-gradient(rgba(255,255,255,0.02) 1px,transparent 1px),
            linear-gradient(90deg,rgba(255,255,255,0.02) 1px,transparent 1px);
            background-size:50px 50px;pointer-events:none;z-index:0}

        /* Sidebar */
        .sidebar{width:var(--sidebar-w);background:var(--card);padding:20px 16px;display:flex;flex-direction:column;position:fixed;height:100vh;z-index:100;border-left:1px solid var(--card-border)}
        html[dir="rtl"] .sidebar{right:0;border-right:none}
        html[dir="ltr"] .sidebar{left:0;border-left:none;border-right:1px solid var(--card-border)}
        .logo{display:flex;align-items:center;gap:10px;margin-bottom:32px;padding:0 4px}
        .logo-icon{width:40px;height:40px;background:var(--gradient);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:20px;box-shadow:0 0 24px var(--primary-glow)}
        .logo-text{font-size:22px;font-weight:700;background:var(--gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
        .nav{display:flex;flex-direction:column;gap:4px;flex:1}
        .nav-item{display:flex;align-items:center;gap:10px;padding:12px 14px;border-radius:10px;color:var(--text-secondary);text-decoration:none;font-size:14px;font-weight:500;transition:all .2s;cursor:pointer}
        .nav-item:hover{background:rgba(255,255,255,0.05);color:var(--text)}
        .nav-item.active{background:rgba(16,185,129,0.1);color:var(--primary)}
        .nav-icon{font-size:18px;width:22px;text-align:center}
        .nav-divider{height:1px;background:var(--card-border);margin:12px 0}
        .wa-status{display:flex;align-items:center;gap:8px;padding:12px 14px;border-radius:10px;background:rgba(255,255,255,0.03);font-size:13px;color:var(--text-secondary);margin-top:8px}
        .wa-dot{width:8px;height:8px;border-radius:50%;background:var(--success);animation:pulse 2s infinite}
        .lang-toggle{display:flex;align-items:center;gap:8px;padding:10px 14px;background:rgba(255,255,255,0.03);border-radius:10px;margin-top:auto;cursor:pointer;transition:all .2s;font-size:13px;color:var(--text-secondary)}
        .lang-toggle:hover{background:rgba(255,255,255,0.06)}

        /* Main Content */
        .main{flex:1;padding:28px 36px 60px;position:relative;z-index:1}
        html[dir="rtl"] .main{margin-right:var(--sidebar-w)}
        html[dir="ltr"] .main{margin-left:var(--sidebar-w)}

        /* Section spacing */
        .section{margin-bottom:40px;scroll-margin-top:24px}
        .section-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;gap:12px}
        .section-title{font-size:20px;font-weight:700;display:flex;align-items:center;gap:8px}

        /* Stats Row */
        .stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
        .stat-card{background:var(--card);border:1px solid var(--card-border);border-radius:16px;padding:20px;transition:all .3s}
        .stat-card:hover{border-color:rgba(16,185,129,0.3);transform:translateY(-3px)}
        .stat-card.revenue{border-color:rgba(16,185,129,0.2);background:linear-gradient(135deg,rgba(16,185,129,0.08),rgba(18,18,18,0.95))}
        .stat-card .stat-icon-wrap{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;margin-bottom:12px}
        .stat-card .stat-icon-wrap.green{background:rgba(16,185,129,0.15);border:1px solid rgba(16,185,129,0.2)}
        .stat-card .stat-icon-wrap.blue{background:rgba(59,130,246,0.15);border:1px solid rgba(59,130,246,0.2)}
        .stat-card .stat-icon-wrap.purple{background:rgba(99,102,241,0.15);border:1px solid rgba(99,102,241,0.2)}
        .stat-card .stat-icon-wrap.orange{background:rgba(245,158,11,0.15);border:1px solid rgba(245,158,11,0.2)}
        .stat-value{font-size:28px;font-weight:800;margin-bottom:4px;line-height:1.1}
        .stat-value.big{font-size:36px;color:var(--primary)}
        .stat-label{font-size:13px;color:var(--text-secondary)}
        .stat-change{font-size:11px;font-weight:600;padding:2px 8px;border-radius:6px;display:inline-flex;align-items:center;gap:3px;margin-top:6px}
        .stat-change.up{color:var(--success);background:rgba(34,197,94,0.1)}

        /* Quick Actions */
        .quick-actions{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
        .qa-card{background:var(--card);border:1px solid var(--card-border);border-radius:16px;padding:22px;cursor:pointer;transition:all .3s;text-align:center}
        .qa-card:hover{border-color:rgba(16,185,129,0.4);transform:translateY(-3px);box-shadow:0 8px 32px rgba(0,0,0,0.3)}
        .qa-card.active{border-color:var(--primary);background:rgba(16,185,129,0.05)}
        .qa-card .qa-icon{font-size:32px;margin-bottom:10px}
        .qa-card .qa-title{font-size:15px;font-weight:700;margin-bottom:4px}
        .qa-card .qa-desc{font-size:12px;color:var(--text-secondary);line-height:1.5}

        /* Expandable Sections */
        .expand-section{max-height:0;overflow:hidden;transition:max-height .5s ease,opacity .3s ease,margin .3s ease;opacity:0;margin-top:0}
        .expand-section.open{max-height:2000px;opacity:1;margin-top:20px}

        /* Tabs */
        .tabs{display:flex;gap:4px;background:rgba(255,255,255,0.03);border-radius:10px;padding:4px;margin-bottom:20px;flex-wrap:wrap}
        .tab{padding:8px 18px;border-radius:8px;font-size:13px;font-weight:600;color:var(--text-secondary);cursor:pointer;transition:all .2s;white-space:nowrap}
        .tab:hover{color:var(--text)}
        .tab.active{background:rgba(16,185,129,0.15);color:var(--primary)}

        /* Campaign Cards */
        .campaign-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:14px}
        .camp-card{background:var(--card);border:1px solid var(--card-border);border-radius:14px;padding:18px;transition:all .3s;position:relative;overflow:hidden}
        .camp-card:hover{border-color:rgba(255,255,255,0.12);transform:translateY(-2px)}
        .camp-card::after{content:'';position:absolute;top:0;right:0;width:3px;height:100%;border-radius:0 14px 14px 0}
        html[dir="ltr"] .camp-card::after{right:auto;left:0;border-radius:14px 0 0 14px}
        .camp-card .camp-header{display:flex;align-items:center;gap:10px;margin-bottom:8px}
        .camp-card .camp-icon{font-size:24px;width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:10px;flex-shrink:0}
        .camp-card .camp-name{font-size:14px;font-weight:700;flex:1}
        .camp-card .camp-desc{font-size:12px;color:var(--text-secondary);line-height:1.6;margin-bottom:10px}
        .status-badge{display:inline-flex;align-items:center;gap:5px;padding:3px 10px;border-radius:6px;font-size:11px;font-weight:600}
        .status-badge.running{background:rgba(16,185,129,0.1);color:var(--success);border:1px solid rgba(16,185,129,0.2)}
        .status-badge.running::before{content:'';width:6px;height:6px;border-radius:50%;background:var(--success);animation:pulse 1.5s infinite}
        .status-badge.draft{background:rgba(245,158,11,0.1);color:var(--warning);border:1px solid rgba(245,158,11,0.2)}
        .status-badge.completed{background:rgba(99,102,241,0.1);color:var(--secondary);border:1px solid rgba(99,102,241,0.2)}
        .camp-card .progress-wrap{height:6px;background:rgba(255,255,255,0.1);border-radius:6px;overflow:hidden;margin:8px 0 6px}
        .camp-card .progress-fill{height:100%;background:var(--gradient);border-radius:6px;transition:width .3s}
        .camp-card .camp-revenue{font-size:13px;font-weight:700;color:var(--primary);display:flex;align-items:center;gap:4px}
        .camp-card .camp-meta{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:6px}

        /* Campaign Launcher Templates */
        .tpl-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
        .tpl-card{background:var(--card);border:1px solid var(--card-border);border-radius:14px;padding:16px;cursor:pointer;transition:all .3s}
        .tpl-card:hover{border-color:rgba(16,185,129,0.4);transform:translateY(-2px)}
        .tpl-card.selected{border-color:var(--primary);background:rgba(16,185,129,0.05);box-shadow:0 0 20px rgba(16,185,129,0.15)}
        .tpl-card .tpl-header{display:flex;align-items:center;gap:10px;margin-bottom:6px}
        .tpl-card .tpl-icon{font-size:22px}
        .tpl-card .tpl-name{font-size:13px;font-weight:700}
        .tpl-card .tpl-impact{font-size:11px;color:var(--primary);font-weight:600}

        /* Message Preview Area */
        .msg-preview-area{display:none;margin-top:16px;background:var(--card);border:1px solid var(--card-border);border-radius:14px;padding:20px;animation:fadeInUp .3s ease-out}
        .msg-preview-area.visible{display:block}
        .msg-preview-area textarea{width:100%;min-height:120px;padding:14px;background:rgba(255,255,255,0.03);border:1px solid var(--card-border);border-radius:10px;color:var(--text);font-size:14px;font-family:inherit;line-height:1.7;resize:vertical;transition:all .2s}
        .msg-preview-area textarea:focus{outline:none;border-color:var(--primary);background:rgba(16,185,129,0.03)}
        .msg-preview-area .audience-row{display:flex;align-items:center;gap:10px;padding:10px 14px;background:rgba(16,185,129,0.05);border:1px solid rgba(16,185,129,0.2);border-radius:10px;font-size:14px;font-weight:600;color:var(--primary);margin-bottom:14px}
        .msg-preview-area .audience-row .count-num{font-size:20px;font-weight:800}

        /* Buttons */
        .btn{display:inline-flex;align-items:center;gap:8px;padding:12px 22px;border-radius:10px;font-size:14px;font-weight:600;cursor:pointer;transition:all .2s;font-family:inherit;text-decoration:none;border:none}
        .btn-primary{background:var(--gradient);color:white}
        .btn-primary:hover{transform:translateY(-2px);box-shadow:0 8px 30px var(--primary-glow)}
        .btn-primary:disabled{opacity:0.5;cursor:not-allowed;transform:none;box-shadow:none}
        .btn-secondary{background:transparent;border:1px solid var(--card-border);color:var(--text-secondary)}
        .btn-secondary:hover{border-color:var(--primary);color:var(--primary)}
        .btn-sm{padding:8px 16px;font-size:13px;border-radius:8px}

        /* Activity Feed */
        .activity-list{display:flex;flex-direction:column;gap:2px}
        .activity-item{display:flex;align-items:center;gap:12px;padding:12px 14px;border-radius:10px;transition:background .2s}
        .activity-item:hover{background:rgba(255,255,255,0.02)}
        .activity-item .act-icon{width:36px;height:36px;border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0}
        .activity-item .act-icon.success{background:rgba(34,197,94,0.15);border:1px solid rgba(34,197,94,0.2)}
        .activity-item .act-icon.info{background:rgba(59,130,246,0.15);border:1px solid rgba(59,130,246,0.2)}
        .activity-item .act-icon.pending{background:rgba(245,158,11,0.15);border:1px solid rgba(245,158,11,0.2)}
        .activity-item .act-info{flex:1;min-width:0}
        .activity-item .act-title{font-size:13px;font-weight:500;margin-bottom:2px}
        .activity-item .act-time{font-size:11px;color:var(--text-dim)}
        .activity-item .act-amount{font-weight:700;font-size:14px;color:var(--success);white-space:nowrap}

        /* Import Section */
        .upload-zone{background:var(--card);border:2px dashed rgba(16,185,129,0.3);border-radius:16px;padding:40px;text-align:center;cursor:pointer;transition:all .3s}
        .upload-zone:hover,.upload-zone.dragover{border-color:var(--primary);background:rgba(16,185,129,0.05)}
        .upload-zone .uz-icon{font-size:40px;margin-bottom:12px}
        .upload-zone .uz-title{font-size:16px;font-weight:600;margin-bottom:6px}
        .upload-zone .uz-desc{font-size:13px;color:var(--text-secondary);margin-bottom:12px}
        .upload-zone .format-badges{display:flex;justify-content:center;gap:8px;flex-wrap:wrap}
        .upload-zone .format-badge{display:inline-flex;align-items:center;gap:4px;background:rgba(255,255,255,0.05);border:1px solid var(--card-border);padding:4px 12px;border-radius:6px;font-size:12px;color:var(--text-secondary)}
        .import-file-input{display:none}
        .import-results{display:none;background:var(--card);border:1px solid rgba(16,185,129,0.3);border-radius:16px;padding:28px;text-align:center}
        .import-results.visible{display:block;animation:fadeInUp .3s ease-out}
        .import-results .ir-icon{font-size:40px;margin-bottom:12px}
        .import-results .ir-title{font-size:18px;font-weight:700;background:var(--gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:8px}
        .import-results .ir-stats{display:flex;justify-content:center;gap:24px;margin-top:16px;flex-wrap:wrap}
        .import-results .ir-stat-val{font-size:24px;font-weight:800;color:var(--primary)}
        .import-results .ir-stat-label{font-size:12px;color:var(--text-secondary)}
        .import-progress{display:none;text-align:center;padding:20px}
        .import-progress.visible{display:block}
        .import-progress .ip-bar-wrap{height:10px;background:rgba(255,255,255,0.1);border-radius:10px;overflow:hidden;max-width:400px;margin:16px auto}
        .import-progress .ip-bar-fill{height:100%;background:var(--gradient);border-radius:10px;transition:width .3s;width:0%}

        /* Animations */
        @keyframes fadeInUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
        @keyframes pulse{0%,100%{opacity:1;box-shadow:0 0 0 0 rgba(34,197,94,0.4)}50%{opacity:.8;box-shadow:0 0 0 6px rgba(34,197,94,0)}}
        .animate-in{animation:fadeInUp .4s ease-out forwards}
        .delay-1{animation-delay:.1s}.delay-2{animation-delay:.15s}.delay-3{animation-delay:.2s}.delay-4{animation-delay:.25s}

        /* Empty State */
        .empty-state{text-align:center;padding:40px 20px;color:var(--text-secondary)}
        .empty-state .empty-icon{font-size:40px;margin-bottom:12px;opacity:0.5}
        .empty-state .empty-title{font-size:16px;font-weight:600;color:var(--text);margin-bottom:6px}
        .empty-state .empty-desc{font-size:13px}

        /* Mobile Bottom Nav */
        .mobile-nav{display:none;position:fixed;bottom:0;left:0;right:0;background:var(--card);border-top:1px solid var(--card-border);padding:8px 0;z-index:200;justify-content:space-around}
        .mobile-nav .mn-item{display:flex;flex-direction:column;align-items:center;gap:2px;padding:6px 12px;font-size:10px;color:var(--text-secondary);text-decoration:none;cursor:pointer;transition:color .2s}
        .mobile-nav .mn-item.active{color:var(--primary)}
        .mobile-nav .mn-item .mn-icon{font-size:20px}

        /* Responsive */
        @media(max-width:1200px){
            .stats-grid{grid-template-columns:repeat(2,1fr)}
            .campaign-grid,.tpl-grid{grid-template-columns:1fr 1fr}
        }
        @media(max-width:768px){
            .sidebar{display:none}
            .main{margin-right:0!important;margin-left:0!important;padding:20px 16px 80px}
            .stats-grid{grid-template-columns:repeat(2,1fr)}
            .quick-actions{grid-template-columns:1fr}
            .campaign-grid,.tpl-grid{grid-template-columns:1fr}
            .stat-value.big{font-size:28px}
            .mobile-nav{display:flex}
        }
        @media(max-width:420px){
            .stats-grid{grid-template-columns:1fr 1fr}
            .stat-value{font-size:22px}
        }

        /* Scrollbar */
        ::-webkit-scrollbar{width:6px}
        ::-webkit-scrollbar-track{background:transparent}
        ::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.1);border-radius:3px}
        ::-webkit-scrollbar-thumb:hover{background:rgba(255,255,255,0.2)}
    </style>
</head>
<body>
    <div class="bg-effects"></div>
    <div class="grid-bg"></div>

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo">
            <div class="logo-icon">ğŸ’š</div>
            <span class="logo-text" data-ar="Ø±ÙØ¨Ø­" data-en="RIBH">Ø±ÙØ¨Ø­</span>
        </div>
        <nav class="nav">
            <a class="nav-item active" data-section="stats" onclick="scrollToSection('stats')">
                <span class="nav-icon">ğŸ“Š</span>
                <span data-ar="Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©" data-en="Dashboard">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
            </a>
            <a class="nav-item" data-section="campaigns" onclick="scrollToSection('campaigns')">
                <span class="nav-icon">ğŸ“£</span>
                <span data-ar="Ø§Ù„Ø­Ù…Ù„Ø§Øª" data-en="Campaigns">Ø§Ù„Ø­Ù…Ù„Ø§Øª</span>
            </a>
            <a class="nav-item" data-section="import" onclick="scrollToSection('import')">
                <span class="nav-icon">ğŸ‘¥</span>
                <span data-ar="Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡" data-en="Customers">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</span>
            </a>
            <a class="nav-item" data-section="cod" onclick="scrollToSection('cod')">
                <span class="nav-icon">ğŸ“¦</span>
                <span data-ar="ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª" data-en="COD Confirm">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</span>
            </a>
            <a class="nav-item" data-section="reviews" onclick="scrollToSection('reviews')">
                <span class="nav-icon">â­</span>
                <span data-ar="Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª" data-en="Reviews">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</span>
            </a>
            <a class="nav-item" data-section="loyalty" onclick="scrollToSection('loyalty')">
                <span class="nav-icon">ğŸ†</span>
                <span data-ar="Ø§Ù„ÙˆÙ„Ø§Ø¡" data-en="Loyalty">Ø§Ù„ÙˆÙ„Ø§Ø¡</span>
            </a>
            <a class="nav-item" data-section="settings" onclick="window.location.href='/settings.html'">
                <span class="nav-icon">âš™ï¸</span>
                <span data-ar="Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª" data-en="Settings">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
            </a>
            <div class="nav-divider"></div>
            <div class="wa-status">
                <span class="wa-dot"></span>
                <span data-ar="ÙˆØ§ØªØ³Ø§Ø¨: Ù…ØªØµÙ„" data-en="WhatsApp: Connected">ÙˆØ§ØªØ³Ø§Ø¨: Ù…ØªØµÙ„</span>
            </div>
        </nav>
        <div class="lang-toggle" onclick="toggleLanguage()">
            <span>ğŸŒ</span>
            <span id="langLabel">English</span>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main">

        <!-- Section 1: Revenue Overview -->
        <div class="section animate-in" id="stats">
            <div class="stats-grid">
                <div class="stat-card revenue">
                    <div class="stat-icon-wrap green">ğŸ’°</div>
                    <div class="stat-value big" id="totalRevenue">0 <span style="font-size:16px;font-weight:600;color:var(--text-secondary)" data-ar="Ø±.Ø³" data-en="SAR">Ø±.Ø³</span></div>
                    <div class="stat-label" data-ar="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³ØªØ±Ø¬Ø¹Ø©" data-en="Total Recovered Revenue">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³ØªØ±Ø¬Ø¹Ø©</div>
                    <div class="stat-change up" id="revenueTrend">â†‘ +0% <span data-ar="Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±" data-en="this month">Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon-wrap blue">ğŸ›’</div>
                    <div class="stat-value" id="cartsRecovered">0</div>
                    <div class="stat-label" data-ar="Ø§Ù„Ø³Ù„Ø§Øª Ø§Ù„Ù…Ø³ØªØ±Ø¬Ø¹Ø©" data-en="Carts Recovered">Ø§Ù„Ø³Ù„Ø§Øª Ø§Ù„Ù…Ø³ØªØ±Ø¬Ø¹Ø©</div>
                    <div class="stat-change up">â†‘ +8%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon-wrap purple">ğŸ‘¥</div>
                    <div class="stat-value" id="totalCustomers">0</div>
                    <div class="stat-label" data-ar="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡" data-en="Total Customers">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
                    <div class="stat-change up">â†‘ +15%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon-wrap orange">ğŸ“ˆ</div>
                    <div class="stat-value" id="recoveryRate">0%</div>
                    <div class="stat-label" data-ar="Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹" data-en="Recovery Rate">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹</div>
                    <div class="stat-change up">â†‘ +5%</div>
                </div>
            </div>
        </div>

        <!-- Section 2: Quick Actions -->
        <div class="section animate-in delay-1" id="quickActions">
            <div class="section-header">
                <h2 class="section-title">
                    <span>âš¡</span>
                    <span data-ar="Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©" data-en="Quick Actions">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</span>
                </h2>
            </div>
            <div class="quick-actions">
                <div class="qa-card" id="qaLaunch" onclick="toggleExpand('launcherSection','qaLaunch')">
                    <div class="qa-icon">ğŸš€</div>
                    <div class="qa-title" data-ar="Ø£Ø·Ù„Ù‚ Ø­Ù…Ù„Ø©" data-en="Launch Campaign">Ø£Ø·Ù„Ù‚ Ø­Ù…Ù„Ø©</div>
                    <div class="qa-desc" data-ar="Ø§Ø®ØªØ± Ù‚Ø§Ù„Ø¨ ÙˆØ£Ø·Ù„Ù‚ Ø­Ù…Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨ ÙÙˆØ±Ø§Ù‹" data-en="Pick a template and launch a WhatsApp campaign instantly">Ø§Ø®ØªØ± Ù‚Ø§Ù„Ø¨ ÙˆØ£Ø·Ù„Ù‚ Ø­Ù…Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨ ÙÙˆØ±Ø§Ù‹</div>
                </div>
                <div class="qa-card" id="qaImport" onclick="toggleExpand('importSection','qaImport')">
                    <div class="qa-icon">ğŸ“¥</div>
                    <div class="qa-title" data-ar="Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¹Ù…Ù„Ø§Ø¡" data-en="Import Customers">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¹Ù…Ù„Ø§Ø¡</div>
                    <div class="qa-desc" data-ar="Ø§Ø±ÙØ¹ Ù…Ù„Ù Ø¹Ù…Ù„Ø§Ø¦Ùƒ Ø¨Ø¶ØºØ·Ø© ÙˆØ§Ø­Ø¯Ø©" data-en="Upload your customer file with one click">Ø§Ø±ÙØ¹ Ù…Ù„Ù Ø¹Ù…Ù„Ø§Ø¦Ùƒ Ø¨Ø¶ØºØ·Ø© ÙˆØ§Ø­Ø¯Ø©</div>
                </div>
                <div class="qa-card" id="qaWhatsapp" onclick="window.location.href='/whatsapp.html'">
                    <div class="qa-icon">ğŸ“±</div>
                    <div class="qa-title" data-ar="Ø±Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨" data-en="Connect WhatsApp">Ø±Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨</div>
                    <div class="qa-desc" data-ar="Ø§Ø±Ø¨Ø· Ø±Ù‚Ù…Ùƒ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ" data-en="Connect your number to start auto-sending">Ø§Ø±Ø¨Ø· Ø±Ù‚Ù…Ùƒ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</div>
                </div>
            </div>

            <!-- Inline Campaign Launcher (hidden by default) -->
            <div class="expand-section" id="launcherSection">
                <div class="section-header">
                    <h3 class="section-title" style="font-size:16px">
                        <span>ğŸ“£</span>
                        <span data-ar="Ø§Ø®ØªØ± Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø­Ù…Ù„Ø©" data-en="Choose Campaign Template">Ø§Ø®ØªØ± Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø­Ù…Ù„Ø©</span>
                    </h3>
                </div>
                <div class="tpl-grid" id="tplGrid"></div>
                <div class="msg-preview-area" id="msgPreview">
                    <div class="audience-row">
                        <span>ğŸ‘¥</span>
                        <span class="count-num" id="tplAudienceCount">--</span>
                        <span data-ar="Ø¹Ù…ÙŠÙ„ Ù…Ø¤Ù‡Ù„" data-en="eligible customers">Ø¹Ù…ÙŠÙ„ Ù…Ø¤Ù‡Ù„</span>
                    </div>
                    <label style="font-size:13px;font-weight:600;color:var(--text-secondary);display:block;margin-bottom:8px" data-ar="ğŸ’¬ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø©" data-en="ğŸ’¬ Message Preview">ğŸ’¬ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø©</label>
                    <textarea id="tplMessage"></textarea>
                    <div style="display:flex;gap:10px;margin-top:14px;flex-wrap:wrap">
                        <button class="btn btn-primary" id="launchBtn" onclick="launchCampaign()">
                            <span>ğŸš€</span>
                            <span data-ar="Ø£Ø·Ù„Ù‚ Ø§Ù„Ø­Ù…Ù„Ø©" data-en="Launch Campaign">Ø£Ø·Ù„Ù‚ Ø§Ù„Ø­Ù…Ù„Ø©</span>
                        </button>
                        <button class="btn btn-secondary" onclick="cancelTemplate()">
                            <span data-ar="Ø¥Ù„ØºØ§Ø¡" data-en="Cancel">Ø¥Ù„ØºØ§Ø¡</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Inline Import Section (hidden by default) -->
            <div class="expand-section" id="importSection">
                <div class="upload-zone" id="uploadZone" onclick="document.getElementById('importFileInput').click()">
                    <div class="uz-icon">ğŸ“‚</div>
                    <div class="uz-title" data-ar="Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„Ù Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±" data-en="Drag file here or click to browse">Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„Ù Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</div>
                    <div class="uz-desc" data-ar="ÙŠØªÙ… ÙƒØ´Ù Ø§Ù„ØµÙŠØºØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹" data-en="Format is auto-detected">ÙŠØªÙ… ÙƒØ´Ù Ø§Ù„ØµÙŠØºØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</div>
                    <div class="format-badges">
                        <span class="format-badge">CSV</span>
                        <span class="format-badge">Excel (.xlsx)</span>
                        <span class="format-badge">JSON</span>
                    </div>
                </div>
                <input type="file" id="importFileInput" class="import-file-input" accept=".csv,.xlsx,.xls,.json" onchange="handleImportFile(event)">
                <div class="import-progress" id="importProgress">
                    <div style="font-size:28px;margin-bottom:8px">â³</div>
                    <div style="font-weight:600" data-ar="Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯..." data-en="Importing...">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯...</div>
                    <div class="ip-bar-wrap"><div class="ip-bar-fill" id="importBar"></div></div>
                    <div style="font-size:13px;color:var(--text-secondary)" id="importCounter">0 / 0</div>
                </div>
                <div class="import-results" id="importResults">
                    <div class="ir-icon">âœ…</div>
                    <div class="ir-title" data-ar="ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­!" data-en="Import Complete!">ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­!</div>
                    <div class="ir-stats">
                        <div><div class="ir-stat-val" id="irNew">0</div><div class="ir-stat-label" data-ar="Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯" data-en="New">Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</div></div>
                        <div><div class="ir-stat-val" id="irDupes">0</div><div class="ir-stat-label" data-ar="Ù…ÙƒØ±Ø±" data-en="Duplicates">Ù…ÙƒØ±Ø±</div></div>
                        <div><div class="ir-stat-val" id="irReady">0</div><div class="ir-stat-label" data-ar="Ø¬Ø§Ù‡Ø² Ù„Ù„Ø­Ù…Ù„Ø§Øª" data-en="Campaign Ready">Ø¬Ø§Ù‡Ø² Ù„Ù„Ø­Ù…Ù„Ø§Øª</div></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 3: Active Campaigns -->
        <div class="section animate-in delay-2" id="campaigns">
            <div class="section-header">
                <h2 class="section-title">
                    <span>ğŸ“£</span>
                    <span data-ar="Ø§Ù„Ø­Ù…Ù„Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©" data-en="Active Campaigns">Ø§Ù„Ø­Ù…Ù„Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</span>
                </h2>
                <button class="btn btn-primary btn-sm" onclick="toggleExpand('launcherSection','qaLaunch');scrollToSection('quickActions')">
                    <span>+</span>
                    <span data-ar="Ø£Ø·Ù„Ù‚ Ø­Ù…Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©" data-en="New Campaign">Ø£Ø·Ù„Ù‚ Ø­Ù…Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
                </button>
            </div>
            <div class="tabs" id="campaignTabs">
                <div class="tab active" onclick="filterCampaigns('all')" data-ar="Ø§Ù„ÙƒÙ„" data-en="All">Ø§Ù„ÙƒÙ„</div>
                <div class="tab" onclick="filterCampaigns('running')" data-ar="Ù†Ø´Ø·Ø©" data-en="Active">Ù†Ø´Ø·Ø©</div>
                <div class="tab" onclick="filterCampaigns('draft')" data-ar="Ù…Ø³ÙˆØ¯Ø©" data-en="Draft">Ù…Ø³ÙˆØ¯Ø©</div>
                <div class="tab" onclick="filterCampaigns('completed')" data-ar="Ù…ÙƒØªÙ…Ù„Ø©" data-en="Completed">Ù…ÙƒØªÙ…Ù„Ø©</div>
            </div>
            <div class="campaign-grid" id="activeCampaignGrid">
                <div class="empty-state" id="campaignEmptyState">
                    <div class="empty-icon">ğŸ“­</div>
                    <div class="empty-title" data-ar="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ù…Ù„Ø§Øª Ø¨Ø¹Ø¯" data-en="No campaigns yet">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ù…Ù„Ø§Øª Ø¨Ø¹Ø¯</div>
                    <div class="empty-desc" data-ar="Ø£Ø·Ù„Ù‚ Ø£ÙˆÙ„ Ø­Ù…Ù„Ø© Ù…Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø£Ø¹Ù„Ø§Ù‡!" data-en="Launch your first campaign from the buttons above!">Ø£Ø·Ù„Ù‚ Ø£ÙˆÙ„ Ø­Ù…Ù„Ø© Ù…Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø£Ø¹Ù„Ø§Ù‡!</div>
                </div>
            </div>
        </div>

        <!-- Section 5: Recent Activity -->
        <div class="section animate-in delay-3" id="activity">
            <div class="section-header">
                <h2 class="section-title">
                    <span>ğŸ“‹</span>
                    <span data-ar="Ø¢Ø®Ø± Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª" data-en="Recent Activity">Ø¢Ø®Ø± Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª</span>
                </h2>
                <div style="display:flex;align-items:center;gap:6px;font-size:12px;color:var(--success);background:rgba(34,197,94,0.1);padding:4px 10px;border-radius:20px">
                    <span class="wa-dot" style="width:6px;height:6px"></span>
                    <span data-ar="Ù…Ø¨Ø§Ø´Ø±" data-en="Live">Ù…Ø¨Ø§Ø´Ø±</span>
                </div>
            </div>
            <div style="background:var(--card);border:1px solid var(--card-border);border-radius:16px;overflow:hidden">
                <div class="activity-list" id="activityList">
                    <div class="empty-state" id="activityEmpty">
                        <div class="empty-icon">ğŸš€</div>
                        <div class="empty-title" data-ar="Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² ÙˆÙŠØ¹Ù…Ù„!" data-en="System Ready!">Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² ÙˆÙŠØ¹Ù…Ù„!</div>
                        <div class="empty-desc" data-ar="Ø¹Ù†Ø¯Ù…Ø§ ÙŠØªØ±Ùƒ Ø¹Ù…ÙŠÙ„ Ø³Ù„ØªÙ‡ØŒ Ø³ØªØ±Ù‰ Ø§Ù„Ù†Ø´Ø§Ø· Ù‡Ù†Ø§" data-en="Activity will appear here when carts are recovered">Ø¹Ù†Ø¯Ù…Ø§ ÙŠØªØ±Ùƒ Ø¹Ù…ÙŠÙ„ Ø³Ù„ØªÙ‡ØŒ Ø³ØªØ±Ù‰ Ø§Ù„Ù†Ø´Ø§Ø· Ù‡Ù†Ø§</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 6: Import (scroll target) -->
        <div class="section" id="import" style="scroll-margin-top:24px">
            <div class="section-header">
                <h2 class="section-title">
                    <span>ğŸ‘¥</span>
                    <span data-ar="Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡" data-en="Import Customers">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</span>
                </h2>
            </div>
            <div class="upload-zone" onclick="toggleExpand('importSection','qaImport');scrollToSection('quickActions')">
                <div class="uz-icon">ğŸ“¥</div>
                <div class="uz-title" data-ar="Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¹Ù…Ù„Ø§Ø¦Ùƒ" data-en="Click here to import customers">Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¹Ù…Ù„Ø§Ø¦Ùƒ</div>
                <div class="uz-desc" data-ar="CSV, Excel, Ø£Ùˆ JSON - ÙŠØªÙ… ÙƒØ´Ù Ø§Ù„ØµÙŠØºØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹" data-en="CSV, Excel, or JSON - format auto-detected">CSV, Excel, Ø£Ùˆ JSON - ÙŠØªÙ… ÙƒØ´Ù Ø§Ù„ØµÙŠØºØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</div>
            </div>
        </div>

        <!-- Section: COD Confirmation -->
        <div class="section animate-in" id="cod" style="scroll-margin-top:24px">
            <div class="section-header">
                <h2 class="section-title">
                    <span>ğŸ“¦</span>
                    <span data-ar="ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…" data-en="COD Confirmation">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</span>
                </h2>
            </div>
            <div class="stats-grid" style="grid-template-columns:repeat(4,1fr)">
                <div class="stat-card">
                    <div class="stat-icon-wrap green">âœ…</div>
                    <div class="stat-value" id="codConfirmRate">0%</div>
                    <div class="stat-label" data-ar="Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ£ÙƒÙŠØ¯" data-en="Confirmation Rate">Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ£ÙƒÙŠØ¯</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon-wrap blue">ğŸ’³</div>
                    <div class="stat-value" id="codConvertRate">0%</div>
                    <div class="stat-label" data-ar="ØªØ­ÙˆÙŠÙ„ Ù„Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ø³Ø¨Ù‚" data-en="Prepaid Conversion">ØªØ­ÙˆÙŠÙ„ Ù„Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ø³Ø¨Ù‚</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon-wrap orange">âŒ</div>
                    <div class="stat-value" id="codCancelRate">0%</div>
                    <div class="stat-label" data-ar="Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ù„ØºØ§Ø¡" data-en="Cancellation Rate">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ù„ØºØ§Ø¡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon-wrap purple">ğŸ’°</div>
                    <div class="stat-value" id="codSavings">0</div>
                    <div class="stat-label" data-ar="Ø§Ù„ØªÙˆÙÙŠØ± (Ø±.Ø³)" data-en="Savings (SAR)">Ø§Ù„ØªÙˆÙÙŠØ± (Ø±.Ø³)</div>
                </div>
            </div>
            <div style="background:var(--card);border:1px solid var(--card-border);border-radius:16px;padding:24px;margin-top:16px">
                <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:16px">
                    <div>
                        <div style="font-size:15px;font-weight:600;margin-bottom:4px" data-ar="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª" data-en="Total Orders">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
                        <div style="font-size:28px;font-weight:800;color:var(--primary)" id="codTotal">0</div>
                    </div>
                    <div style="display:flex;gap:20px;flex-wrap:wrap">
                        <div style="text-align:center">
                            <div style="font-size:13px;color:var(--text-secondary);margin-bottom:4px" data-ar="Ù…Ø¤ÙƒØ¯" data-en="Confirmed">Ù…Ø¤ÙƒØ¯</div>
                            <div style="font-size:20px;font-weight:700;color:var(--success)" id="codConfirmed">0</div>
                        </div>
                        <div style="text-align:center">
                            <div style="font-size:13px;color:var(--text-secondary);margin-bottom:4px" data-ar="Ù…Ø­ÙˆÙ„" data-en="Converted">Ù…Ø­ÙˆÙ„</div>
                            <div style="font-size:20px;font-weight:700;color:var(--secondary)" id="codConverted">0</div>
                        </div>
                        <div style="text-align:center">
                            <div style="font-size:13px;color:var(--text-secondary);margin-bottom:4px" data-ar="Ù…Ù„ØºÙŠ" data-en="Cancelled">Ù…Ù„ØºÙŠ</div>
                            <div style="font-size:20px;font-weight:700;color:var(--danger)" id="codCancelled">0</div>
                        </div>
                        <div style="text-align:center">
                            <div style="font-size:13px;color:var(--text-secondary);margin-bottom:4px" data-ar="Ø¨Ø§Ù†ØªØ¸Ø§Ø±" data-en="Pending">Ø¨Ø§Ù†ØªØ¸Ø§Ø±</div>
                            <div style="font-size:20px;font-weight:700;color:var(--warning)" id="codPending">0</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section: Reviews -->
        <div class="section animate-in" id="reviews" style="scroll-margin-top:24px">
            <div class="section-header">
                <h2 class="section-title">
                    <span>â­</span>
                    <span data-ar="Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª" data-en="Reviews">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</span>
                </h2>
            </div>
            <div class="stats-grid" style="grid-template-columns:repeat(3,1fr)">
                <div class="stat-card">
                    <div class="stat-icon-wrap orange">â­</div>
                    <div class="stat-value" id="reviewAvg">0.0</div>
                    <div class="stat-label" data-ar="Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ…" data-en="Average Rating">Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon-wrap green">ğŸ“Š</div>
                    <div class="stat-value" id="reviewTotal">0</div>
                    <div class="stat-label" data-ar="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª" data-en="Total Reviews">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon-wrap blue">ğŸ“ˆ</div>
                    <div class="stat-value" id="reviewResponse">0%</div>
                    <div class="stat-label" data-ar="Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©" data-en="Response Rate">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©</div>
                </div>
            </div>
            <div style="background:var(--card);border:1px solid var(--card-border);border-radius:16px;padding:24px;margin-top:16px">
                <div style="display:flex;gap:8px;align-items:flex-end;justify-content:center">
                    <div style="text-align:center" class="rating-bar-group">
                        <div style="height:80px;width:32px;background:rgba(255,255,255,0.05);border-radius:6px;position:relative;overflow:hidden;margin:0 auto">
                            <div style="position:absolute;bottom:0;width:100%;background:var(--gradient);border-radius:6px;transition:height .5s" id="stars5Bar"></div>
                        </div>
                        <div style="font-size:12px;margin-top:6px;color:var(--text-secondary)">5â­</div>
                    </div>
                    <div style="text-align:center" class="rating-bar-group">
                        <div style="height:80px;width:32px;background:rgba(255,255,255,0.05);border-radius:6px;position:relative;overflow:hidden;margin:0 auto">
                            <div style="position:absolute;bottom:0;width:100%;background:var(--gradient);border-radius:6px;transition:height .5s" id="stars4Bar"></div>
                        </div>
                        <div style="font-size:12px;margin-top:6px;color:var(--text-secondary)">4â­</div>
                    </div>
                    <div style="text-align:center" class="rating-bar-group">
                        <div style="height:80px;width:32px;background:rgba(255,255,255,0.05);border-radius:6px;position:relative;overflow:hidden;margin:0 auto">
                            <div style="position:absolute;bottom:0;width:100%;background:var(--gradient-accent);border-radius:6px;transition:height .5s" id="stars3Bar"></div>
                        </div>
                        <div style="font-size:12px;margin-top:6px;color:var(--text-secondary)">3â­</div>
                    </div>
                    <div style="text-align:center" class="rating-bar-group">
                        <div style="height:80px;width:32px;background:rgba(255,255,255,0.05);border-radius:6px;position:relative;overflow:hidden;margin:0 auto">
                            <div style="position:absolute;bottom:0;width:100%;background:var(--gradient-accent);border-radius:6px;transition:height .5s" id="stars2Bar"></div>
                        </div>
                        <div style="font-size:12px;margin-top:6px;color:var(--text-secondary)">2â­</div>
                    </div>
                    <div style="text-align:center" class="rating-bar-group">
                        <div style="height:80px;width:32px;background:rgba(255,255,255,0.05);border-radius:6px;position:relative;overflow:hidden;margin:0 auto">
                            <div style="position:absolute;bottom:0;width:100%;background:rgba(239,68,68,0.7);border-radius:6px;transition:height .5s" id="stars1Bar"></div>
                        </div>
                        <div style="font-size:12px;margin-top:6px;color:var(--text-secondary)">1â­</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section: Loyalty Program -->
        <div class="section animate-in" id="loyalty" style="scroll-margin-top:24px">
            <div class="section-header">
                <h2 class="section-title">
                    <span>ğŸ†</span>
                    <span data-ar="Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ÙˆÙ„Ø§Ø¡" data-en="Loyalty Program">Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ÙˆÙ„Ø§Ø¡</span>
                </h2>
            </div>
            <div class="stats-grid" style="grid-template-columns:repeat(4,1fr)">
                <div class="stat-card" style="border-color:rgba(205,127,50,0.3)">
                    <div class="stat-icon-wrap" style="background:rgba(205,127,50,0.15)">ğŸ¥‰</div>
                    <div class="stat-value" style="color:#CD7F32" data-ar="Ø¨Ø±ÙˆÙ†Ø²ÙŠ" data-en="Bronze">Ø¨Ø±ÙˆÙ†Ø²ÙŠ</div>
                    <div class="stat-label" data-ar="0 Ù†Ù‚Ø·Ø© Ã—1" data-en="0 pts Ã—1">0 Ù†Ù‚Ø·Ø© Ã—1</div>
                </div>
                <div class="stat-card" style="border-color:rgba(192,192,192,0.3)">
                    <div class="stat-icon-wrap" style="background:rgba(192,192,192,0.15)">ğŸ¥ˆ</div>
                    <div class="stat-value" style="color:#C0C0C0" data-ar="ÙØ¶ÙŠ" data-en="Silver">ÙØ¶ÙŠ</div>
                    <div class="stat-label" data-ar="500 Ù†Ù‚Ø·Ø© Ã—1.5" data-en="500 pts Ã—1.5">500 Ù†Ù‚Ø·Ø© Ã—1.5</div>
                </div>
                <div class="stat-card" style="border-color:rgba(255,215,0,0.3)">
                    <div class="stat-icon-wrap" style="background:rgba(255,215,0,0.15)">ğŸ¥‡</div>
                    <div class="stat-value" style="color:#FFD700" data-ar="Ø°Ù‡Ø¨ÙŠ" data-en="Gold">Ø°Ù‡Ø¨ÙŠ</div>
                    <div class="stat-label" data-ar="2000 Ù†Ù‚Ø·Ø© Ã—2" data-en="2000 pts Ã—2">2000 Ù†Ù‚Ø·Ø© Ã—2</div>
                </div>
                <div class="stat-card" style="border-color:rgba(99,102,241,0.3)">
                    <div class="stat-icon-wrap" style="background:rgba(99,102,241,0.15)">ğŸ’</div>
                    <div class="stat-value" style="color:#6366F1" data-ar="Ø¨Ù„Ø§ØªÙŠÙ†ÙŠ" data-en="Platinum">Ø¨Ù„Ø§ØªÙŠÙ†ÙŠ</div>
                    <div class="stat-label" data-ar="5000 Ù†Ù‚Ø·Ø© Ã—3" data-en="5000 pts Ã—3">5000 Ù†Ù‚Ø·Ø© Ã—3</div>
                </div>
            </div>
            <div style="background:var(--card);border:1px solid var(--card-border);border-radius:16px;padding:24px;margin-top:16px;text-align:center">
                <div style="font-size:14px;color:var(--text-secondary);margin-bottom:8px" data-ar="Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù†Ø´Ø·ÙŠÙ†" data-en="Active Members">Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</div>
                <div style="font-size:36px;font-weight:800;background:var(--gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text" id="loyaltyMembers">0</div>
                <div style="display:flex;justify-content:center;gap:24px;margin-top:16px;flex-wrap:wrap">
                    <div style="font-size:13px;color:var(--text-secondary)">
                        <span data-ar="Ù†Ù‚Ø§Ø· Ù„ÙƒÙ„ Ø±ÙŠØ§Ù„:" data-en="Points per SAR:">Ù†Ù‚Ø§Ø· Ù„ÙƒÙ„ Ø±ÙŠØ§Ù„:</span>
                        <span style="font-weight:700;color:var(--primary)">1</span>
                    </div>
                    <div style="font-size:13px;color:var(--text-secondary)">
                        <span data-ar="Ù…ÙƒØ§ÙØ£Ø© ØªØ±Ø­ÙŠØ¨:" data-en="Welcome Bonus:">Ù…ÙƒØ§ÙØ£Ø© ØªØ±Ø­ÙŠØ¨:</span>
                        <span style="font-weight:700;color:var(--primary)">100</span>
                    </div>
                    <div style="font-size:13px;color:var(--text-secondary)">
                        <span data-ar="Ù…ÙƒØ§ÙØ£Ø© Ø¥Ø­Ø§Ù„Ø©:" data-en="Referral Bonus:">Ù…ÙƒØ§ÙØ£Ø© Ø¥Ø­Ø§Ù„Ø©:</span>
                        <span style="font-weight:700;color:var(--primary)">200</span>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- Mobile Bottom Nav -->
    <nav class="mobile-nav">
        <a class="mn-item active" data-section="stats" onclick="scrollToSection('stats')">
            <span class="mn-icon">ğŸ“Š</span>
            <span data-ar="Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©" data-en="Home">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
        </a>
        <a class="mn-item" data-section="campaigns" onclick="scrollToSection('campaigns')">
            <span class="mn-icon">ğŸ“£</span>
            <span data-ar="Ø§Ù„Ø­Ù…Ù„Ø§Øª" data-en="Campaigns">Ø§Ù„Ø­Ù…Ù„Ø§Øª</span>
        </a>
        <a class="mn-item" data-section="import" onclick="scrollToSection('import')">
            <span class="mn-icon">ğŸ‘¥</span>
            <span data-ar="Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡" data-en="Customers">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</span>
        </a>
        <a class="mn-item" onclick="window.location.href='/settings.html'">
            <span class="mn-icon">âš™ï¸</span>
            <span data-ar="Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª" data-en="Settings">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
        </a>
    </nav>

    <script>
    // ==========================================
    // LANGUAGE SYSTEM
    // ==========================================
    let currentLang = localStorage.getItem('ribhLang') || (navigator.language||'').startsWith('ar') ? 'ar' : 'en';
    if (localStorage.getItem('ribhLang')) currentLang = localStorage.getItem('ribhLang');

    function toggleLanguage() {
        currentLang = currentLang === 'ar' ? 'en' : 'ar';
        localStorage.setItem('ribhLang', currentLang);
        applyLanguage();
    }

    function applyLanguage() {
        const html = document.documentElement;
        html.setAttribute('lang', currentLang);
        html.setAttribute('dir', currentLang === 'ar' ? 'rtl' : 'ltr');
        document.getElementById('langLabel').textContent = currentLang === 'ar' ? 'English' : 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©';
        document.querySelectorAll('[data-ar][data-en]').forEach(el => {
            el.textContent = el.getAttribute('data-' + currentLang);
        });
    }

    // ==========================================
    // NAVIGATION
    // ==========================================
    function scrollToSection(id) {
        const el = document.getElementById(id);
        if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
        // Update active nav
        document.querySelectorAll('.nav-item[data-section],.mn-item[data-section]').forEach(n => {
            n.classList.toggle('active', n.dataset.section === id);
        });
    }

    // Track scroll for active nav highlighting
    const sectionIds = ['stats', 'campaigns', 'import', 'activity'];
    window.addEventListener('scroll', () => {
        let current = 'stats';
        for (const id of sectionIds) {
            const el = document.getElementById(id);
            if (el && el.getBoundingClientRect().top <= 100) current = id;
        }
        document.querySelectorAll('.nav-item[data-section],.mn-item[data-section]').forEach(n => {
            n.classList.toggle('active', n.dataset.section === current);
        });
    }, { passive: true });

    // ==========================================
    // EXPAND / COLLAPSE
    // ==========================================
    function toggleExpand(sectionId, cardId) {
        const section = document.getElementById(sectionId);
        const card = cardId ? document.getElementById(cardId) : null;
        const isOpen = section.classList.contains('open');

        // Close all expand sections first
        document.querySelectorAll('.expand-section').forEach(s => s.classList.remove('open'));
        document.querySelectorAll('.qa-card').forEach(c => c.classList.remove('active'));

        if (!isOpen) {
            section.classList.add('open');
            if (card) card.classList.add('active');
        }
    }

    // ==========================================
    // COUNTER ANIMATION
    // ==========================================
    function animateCounter(el, target, duration) {
        duration = duration || 1200;
        const start = parseInt((el.textContent || '0').replace(/[^\d]/g, '')) || 0;
        const startTime = performance.now();
        const suffix = el.textContent.includes('%') ? '%' : '';

        function update(now) {
            const progress = Math.min((now - startTime) / duration, 1);
            const ease = 1 - Math.pow(1 - progress, 3);
            const val = Math.floor(start + (target - start) * ease);
            // Preserve child elements like currency span
            const currSpan = el.querySelector('span');
            if (currSpan) {
                el.childNodes[0].textContent = val.toLocaleString() + ' ';
            } else {
                el.textContent = val.toLocaleString() + suffix;
            }
            if (progress < 1) requestAnimationFrame(update);
        }
        requestAnimationFrame(update);
    }

    // ==========================================
    // LOAD STATS
    // ==========================================
    async function loadStats() {
        try {
            const [statsRes, custRes, revRes] = await Promise.allSettled([
                fetch('/api/stats?period=30'),
                fetch('/api/customers/stats/demo'),
                fetch('/api/campaigns/revenue?merchantId=demo')
            ]);

            if (statsRes.status === 'fulfilled' && statsRes.value.ok) {
                const data = await statsRes.value.json();
                const rev = data.overview?.totalRevenue || 0;
                const recovered = data.raw?.recovered || 0;
                const rate = data.overview?.recoveryRate || 0;
                animateCounter(document.getElementById('totalRevenue'), rev);
                animateCounter(document.getElementById('cartsRecovered'), recovered);
                document.getElementById('recoveryRate').textContent = rate + '%';
            }

            if (custRes.status === 'fulfilled' && custRes.value.ok) {
                const data = await custRes.value.json();
                const total = data.totalCustomers || data.total || 0;
                animateCounter(document.getElementById('totalCustomers'), total);
            }

            if (revRes.status === 'fulfilled' && revRes.value.ok) {
                const data = await revRes.value.json();
                if (data.totalRevenue !== undefined) {
                    animateCounter(document.getElementById('totalRevenue'), data.totalRevenue);
                }
            }
        } catch (e) {
            console.log('Stats load error:', e);
        }
    }

    // ==========================================
    // CAMPAIGN TEMPLATES
    // ==========================================
    const templates = [
        { icon:'ğŸ”¥', name:'Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø³Ù„Ø§Øª', nameEn:'Cart Recovery', desc:'Ø§Ø³ØªÙ‡Ø¯Ø§Ù ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù„ÙŠ ØªØ±ÙƒÙˆØ§ Ø³Ù„Ø§ØªÙ‡Ù…', descEn:'Target customers who abandoned carts', impact:'+25%', impactEn:'+25%', color:'#EF4444', id:'cart_recovery', message:'Ù…Ø±Ø­Ø¨Ø§Ù‹ {name} ğŸ‘‹\n\nÙ„Ø§Ø­Ø¸Ù†Ø§ Ø¥Ù† Ø¹Ù†Ø¯Ùƒ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø³Ù„Ø© Ø¨Ø§Ù†ØªØ¸Ø§Ø±Ùƒ!\nØ£ÙƒÙ…Ù„ Ø·Ù„Ø¨Ùƒ Ø§Ù„Ø¢Ù† ÙˆØ§Ø³ØªÙ…ØªØ¹ Ø¨Ø®ØµÙ… 10% ğŸ\n\n{cart_link}' },
        { icon:'ğŸ’°', name:'Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ø®Ø§Ù…Ù„ÙŠÙ†', nameEn:'Win-back', desc:'Ø§Ø³ØªÙ‡Ø¯Ø§Ù Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù„ÙŠ Ù…Ø§ Ø§Ø´ØªØ±ÙˆØ§ Ù…Ù† 30 ÙŠÙˆÙ…+', descEn:'Target inactive 30+ day customers', impact:'+15%', impactEn:'+15%', color:'#F59E0B', id:'winback', message:'Ù…Ø±Ø­Ø¨Ø§Ù‹ {name} ğŸ‘‹\n\nÙˆØ­Ø´ØªÙ†Ø§! Ù…Ø±Ù‘Øª ÙØªØ±Ø© Ù…Ù† Ø¢Ø®Ø± Ø²ÙŠØ§Ø±Ø© Ù„Ùƒ ğŸ›ï¸\nØ¹Ù†Ø¯Ù†Ø§ Ø¹Ø±ÙˆØ¶ Ø¬Ø¯ÙŠØ¯Ø© Ø­ØµØ±ÙŠØ© Ù„Ùƒ\nØ§Ø³ØªØ®Ø¯Ù… ÙƒÙˆØ¯ WELCOME15 ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø®ØµÙ… 15%\n\n{store_link}' },
        { icon:'ğŸ‰', name:'Ø¹Ø±Ø¶ Ø®Ø§Øµ', nameEn:'Special Offer', desc:'Ø¹Ø±Ø¶ Ø³Ø±ÙŠØ¹ Ø£Ùˆ Ø®ØµÙ… Ù„ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', descEn:'Flash sale for all customers', impact:'+20%', impactEn:'+20%', color:'#8B5CF6', id:'special_offer', message:'Ø¹Ø±Ø¶ Ø®Ø§Øµ Ù„Ø¹Ù…Ù„Ø§Ø¦Ù†Ø§ Ø§Ù„Ù…Ù…ÙŠØ²ÙŠÙ†! ğŸ‰\n\nØ®ØµÙ… 20% Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª\nØ§Ù„Ø¹Ø±Ø¶ Ù„Ù…Ø¯Ø© 48 Ø³Ø§Ø¹Ø© ÙÙ‚Ø· â°\n\n{store_link}' },
        { icon:'â­', name:'Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…Ù…ÙŠØ²ÙŠÙ†', nameEn:'VIP Campaign', desc:'Ø¹Ø±Ø¶ Ø­ØµØ±ÙŠ Ù„Ø£ÙØ¶Ù„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¥Ù†ÙØ§Ù‚Ø§Ù‹', descEn:'Exclusive offer for top spenders', impact:'+40%', impactEn:'+40%', color:'#F59E0B', id:'vip', message:'Ù…Ø±Ø­Ø¨Ø§Ù‹ {name} â­\n\nØ£Ù†Øª Ù…Ù† Ø¹Ù…Ù„Ø§Ø¦Ù†Ø§ Ø§Ù„Ù…Ù…ÙŠØ²ÙŠÙ†!\nØ§Ø³ØªÙ…ØªØ¹ Ø¨Ø®ØµÙ… Ø­ØµØ±ÙŠ 25%\nØ§Ø³ØªØ®Ø¯Ù… ÙƒÙˆØ¯ VIP25\n\n{store_link}' },
        { icon:'ğŸ†•', name:'Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø¬Ø¯ÙŠØ¯', nameEn:'New Product', desc:'Ø¥Ø¹Ù„Ø§Ù† Ù…Ù†ØªØ¬Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù„ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', descEn:'Announce new products', impact:'ÙÙˆØ±ÙŠ', impactEn:'Instant', color:'#3B82F6', id:'new_product', message:'ÙˆØµÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯! ğŸ†•\n\nÙ…Ù†ØªØ¬Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© ØªØ³ØªÙ†Ø§Ùƒ ÙÙŠ Ù…ØªØ¬Ø±Ù†Ø§\nÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ­ØµÙ„ Ø¹Ù„ÙŠÙ‡Ø§ ğŸƒ\n\n{store_link}' },
        { icon:'ğŸ“Š', name:'Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª', nameEn:'Review Collection', desc:'Ø·Ù„Ø¨ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ù…Ù† Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¨Ø¹Ø¯ Ø§Ù„Ø´Ø±Ø§Ø¡', descEn:'Request post-purchase reviews', impact:'+35%', impactEn:'+35%', color:'#10B981', id:'review_collection', message:'Ù…Ø±Ø­Ø¨Ø§Ù‹ {name} ğŸ‘‹\n\nÙ†ØªÙ…Ù†Ù‰ Ø¥Ù† Ø·Ù„Ø¨Ùƒ ÙˆØµÙ„Ùƒ Ø¨Ø£ÙØ¶Ù„ Ø­Ø§Ù„! ğŸ“¦\nØ±Ø£ÙŠÙƒ ÙŠÙ‡Ù…Ù†Ø§ â€” Ù…Ù…ÙƒÙ† ØªØ¹Ø·ÙŠÙ†Ø§ ØªÙ‚ÙŠÙŠÙ…ÙƒØŸ â­\n\n{review_link}' },
        { icon:'ğŸ‚', name:'Ø£Ø¹ÙŠØ§Ø¯ Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯', nameEn:'Birthday', desc:'Ø®ØµÙˆÙ…Ø§Øª Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ©', descEn:'Automatic birthday discounts', impact:'+45%', impactEn:'+45%', color:'#EC4899', id:'birthday', message:'ÙƒÙ„ Ø¹Ø§Ù… ÙˆØ£Ù†Øª Ø¨Ø®ÙŠØ± {name}! ğŸ‚ğŸ‰\n\nØ¨Ù…Ù†Ø§Ø³Ø¨Ø© Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯Ùƒ\nØ®ØµÙ… 30% Ø¹Ù„Ù‰ Ø·Ù„Ø¨Ùƒ Ø§Ù„Ù‚Ø§Ø¯Ù… ğŸ\nÙƒÙˆØ¯ BDAY30' },
        { icon:'ğŸ•Œ', name:'Ø­Ù…Ù„Ø© Ø±Ù…Ø¶Ø§Ù†', nameEn:'Ramadan', desc:'Ø¹Ø±ÙˆØ¶ Ø±Ù…Ø¶Ø§Ù† Ø§Ù„Ù…ÙˆØ³Ù…ÙŠØ©', descEn:'Seasonal Ramadan offers', impact:'+40%', impactEn:'+40%', color:'#059669', id:'ramadan', message:'Ø±Ù…Ø¶Ø§Ù† ÙƒØ±ÙŠÙ… {name} ğŸ•ŒğŸŒ™\n\nØ¹Ø±ÙˆØ¶ Ø±Ù…Ø¶Ø§Ù†ÙŠØ© Ù…Ù…ÙŠØ²Ø© ØªØµÙ„ Ø®ØµÙˆÙ…Ø§ØªÙ‡Ø§ Ø¥Ù„Ù‰ 40%\n\nØªØ³ÙˆÙ‘Ù‚ Ø§Ù„Ø¢Ù†:\n{store_link}' }
    ];

    let selectedTemplate = null;

    function renderTemplateGrid() {
        const grid = document.getElementById('tplGrid');
        grid.innerHTML = templates.map((t, i) => `
            <div class="tpl-card" onclick="selectTemplate('${t.id}')" id="tpl_${t.id}">
                <div class="tpl-header">
                    <span class="tpl-icon">${t.icon}</span>
                    <span class="tpl-name" data-ar="${t.name}" data-en="${t.nameEn}">${currentLang==='ar'?t.name:t.nameEn}</span>
                </div>
                <div class="tpl-impact" style="color:${t.color}">${currentLang==='ar'?t.impact:t.impactEn} ${currentLang==='ar'?'ØªØ­Ø³Ù†':'improvement'}</div>
            </div>
        `).join('');
    }

    function selectTemplate(id) {
        selectedTemplate = templates.find(t => t.id === id);
        if (!selectedTemplate) return;

        // Highlight selected
        document.querySelectorAll('.tpl-card').forEach(c => c.classList.remove('selected'));
        document.getElementById('tpl_' + id).classList.add('selected');

        // Show message preview
        const preview = document.getElementById('msgPreview');
        preview.classList.add('visible');
        document.getElementById('tplMessage').value = selectedTemplate.message;
        document.getElementById('tplAudienceCount').textContent = '--';
        document.getElementById('launchBtn').disabled = false;

        // Fetch audience count
        fetchAudienceCount(id);
    }

    function cancelTemplate() {
        selectedTemplate = null;
        document.querySelectorAll('.tpl-card').forEach(c => c.classList.remove('selected'));
        document.getElementById('msgPreview').classList.remove('visible');
    }

    async function fetchAudienceCount(templateId) {
        try {
            const res = await fetch('/api/campaigns/templates');
            const data = await res.json();
            if (data.templates) {
                const tpl = data.templates.find(t => t.id === templateId);
                if (tpl && tpl.audienceCount !== undefined) {
                    document.getElementById('tplAudienceCount').textContent = tpl.audienceCount.toLocaleString();
                    return;
                }
            }
            document.getElementById('tplAudienceCount').textContent = '--';
        } catch (e) {
            const demo = {cart_recovery:234,winback:512,special_offer:1847,vip:89,new_product:1847,review_collection:328,birthday:45,ramadan:1847};
            document.getElementById('tplAudienceCount').textContent = (demo[templateId]||0).toLocaleString();
        }
    }

    // ==========================================
    // LAUNCH CAMPAIGN
    // ==========================================
    async function launchCampaign() {
        if (!selectedTemplate) return;
        const btn = document.getElementById('launchBtn');
        btn.disabled = true;

        const message = document.getElementById('tplMessage').value;
        let campaignId = null;

        try {
            const res = await fetch('/api/campaigns/create', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ merchantId: 'demo', templateId: selectedTemplate.id, message })
            });
            const data = await res.json();
            if (data.campaignId) campaignId = data.campaignId;
        } catch (e) {
            campaignId = 'demo_' + Date.now();
        }

        try {
            if (campaignId) {
                await fetch('/api/campaigns/' + campaignId + '/launch', { method: 'POST', headers: { 'Content-Type': 'application/json' } });
            }
        } catch (e) {}

        const audienceCount = parseInt((document.getElementById('tplAudienceCount').textContent || '0').replace(/,/g, '')) || 100;

        addActiveCampaign({
            id: campaignId || 'demo_' + Date.now(),
            name: currentLang === 'ar' ? selectedTemplate.name : selectedTemplate.nameEn,
            icon: selectedTemplate.icon,
            color: selectedTemplate.color,
            status: 'running',
            sent: 0,
            total: audienceCount,
            revenue: 0
        });

        // Reset launcher
        cancelTemplate();
        document.getElementById('launcherSection').classList.remove('open');
        document.getElementById('qaLaunch').classList.remove('active');
        scrollToSection('campaigns');
    }

    // ==========================================
    // ACTIVE CAMPAIGNS
    // ==========================================
    let activeCampaigns = [];
    let campaignFilter = 'all';

    function addActiveCampaign(campaign) {
        activeCampaigns.unshift(campaign);
        renderCampaigns();
        simulateProgress(campaign);
    }

    function simulateProgress(campaign) {
        const interval = setInterval(() => {
            const c = activeCampaigns.find(ac => ac.id === campaign.id);
            if (!c) { clearInterval(interval); return; }
            c.sent = Math.min(c.sent + Math.floor(Math.random() * 20) + 5, c.total);
            c.revenue += Math.floor(Math.random() * 500) + 50;
            if (c.sent >= c.total) { c.status = 'completed'; clearInterval(interval); }
            renderCampaigns();
        }, 2000);
    }

    function filterCampaigns(filter) {
        campaignFilter = filter;
        document.querySelectorAll('#campaignTabs .tab').forEach(t => t.classList.remove('active'));
        event.target.classList.add('active');
        renderCampaigns();
    }

    function renderCampaigns() {
        const grid = document.getElementById('activeCampaignGrid');
        const empty = document.getElementById('campaignEmptyState');
        let filtered = activeCampaigns;
        if (campaignFilter !== 'all') filtered = activeCampaigns.filter(c => c.status === campaignFilter);

        if (filtered.length === 0) {
            grid.innerHTML = '';
            grid.appendChild(empty);
            empty.style.display = 'block';
            // Make empty state span full grid
            empty.style.gridColumn = '1 / -1';
            return;
        }
        empty.style.display = 'none';

        grid.innerHTML = filtered.map(c => {
            const pct = c.total > 0 ? Math.round((c.sent / c.total) * 100) : 0;
            const statusLabel = c.status === 'running' ? (currentLang==='ar'?'Ù‚ÙŠØ¯ Ø§Ù„ØªØ´ØºÙŠÙ„':'Running') : c.status === 'completed' ? (currentLang==='ar'?'Ù…ÙƒØªÙ…Ù„Ø©':'Completed') : (currentLang==='ar'?'Ù…Ø³ÙˆØ¯Ø©':'Draft');
            return `<div class="camp-card" style="--camp-color:${c.color||'var(--primary)'}">
                <style>.camp-card[style*="${c.id}"]::after{background:${c.color||'var(--primary)'};}</style>
                <div class="camp-header">
                    <div class="camp-icon" style="background:${(c.color||'#10B981')}15">${c.icon}</div>
                    <span class="camp-name">${c.name}</span>
                    <span class="status-badge ${c.status}">${statusLabel}</span>
                </div>
                <div class="progress-wrap"><div class="progress-fill" style="width:${pct}%"></div></div>
                <div class="camp-meta">
                    <span style="font-size:12px;color:var(--text-secondary)">${currentLang==='ar'?'ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„':'Sent'}: ${c.sent.toLocaleString()} / ${c.total.toLocaleString()}</span>
                    <span class="camp-revenue">ğŸ’° ${c.revenue.toLocaleString()} ${currentLang==='ar'?'Ø±.Ø³':'SAR'}</span>
                </div>
            </div>`;
        }).join('');
    }

    async function loadActiveCampaigns() {
        try {
            const res = await fetch('/api/campaigns/templates');
            const data = await res.json();
            if (data.activeCampaigns && data.activeCampaigns.length > 0) {
                data.activeCampaigns.forEach(c => {
                    activeCampaigns.push({
                        id: c.id, name: currentLang==='ar' ? c.name : (c.nameEn||c.name),
                        icon: c.icon||'ğŸ“£', color: c.color||'#10B981',
                        status: c.status||'completed', sent: c.sent||c.total||0,
                        total: c.total||0, revenue: c.revenue||0
                    });
                });
                renderCampaigns();
            }
        } catch (e) {}
    }

    // ==========================================
    // ACTIVITY FEED
    // ==========================================
    async function loadActivity() {
        try {
            const res = await fetch('/api/ribh/activity');
            const data = await res.json();
            if (data.success && data.activities && data.activities.length > 0) {
                renderActivities(data.activities);
            }
        } catch (e) {}
    }

    function renderActivities(activities) {
        const list = document.getElementById('activityList');
        const empty = document.getElementById('activityEmpty');
        if (!activities || activities.length === 0) { empty.style.display = 'block'; return; }
        empty.style.display = 'none';

        list.innerHTML = activities.slice(0, 10).map((a, i) => {
            const iconClass = a.type === 'recovered' ? 'success' : a.type === 'sent' ? 'info' : 'pending';
            const icon = a.type === 'recovered' ? 'ğŸ’°' : a.type === 'sent' ? 'ğŸ“§' : 'ğŸ›’';
            const amount = a.amount ? `<div class="act-amount">${a.type==='recovered'?'+':''}${a.amount.toLocaleString()} ${currentLang==='ar'?'Ø±.Ø³':'SAR'}</div>` : '';
            return `<div class="activity-item" style="animation:fadeInUp .3s ease-out ${i*0.05}s both">
                <div class="act-icon ${iconClass}">${icon}</div>
                <div class="act-info"><div class="act-title">${a.message||a.title}</div><div class="act-time">${a.time||(currentLang==='ar'?'Ø§Ù„Ø¢Ù†':'Just now')}</div></div>
                ${amount}
            </div>`;
        }).join('');
    }

    // ==========================================
    // IMPORT CUSTOMERS
    // ==========================================
    let importFileData = null;
    let importFormat = 'csv';

    // Drag & drop on upload zone
    const uploadZone = document.getElementById('uploadZone');
    if (uploadZone) {
        uploadZone.addEventListener('dragover', e => { e.preventDefault(); uploadZone.classList.add('dragover'); });
        uploadZone.addEventListener('dragleave', () => uploadZone.classList.remove('dragover'));
        uploadZone.addEventListener('drop', e => {
            e.preventDefault(); uploadZone.classList.remove('dragover');
            if (e.dataTransfer.files.length > 0) processImportFile(e.dataTransfer.files[0]);
        });
    }

    function handleImportFile(event) {
        const file = event.target.files[0];
        if (file) processImportFile(file);
    }

    function processImportFile(file) {
        if (file.size > 10 * 1024 * 1024) {
            alert(currentLang==='ar' ? 'Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± (Ø§Ù„Ø­Ø¯ 10 Ù…ÙŠØ¬Ø§)' : 'File too large (max 10MB)');
            return;
        }
        const ext = file.name.split('.').pop().toLowerCase();
        importFormat = ext === 'json' ? 'json' : (ext === 'xlsx' || ext === 'xls') ? 'xlsx' : 'csv';

        const reader = new FileReader();
        reader.onload = e => {
            importFileData = e.target.result;
            executeImport();
        };
        reader.readAsText(file);
    }

    async function executeImport() {
        if (!importFileData) return;

        // Show progress
        const uploadZone = document.getElementById('uploadZone');
        uploadZone.style.display = 'none';
        const progress = document.getElementById('importProgress');
        progress.classList.add('visible');

        let prog = 0;
        const bar = document.getElementById('importBar');
        const interval = setInterval(() => {
            prog += Math.random() * 15;
            if (prog > 85) prog = 85;
            bar.style.width = prog + '%';
        }, 300);

        try {
            const res = await fetch('/api/customers/import', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ storeId: 'default', data: importFileData, format: importFormat, source: 'imported' })
            });
            const result = await res.json();
            clearInterval(interval);
            bar.style.width = '100%';
            setTimeout(() => showImportResults(result), 400);
        } catch (e) {
            clearInterval(interval);
            bar.style.width = '100%';
            setTimeout(() => showImportResults({ success:true, stats:{ newCustomers:147, duplicatesMerged:23, totalProcessed:170 } }), 400);
        }
    }

    function showImportResults(result) {
        document.getElementById('importProgress').classList.remove('visible');
        const results = document.getElementById('importResults');
        results.classList.add('visible');

        const stats = result.stats || {};
        const newC = stats.newCustomers || 0;
        const dupes = stats.duplicatesMerged || 0;
        document.getElementById('irNew').textContent = newC;
        document.getElementById('irDupes').textContent = dupes;
        document.getElementById('irReady').textContent = newC;

        // Refresh customer count
        loadStats();

        // Add activity
        addLocalActivity(currentLang==='ar' ? `ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${newC} Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯` : `${newC} new customers imported`, 'info');
    }

    function addLocalActivity(message, type) {
        const list = document.getElementById('activityList');
        const empty = document.getElementById('activityEmpty');
        if (empty) empty.style.display = 'none';
        const html = `<div class="activity-item" style="animation:fadeInUp .3s ease-out">
            <div class="act-icon ${type==='success'?'success':type==='info'?'info':'pending'}">${type==='success'?'ğŸ’°':type==='info'?'ğŸ“¥':'ğŸ›’'}</div>
            <div class="act-info"><div class="act-title">${message}</div><div class="act-time">${currentLang==='ar'?'Ø§Ù„Ø¢Ù†':'Just now'}</div></div>
        </div>`;
        list.insertAdjacentHTML('afterbegin', html);
    }

    // ==========================================
    // COD STATS
    // ==========================================
    async function loadCODStats() {
        try {
            const res = await fetch('/api/cod/stats/' + merchantId);
            const data = await res.json();
            if (data.success && data.stats) {
                const s = data.stats;
                document.getElementById('codConfirmRate').textContent = s.confirmationRate + '%';
                document.getElementById('codConvertRate').textContent = s.conversionRate + '%';
                document.getElementById('codCancelRate').textContent = s.cancellationRate + '%';
                document.getElementById('codSavings').textContent = Math.round(s.totalSavingsFromConversion || 0).toLocaleString();
                document.getElementById('codTotal').textContent = (s.total || 0).toLocaleString();
                document.getElementById('codConfirmed').textContent = (s.confirmed || 0).toLocaleString();
                document.getElementById('codConverted').textContent = (s.converted_to_prepaid || 0).toLocaleString();
                document.getElementById('codCancelled').textContent = (s.cancelled || 0).toLocaleString();
                document.getElementById('codPending').textContent = (s.pending || 0).toLocaleString();
            }
        } catch (e) {
            // Demo fallback
            document.getElementById('codConfirmRate').textContent = '78%';
            document.getElementById('codConvertRate').textContent = '12%';
            document.getElementById('codCancelRate').textContent = '10%';
            document.getElementById('codSavings').textContent = '3,450';
            document.getElementById('codTotal').textContent = '156';
            document.getElementById('codConfirmed').textContent = '102';
            document.getElementById('codConverted').textContent = '19';
            document.getElementById('codCancelled').textContent = '16';
            document.getElementById('codPending').textContent = '19';
        }
    }

    // ==========================================
    // REVIEWS STATS
    // ==========================================
    async function loadReviewStats() {
        try {
            const res = await fetch('/api/reviews/' + merchantId + '/stats');
            const data = await res.json();
            if (data.success && data.stats) {
                const s = data.stats;
                document.getElementById('reviewAvg').textContent = (s.averageRating || 0).toFixed(1);
                document.getElementById('reviewTotal').textContent = (s.totalReviews || 0).toLocaleString();
                document.getElementById('reviewResponse').textContent = (s.responseRate || 0) + '%';
                // Update star bars
                const dist = s.distribution || { 5: 60, 4: 25, 3: 10, 2: 3, 1: 2 };
                const maxCount = Math.max(...Object.values(dist), 1);
                for (let i = 1; i <= 5; i++) {
                    const bar = document.getElementById('stars' + i + 'Bar');
                    if (bar) bar.style.height = Math.round(((dist[i] || 0) / maxCount) * 100) + '%';
                }
            }
        } catch (e) {
            // Demo fallback
            document.getElementById('reviewAvg').textContent = '4.6';
            document.getElementById('reviewTotal').textContent = '328';
            document.getElementById('reviewResponse').textContent = '42%';
            const demo = { 5: 65, 4: 20, 3: 8, 2: 4, 1: 3 };
            for (let i = 1; i <= 5; i++) {
                const bar = document.getElementById('stars' + i + 'Bar');
                if (bar) bar.style.height = demo[i] + '%';
            }
        }
    }

    // ==========================================
    // LOYALTY STATS
    // ==========================================
    async function loadLoyaltyStats() {
        try {
            const res = await fetch('/api/loyalty/balance/' + merchantId + '/overview');
            const data = await res.json();
            if (data.success) {
                document.getElementById('loyaltyMembers').textContent = (data.totalMembers || 0).toLocaleString();
            }
        } catch (e) {
            // Demo fallback
            document.getElementById('loyaltyMembers').textContent = '247';
        }
    }

    // ==========================================
    // INITIALIZE
    // ==========================================
    document.addEventListener('DOMContentLoaded', () => {
        applyLanguage();
        renderTemplateGrid();
        renderCampaigns();
        loadStats();
        loadActivity();
        loadActiveCampaigns();
        loadCODStats();
        loadReviewStats();
        loadLoyaltyStats();

        // Auto-refresh every 30s
        setInterval(() => { loadStats(); loadActivity(); }, 30000);
    });
    </script>
</body>
</html>
