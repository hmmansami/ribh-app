<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RIBH - One Click Money</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg: #09090B;
            --card: #18181B;
            --border: #27272A;
            --text: #FAFAFA;
            --text-muted: #71717A;
            --primary: #10B981;
            --primary-hover: #059669;
        }
        html { font-family: 'IBM Plex Sans Arabic', system-ui, sans-serif; }
        body { background: var(--bg); color: var(--text); min-height: 100vh; overflow-x: hidden; }

        .container { max-width: 800px; margin: 0 auto; padding: 24px; }

        /* Hero Section */
        .hero { text-align: center; padding: 40px 0 32px; }
        .hero-money { font-size: 72px; font-weight: 700; color: var(--primary); line-height: 1; margin-bottom: 8px; }
        .hero-currency { font-size: 24px; color: var(--text-muted); }
        .hero-subtitle { color: var(--text-muted); font-size: 18px; margin-top: 8px; }

        /* Breakdown Cards */
        .breakdown { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; margin-bottom: 32px; }
        .breakdown-card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 20px 24px; min-width: 140px; text-align: center; flex: 1; max-width: 200px; }
        .breakdown-icon { font-size: 24px; margin-bottom: 8px; }
        .breakdown-value { font-size: 22px; font-weight: 700; margin-bottom: 4px; }
        .breakdown-label { font-size: 12px; color: var(--text-muted); }
        .breakdown-sar { font-size: 13px; color: var(--primary); margin-top: 4px; }

        /* Main Action Button */
        .action-section { text-align: center; margin-bottom: 32px; }
        .action-btn {
            padding: 20px 48px; font-size: 20px; font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--primary-hover));
            color: white; border: none; border-radius: 14px;
            cursor: pointer; display: inline-flex; align-items: center; gap: 12px;
            box-shadow: 0 0 40px rgba(16,185,129,0.4);
            animation: glowPulse 2s ease-in-out infinite;
            transition: transform 0.2s;
        }
        .action-btn:hover { transform: scale(1.03); }
        .action-btn:disabled { opacity: 0.6; cursor: not-allowed; animation: none; }
        .action-btn svg { width: 24px; height: 24px; }
        @keyframes glowPulse {
            0%, 100% { box-shadow: 0 0 30px rgba(16,185,129,0.4); }
            50% { box-shadow: 0 0 50px rgba(16,185,129,0.6); }
        }

        .action-hint { font-size: 13px; color: var(--text-muted); margin-top: 12px; }

        /* Activity Feed */
        .activity { margin-bottom: 32px; }
        .activity-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
        .activity-title { font-size: 14px; font-weight: 600; }
        .activity-badge { padding: 4px 10px; background: rgba(16,185,129,0.15); border-radius: 12px; font-size: 11px; color: var(--primary); font-weight: 600; display: flex; align-items: center; gap: 6px; }
        .activity-badge-dot { width: 6px; height: 6px; background: var(--primary); border-radius: 50%; animation: blink 1s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        .activity-list { }
        .activity-item { display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: var(--card); border: 1px solid var(--border); border-radius: 12px; margin-bottom: 8px; animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
        .activity-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
        .activity-dot.green { background: var(--primary); }
        .activity-dot.blue { background: #3B82F6; }
        .activity-dot.orange { background: #F59E0B; }
        .activity-dot.purple { background: #8B5CF6; }
        .activity-content { flex: 1; }
        .activity-msg { font-size: 13px; font-weight: 500; }
        .activity-time { font-size: 11px; color: var(--text-muted); }
        .activity-amount { font-size: 13px; font-weight: 600; color: var(--primary); }

        /* Status Bar */
        .status-bar { display: flex; gap: 16px; justify-content: center; flex-wrap: wrap; padding: 16px; background: var(--card); border: 1px solid var(--border); border-radius: 12px; margin-bottom: 24px; }
        .status-item { display: flex; align-items: center; gap: 8px; font-size: 13px; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; }
        .status-dot.active { background: var(--primary); }
        .status-dot.inactive { background: var(--text-muted); }
        .status-dot.pending { background: #F59E0B; animation: blink 1s infinite; }

        /* Results Overlay */
        .results-overlay { display: none; position: fixed; inset: 0; background: rgba(9,9,11,0.95); z-index: 100; align-items: center; justify-content: center; }
        .results-overlay.active { display: flex; }
        .results-content { text-align: center; padding: 32px; }
        .results-icon { width: 80px; height: 80px; margin: 0 auto 24px; background: rgba(16,185,129,0.15); border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .results-icon svg { width: 40px; height: 40px; color: var(--primary); }
        .results-title { font-size: 28px; font-weight: 700; margin-bottom: 8px; }
        .results-subtitle { color: var(--text-muted); margin-bottom: 24px; }
        .results-stats { display: flex; gap: 32px; justify-content: center; margin-bottom: 32px; }
        .results-stat { text-align: center; }
        .results-stat-val { font-size: 32px; font-weight: 700; color: var(--primary); }
        .results-stat-label { font-size: 13px; color: var(--text-muted); }
        .btn-secondary { padding: 14px 28px; background: var(--card); border: 1px solid var(--border); border-radius: 12px; color: var(--text); font-size: 15px; font-weight: 600; cursor: pointer; }

        /* Confetti */
        #confetti { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9998; }

        /* Responsive */
        @media (max-width: 640px) {
            .hero-money { font-size: 48px; }
            .breakdown { flex-direction: column; align-items: center; }
            .breakdown-card { width: 100%; max-width: 280px; }
            .action-btn { padding: 18px 36px; font-size: 18px; }
        }
    </style>
</head>
<body>
    <canvas id="confetti"></canvas>

    <div class="container">
        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-item">
                <span class="status-dot" id="sallaStatus"></span>
                <span id="sallaStatusText">Ø³Ù„Ø©</span>
            </div>
            <div class="status-item">
                <span class="status-dot" id="waStatus"></span>
                <span id="waStatusText">ÙˆØ§ØªØ³Ø§Ø¨</span>
            </div>
            <div class="status-item">
                <span class="status-dot" id="engineStatus"></span>
                <span id="engineStatusText">Ø§Ù„Ù…Ø­Ø±Ùƒ</span>
            </div>
        </div>

        <!-- Hero -->
        <div class="hero">
            <div>
                <span class="hero-money" id="heroMoney">0</span>
                <span class="hero-currency">Ø±.Ø³</span>
            </div>
            <div class="hero-subtitle" id="heroSubtitle">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...</div>
        </div>

        <!-- Breakdown -->
        <div class="breakdown">
            <div class="breakdown-card">
                <div class="breakdown-icon">ğŸ›’</div>
                <div class="breakdown-value" id="cartCount">0</div>
                <div class="breakdown-label">Ø³Ù„Ø© Ù…ØªØ±ÙˆÙƒØ©</div>
                <div class="breakdown-sar" id="cartValue">0 Ø±.Ø³</div>
            </div>
            <div class="breakdown-card">
                <div class="breakdown-icon">ğŸ˜´</div>
                <div class="breakdown-value" id="dormantCount">0</div>
                <div class="breakdown-label">Ø¹Ù…ÙŠÙ„ Ø®Ø§Ù…Ù„</div>
                <div class="breakdown-sar" id="dormantValue">0 Ø±.Ø³</div>
            </div>
            <div class="breakdown-card">
                <div class="breakdown-icon">ğŸ›ï¸</div>
                <div class="breakdown-value" id="upsellCount">0</div>
                <div class="breakdown-label">ÙØ±ØµØ© Ø¨ÙŠØ¹</div>
                <div class="breakdown-sar" id="upsellValue">0 Ø±.Ø³</div>
            </div>
        </div>

        <!-- Main Action -->
        <div class="action-section">
            <button class="action-btn" id="mainBtn" onclick="handleMainAction()">
                <i data-lucide="message-circle"></i>
                <span id="mainBtnText">Ø±Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„ØªÙØ¹ÙŠÙ„</span>
            </button>
            <div class="action-hint" id="actionHint">Ø§Ø±Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø¨Ø¯Ø¡ Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø£Ù…ÙˆØ§Ù„Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</div>
        </div>

        <!-- Activity Feed -->
        <div class="activity">
            <div class="activity-header">
                <span class="activity-title">Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª</span>
                <span class="activity-badge"><span class="activity-badge-dot"></span> Ù…Ø¨Ø§Ø´Ø±</span>
            </div>
            <div class="activity-list" id="activityList"></div>
        </div>
    </div>

    <!-- Results Overlay -->
    <div class="results-overlay" id="resultsOverlay">
        <div class="results-content">
            <div class="results-icon"><i data-lucide="check-circle"></i></div>
            <h1 class="results-title">Ø§Ù„Ù…Ø­Ø±Ùƒ ÙŠØ¹Ù…Ù„! ğŸš€</h1>
            <div class="results-subtitle">Ø³ÙŠØªÙ… Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø£Ù…ÙˆØ§Ù„Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ø¢Ù†</div>
            <div class="results-stats">
                <div class="results-stat">
                    <div class="results-stat-val" id="resultsSent">0</div>
                    <div class="results-stat-label">Ø±Ø³Ø§Ù„Ø© Ø£ÙØ±Ø³Ù„Øª</div>
                </div>
                <div class="results-stat">
                    <div class="results-stat-val" id="resultsRevenue">0</div>
                    <div class="results-stat-label">Ø±.Ø³ Ù…ØªÙˆÙ‚Ø¹</div>
                </div>
            </div>
            <button class="btn-secondary" onclick="closeResults()">Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©</button>
        </div>
    </div>

    <script>
    // === STATE ===
    let state = {
        sallaConnected: false,
        waConnected: false,
        engineActive: false,
        realData: null
    };

    // === FAKE DATA (shown before real analysis) ===
    const FAKE_DATA = {
        money: 45000,
        carts: 347,
        cartsValue: 28000,
        dormant: 891,
        dormantValue: 12000,
        upsell: 156,
        upsellValue: 5000
    };

    // === FAKE ACTIVITY (simulated) ===
    const FAKE_ACTIVITIES = [
        { msg: 'Ù…Ø­Ù…Ø¯ Ø£ÙƒÙ…Ù„ Ø·Ù„Ø¨Ù‡', amount: 320, dot: 'green' },
        { msg: 'Ø£Ø­Ù…Ø¯ Ù‚Ø±Ø£ Ø§Ù„Ø±Ø³Ø§Ù„Ø©', dot: 'blue' },
        { msg: 'Ø³Ø§Ø±Ø© Ù†Ù‚Ø±Øª Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø·', dot: 'orange' },
        { msg: 'Ø®Ø§Ù„Ø¯ Ø£ÙƒÙ…Ù„ Ø·Ù„Ø¨Ù‡', amount: 180, dot: 'green' },
        { msg: 'ÙØ§Ø·Ù…Ø© Ø§Ø³ØªÙ„Ù…Øª Ø§Ù„Ø±Ø³Ø§Ù„Ø©', dot: 'blue' },
        { msg: 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø£Ø¶Ø§Ù Ù„Ù„Ø³Ù„Ø©', dot: 'purple' },
        { msg: 'Ù†ÙˆØ±Ø© Ø£ÙƒÙ…Ù„Øª Ø·Ù„Ø¨Ù‡Ø§', amount: 450, dot: 'green' },
        { msg: 'Ø³Ø¹ÙˆØ¯ Ù‚Ø±Ø£ Ø§Ù„Ø±Ø³Ø§Ù„Ø©', dot: 'blue' },
    ];

    // === INIT ===
    document.addEventListener('DOMContentLoaded', async () => {
        lucide.createIcons();

        // Check Salla connection
        await checkSallaConnection();

        // Start showing fake data with animation
        showFakeData();

        // Start fake activity feed
        startFakeActivity();

        // Update UI based on state
        updateUI();
    });

    // === CHECK SALLA CONNECTION ===
    async function checkSallaConnection() {
        try {
            const res = await fetch('/api/ribh/analyze');
            const data = await res.json();

            if (data.success && data.merchant) {
                state.sallaConnected = true;
                state.realData = data;
            }
        } catch (e) {
            console.log('Salla check:', e.message);
        }
    }

    // === SHOW FAKE DATA WITH COUNTING ANIMATION ===
    function showFakeData() {
        animateValue('heroMoney', FAKE_DATA.money, 2000);
        animateValue('cartCount', FAKE_DATA.carts, 1500);
        animateValue('dormantCount', FAKE_DATA.dormant, 1500);
        animateValue('upsellCount', FAKE_DATA.upsell, 1500);

        setTimeout(() => {
            document.getElementById('cartValue').textContent = FAKE_DATA.cartsValue.toLocaleString() + ' Ø±.Ø³';
            document.getElementById('dormantValue').textContent = FAKE_DATA.dormantValue.toLocaleString() + ' Ø±.Ø³';
            document.getElementById('upsellValue').textContent = FAKE_DATA.upsellValue.toLocaleString() + ' Ø±.Ø³';
            document.getElementById('heroSubtitle').textContent = 'ØªÙ†ØªØ¸Ø±Ùƒ ÙÙŠ Ù…ØªØ¬Ø±Ùƒ';
        }, 500);
    }

    // === FAKE ACTIVITY FEED ===
    function startFakeActivity() {
        let index = 0;

        function addNext() {
            const act = FAKE_ACTIVITIES[index % FAKE_ACTIVITIES.length];
            addActivity(act.msg, act.dot, act.amount);
            index++;

            // Random interval 2-5 seconds
            setTimeout(addNext, 2000 + Math.random() * 3000);
        }

        // Start after 1 second
        setTimeout(addNext, 1000);
    }

    function addActivity(msg, dotColor, amount) {
        const list = document.getElementById('activityList');
        const item = document.createElement('div');
        item.className = 'activity-item';

        const amountHtml = amount ? `<span class="activity-amount">+${amount} Ø±.Ø³</span>` : '';
        item.innerHTML = `
            <span class="activity-dot ${dotColor}"></span>
            <div class="activity-content">
                <div class="activity-msg">${msg}</div>
                <div class="activity-time">Ø§Ù„Ø¢Ù†</div>
            </div>
            ${amountHtml}
        `;

        list.insertBefore(item, list.firstChild);

        // Keep only last 6 items
        while (list.children.length > 6) {
            list.removeChild(list.lastChild);
        }
    }

    // === UPDATE UI BASED ON STATE ===
    function updateUI() {
        const sallaStatus = document.getElementById('sallaStatus');
        const waStatus = document.getElementById('waStatus');
        const engineStatus = document.getElementById('engineStatus');
        const mainBtn = document.getElementById('mainBtn');
        const mainBtnText = document.getElementById('mainBtnText');
        const actionHint = document.getElementById('actionHint');

        // Salla status
        if (state.sallaConnected) {
            sallaStatus.className = 'status-dot active';
            document.getElementById('sallaStatusText').textContent = 'Ø³Ù„Ø© âœ“';
        } else {
            sallaStatus.className = 'status-dot inactive';
        }

        // WhatsApp status
        if (state.waConnected) {
            waStatus.className = 'status-dot active';
            document.getElementById('waStatusText').textContent = 'ÙˆØ§ØªØ³Ø§Ø¨ âœ“';
        } else {
            waStatus.className = 'status-dot pending';
            document.getElementById('waStatusText').textContent = 'ÙˆØ§ØªØ³Ø§Ø¨ (ØºÙŠØ± Ù…ÙØ¹Ù„)';
        }

        // Engine status
        if (state.engineActive) {
            engineStatus.className = 'status-dot active';
            document.getElementById('engineStatusText').textContent = 'Ø§Ù„Ù…Ø­Ø±Ùƒ ÙŠØ¹Ù…Ù„ âœ“';
        } else {
            engineStatus.className = 'status-dot inactive';
            document.getElementById('engineStatusText').textContent = 'Ø§Ù„Ù…Ø­Ø±Ùƒ (Ù…ØªÙˆÙ‚Ù)';
        }

        // Main button
        if (!state.sallaConnected) {
            mainBtnText.textContent = 'Ø±Ø¨Ø· Ø³Ù„Ø© Ø£ÙˆÙ„Ø§Ù‹';
            mainBtn.innerHTML = '<i data-lucide="store"></i><span>Ø±Ø¨Ø· Ø³Ù„Ø© Ø£ÙˆÙ„Ø§Ù‹</span>';
            actionHint.textContent = 'Ø§Ø±Ø¨Ø· Ù…ØªØ¬Ø±Ùƒ Ù…Ù† Ø³Ù„Ø© Ù„Ù„Ø¨Ø¯Ø¡';
        } else if (!state.waConnected) {
            mainBtnText.textContent = 'Ø±Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„ØªÙØ¹ÙŠÙ„';
            mainBtn.innerHTML = '<i data-lucide="message-circle"></i><span>Ø±Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„ØªÙØ¹ÙŠÙ„</span>';
            actionHint.textContent = 'Ø§Ø±Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø¨Ø¯Ø¡ Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø£Ù…ÙˆØ§Ù„Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹';
        } else if (!state.engineActive) {
            mainBtnText.textContent = 'ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø­Ø±Ùƒ ğŸš€';
            mainBtn.innerHTML = '<i data-lucide="rocket"></i><span>ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø­Ø±Ùƒ ğŸš€</span>';
            actionHint.textContent = 'Ø§Ø¶ØºØ· Ù„Ø¨Ø¯Ø¡ Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø£Ù…ÙˆØ§Ù„Ùƒ';
        } else {
            mainBtnText.textContent = 'Ø§Ù„Ù…Ø­Ø±Ùƒ ÙŠØ¹Ù…Ù„ âœ“';
            mainBtn.innerHTML = '<i data-lucide="check-circle"></i><span>Ø§Ù„Ù…Ø­Ø±Ùƒ ÙŠØ¹Ù…Ù„ âœ“</span>';
            mainBtn.disabled = true;
            mainBtn.style.animation = 'none';
            actionHint.textContent = 'Ø³ÙŠØªÙ… Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø£Ù…ÙˆØ§Ù„Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹';
        }

        lucide.createIcons();
    }

    // === MAIN ACTION HANDLER ===
    async function handleMainAction() {
        if (!state.sallaConnected) {
            // Go to Salla install
            window.location.href = '/salla/install';
            return;
        }

        if (!state.waConnected) {
            // Go to WhatsApp setup
            window.location.href = '/whatsapp.html';
            return;
        }

        if (!state.engineActive) {
            // Activate engine - analyze real data and launch
            await activateEngine();
        }
    }

    // === ACTIVATE ENGINE ===
    async function activateEngine() {
        const btn = document.getElementById('mainBtn');
        btn.disabled = true;
        btn.innerHTML = '<span>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙØ¹ÙŠÙ„...</span>';

        try {
            // Show real data if we have it
            if (state.realData) {
                const { analysis } = state.realData;
                const { breakdown } = analysis;

                animateValue('heroMoney', analysis.moneyWaiting, 1500);
                animateValue('cartCount', breakdown.abandonedCarts.count, 1000);
                animateValue('dormantCount', breakdown.dormantCustomers.count, 1000);
                animateValue('upsellCount', breakdown.recentBuyers.count, 1000);

                document.getElementById('cartValue').textContent = breakdown.abandonedCarts.recoveryEstimate.toLocaleString() + ' Ø±.Ø³';
                document.getElementById('dormantValue').textContent = breakdown.dormantCustomers.reactivationEstimate.toLocaleString() + ' Ø±.Ø³';
                document.getElementById('upsellValue').textContent = breakdown.recentBuyers.upsellEstimate.toLocaleString() + ' Ø±.Ø³';
            }

            // Launch campaigns
            const res = await fetch('/api/ribh/launch', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ campaigns: ['cartRecovery', 'winback', 'upsell'] })
            });

            const data = await res.json();

            if (data.success) {
                state.engineActive = true;
                launchConfetti();
                showResults(data.results);
            } else {
                alert('Ø®Ø·Ø£: ' + (data.error || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'));
            }
        } catch (e) {
            console.error('Engine activation error:', e);
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„');
        }

        updateUI();
    }

    // === SHOW RESULTS ===
    function showResults(results) {
        const overlay = document.getElementById('resultsOverlay');
        overlay.classList.add('active');

        const totalRevenue = results.launched.reduce((s, l) => s + (l.estimatedRevenue || 0), 0);

        document.getElementById('resultsSent').textContent = results.messagesSent;
        document.getElementById('resultsRevenue').textContent = totalRevenue.toLocaleString();

        lucide.createIcons();
    }

    function closeResults() {
        document.getElementById('resultsOverlay').classList.remove('active');
    }

    // === ANIMATE VALUE ===
    function animateValue(elementId, end, duration = 1500) {
        const el = document.getElementById(elementId);
        let start = 0;
        const startTime = performance.now();

        function update(now) {
            const p = Math.min((now - startTime) / duration, 1);
            const eased = 1 - Math.pow(1 - p, 3);
            el.textContent = Math.floor(start + (end - start) * eased).toLocaleString();
            if (p < 1) requestAnimationFrame(update);
        }
        requestAnimationFrame(update);
    }

    // === CONFETTI ===
    function launchConfetti() {
        const cv = document.getElementById('confetti'), ctx = cv.getContext('2d');
        cv.width = window.innerWidth; cv.height = window.innerHeight;
        const ps = [], colors = ['#10B981', '#22C55E', '#6366F1', '#F59E0B', '#3B82F6', '#EF4444', '#FAFAFA'];
        for (let i = 0; i < 120; i++) ps.push({ x: cv.width / 2 + (Math.random() - 0.5) * 200, y: cv.height / 2, vx: (Math.random() - 0.5) * 12, vy: Math.random() * -16 - 4, w: Math.random() * 8 + 4, h: Math.random() * 6 + 2, c: colors[Math.floor(Math.random() * colors.length)], r: Math.random() * 360, rv: (Math.random() - 0.5) * 12, g: 0.3, o: 1 });
        let f = 0;
        function draw() {
            ctx.clearRect(0, 0, cv.width, cv.height); let alive = false;
            ps.forEach(p => { p.x += p.vx; p.vy += p.g; p.y += p.vy; p.r += p.rv; if (f > 40) p.o -= 0.015; if (p.o <= 0) return; alive = true; ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.r * Math.PI / 180); ctx.globalAlpha = p.o; ctx.fillStyle = p.c; ctx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h); ctx.restore(); });
            f++; if (alive) requestAnimationFrame(draw); else ctx.clearRect(0, 0, cv.width, cv.height);
        }
        requestAnimationFrame(draw);
    }
    </script>
</body>
</html>
