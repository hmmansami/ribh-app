rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Stores collection - merchants only access their own data
    match /stores/{storeId} {
      allow read: if true;  // Cloud Functions access via Admin SDK bypasses rules
      allow write: if true; // Admin SDK has full access anyway
    }
    
    // Carts collection
    match /carts/{cartId} {
      allow read, write: if true;
    }
    
    // Logs collection (write-only for webhooks)
    match /logs/{logId} {
      allow read, write: if true;
    }
    
    // Leads collection
    match /leads/{leadId} {
      allow read, write: if true;
    }
    
    // Templates collection
    match /templates/{templateId} {
      allow read, write: if true;
    }
    
    // Sequences collection (for lifecycle engine)
    match /sequences/{seqId} {
      allow read, write: if true;
    }
    
    // Default: deny all other collections
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
